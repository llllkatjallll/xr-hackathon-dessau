import{M as z,ac as fi,V as U,ad as Tt,ae as wr,P as Is,af as yr,ag as St,ah as Qr,ai as xr,aj as mi,ak as On,al as Sr,am as Wn,an as vr,h as an,ao as Tr,ap as ei,aq as Po,b as he,$ as Dt,ar as rn,a0 as gt,v as Te,p as Ze,as as Oo,at as ti,au as Ho,k as ge,av as Mt,l as Ne,aw as _r,ax as Rr,ay as bt,a as bs,az as Dr,a2 as it,aA as Mr,L as Et,_ as Es,R as Vt,aB as Fn,aC as Pt,c as Ii,r as bi,aD as Ct,B as pt,aE as Ei,aF as us,aG as mt,aH as kr,aI as rs,aJ as An,aK as Qe,aa as jo,aL as qo,aM as Ci,aN as ni,aO as Kn,aP as Xe,aQ as xe,A as zo,aR as Ko,aS as Yo,aT as Jo,K as ds,aU as Wo,aV as Bi,F as Vo,aW as on,T as si,aX as gs,aY as ps,aZ as fs,d as Cs,S as wi,a_ as Fr,a$ as Lr,j as It,b0 as Nr,b1 as Hn,z as Wt,b2 as Xo,b3 as Ur,b4 as Gr,b5 as Pr,b6 as Or,b7 as Hr,b8 as jr,b9 as qr,ba as zr,H as _t,I as ot,x as Kr,J as Yr,bb as Jr,bc as Wr,t as ms,a9 as Ln,a8 as mn,bd as Li,be as Vr,bf as Xr,bg as yi,bh as Zo,bi as Jt,bj as Je,bk as qe,bl as Fe,bm as Vn,bn as yn,bo as Qi,bp as $o,bq as In,u as Ot,br as Zr,bs as jn,bt as $r,bu as eA,bv as tA,bw as nA,bx as ea,by as sA,bz as iA,bA as oA,bB as aA,bC as En,bD as bn,bE as Ni,i as ta,U as rA,e as ii,bF as AA,s as na,w as cA,bG as lA,bH as hA,bI as oi,bJ as uA,bK as dA,bL as gA,bM as pA,bN as fA,bO as mA,bP as IA,bQ as bA,bR as EA,bS as CA,bT as BA,bU as wA,bV as yA,bW as QA,bX as xA,bY as SA,bZ as vA,b_ as TA,b$ as _A,c0 as RA,c1 as DA,c2 as MA,c3 as kA,c4 as FA,c5 as LA,c6 as NA,c7 as UA,c8 as GA,c9 as sa,ca as ia,cb as oa,cc as PA,cd as OA,ce as HA,cf as jA,cg as Ui,ch as qA,ci as Gi,cj as Pi,ck as zA,cl as KA,cm as YA,cn as JA,co as Ye,cp as aa,cq as As,cr as WA,cs as VA,ct as XA,cu as ZA,cv as $A,cw as ec,cx as tc,cy as nc,cz as sc,cA as ic,cB as oc,cC as ac,cD as rc,cE as Ac,cF as cc,cG as lc,cH as Oi,cI as Hi,cJ as hc,cK as uc,cL as dc,cM as gc,cN as pc,cO as fc}from"./three@0.169.5.js";class Nu extends z{constructor(e,t,s,n=128){if(t<=0||s<=0||n<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const i=new fi(s,2*n,n);i.scale(1,1,-1);const o=i.getAttribute("position"),a=new U;for(let r=0;r<o.count;++r)if(a.fromBufferAttribute(o,r),a.y<0){const c=-t*3/2,l=a.y<c?-t/a.y:1-a.y*a.y/(3*c*c);a.multiplyScalar(l),a.toArray(o.array,3*r)}o.needsUpdate=!0,super(i,new Tt({map:e,depthWrite:!1}))}}class mc extends wr{constructor(e){super(e.nodeType),this.node=null,this.source=null,this.target=null,this.inclusionType="replace",Object.assign(this,e)}generate(e){return this.node.build(e,this.getNodeType(e))}}const Be=mc,st=new yr;st.camera=new Is;const ji={LineBasicNodeMaterial:St.basic,MeshBasicNodeMaterial:St.basic,PointsNodeMaterial:St.points,MeshStandardNodeMaterial:St.standard,MeshPhysicalNodeMaterial:St.physical,MeshPhongNodeMaterial:St.phong},Ic={atan2:"atan"},bc={low:"lowp",medium:"mediump",high:"highp"};function qt(A){return`#include <${A}>`}function Qn(A){return`${A}Shader`}class Ec extends Qr{constructor(e,t,s,n=null){super(e,t,new xr,null,n),this.shader=s,this.slots={vertex:[],fragment:[]},this._parseShaderLib(),this._parseInclude("fragment","lights_physical_fragment","clearcoat_normal_fragment_begin","transmission_fragment"),this._parseObject(),this._sortSlotsToFlow(),this.useComparisonMethod=!0}getMethod(e){return Ic[e]||e}addSlot(e,t){this.slots[e].push(t)}_parseShaderLib(){const e=this.material;let t=e.type;if(e.isMeshPhysicalNodeMaterial?t="MeshPhysicalNodeMaterial":e.isMeshStandardNodeMaterial?t="MeshStandardNodeMaterial":e.isMeshPhongNodeMaterial?t="MeshPhongNodeMaterial":e.isMeshBasicNodeMaterial?t="MeshBasicNodeMaterial":e.isPointsNodeMaterial?t="PointsNodeMaterial":e.isLineBasicNodeMaterial&&(t="LineBasicNodeMaterial"),ji[t]!==void 0){const s=ji[t],n=this.shader;n.vertexShader=s.vertexShader,n.fragmentShader=s.fragmentShader,n.uniforms=mi.merge([s.uniforms,On.lights])}}_parseObject(){const{material:e,renderer:t}=this;this.addSlot("fragment",new Be({node:Sr,nodeType:"vec3",source:"void main() {",target:"vec3 TransformedNormalView = %RESULT%;",inclusionType:"append"})),t.toneMappingNode&&t.toneMappingNode.isNode===!0&&this.addSlot("fragment",new Be({node:e.colorNode,nodeType:"vec4",source:qt("tonemapping_fragment"),target:""})),e.colorNode&&e.colorNode.isNode&&this.addSlot("fragment",new Be({node:e.colorNode,nodeType:"vec4",source:"vec4 diffuseColor = vec4( diffuse, opacity );",target:"vec4 diffuseColor = %RESULT%; diffuseColor.a *= opacity;"})),e.opacityNode&&e.opacityNode.isNode&&this.addSlot("fragment",new Be({node:e.opacityNode,nodeType:"float",source:qt("alphatest_fragment"),target:"diffuseColor.a = %RESULT%;",inclusionType:"append"})),e.normalNode&&e.normalNode.isNode&&this.addSlot("fragment",new Be({node:e.normalNode,nodeType:"vec3",source:qt("normal_fragment_begin"),target:"normal = %RESULT%;",inclusionType:"append"})),e.emissiveNode&&e.emissiveNode.isNode&&this.addSlot("fragment",new Be({node:e.emissiveNode,nodeType:"vec3",source:qt("emissivemap_fragment"),target:"totalEmissiveRadiance = %RESULT%;",inclusionType:"append"})),e.isMeshStandardNodeMaterial&&(e.metalnessNode&&e.metalnessNode.isNode&&this.addSlot("fragment",new Be({node:e.metalnessNode,nodeType:"float",source:qt("metalnessmap_fragment"),target:"metalnessFactor = %RESULT%;",inclusionType:"append"})),e.roughnessNode&&e.roughnessNode.isNode&&this.addSlot("fragment",new Be({node:e.roughnessNode,nodeType:"float",source:qt("roughnessmap_fragment"),target:"roughnessFactor = %RESULT%;",inclusionType:"append"})),e.isMeshPhysicalNodeMaterial&&(e.clearcoatNode&&e.clearcoatNode.isNode?(this.addSlot("fragment",new Be({node:e.clearcoatNode,nodeType:"float",source:"material.clearcoat = clearcoat;",target:"material.clearcoat = %RESULT%;"})),e.clearcoatRoughnessNode&&e.clearcoatRoughnessNode.isNode&&this.addSlot("fragment",new Be({node:e.clearcoatRoughnessNode,nodeType:"float",source:"material.clearcoatRoughness = clearcoatRoughness;",target:"material.clearcoatRoughness = %RESULT%;"})),e.clearcoatNormalNode&&e.clearcoatNormalNode.isNode&&this.addSlot("fragment",new Be({node:e.clearcoatNormalNode,nodeType:"vec3",source:"vec3 clearcoatNormal = nonPerturbedNormal;",target:"vec3 clearcoatNormal = %RESULT%;"})),e.defines.USE_CLEARCOAT=""):delete e.defines.USE_CLEARCOAT,e.sheenNode&&e.sheenNode.isNode?(this.addSlot("fragment",new Be({node:e.sheenNode,nodeType:"vec3",source:"material.sheenColor = sheenColor;",target:"material.sheenColor = %RESULT%;"})),e.sheenRoughnessNode&&e.sheenRoughnessNode.isNode&&this.addSlot("fragment",new Be({node:e.sheenRoughnessNode,nodeType:"float",source:"material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );",target:"material.sheenRoughness = clamp( %RESULT%, 0.07, 1.0 );"})),e.defines.USE_SHEEN=""):delete e.defines.USE_SHEEN,e.iridescenceNode&&e.iridescenceNode.isNode?(this.addSlot("fragment",new Be({node:e.iridescenceNode,nodeType:"float",source:"material.iridescence = iridescence;",target:"material.iridescence = %RESULT%;"})),e.iridescenceIORNode&&e.iridescenceIORNode.isNode&&this.addSlot("fragment",new Be({node:e.iridescenceIORNode,nodeType:"float",source:"material.iridescenceIOR = iridescenceIOR;",target:"material.iridescenceIOR = %RESULT%;"})),e.iridescenceThicknessNode&&e.iridescenceThicknessNode.isNode&&this.addSlot("fragment",new Be({node:e.iridescenceThicknessNode,nodeType:"float",source:"material.iridescenceThickness = iridescenceThicknessMaximum;",target:"material.iridescenceThickness = %RESULT%;"})),e.defines.USE_IRIDESCENCE=""):delete e.defines.USE_IRIDESCENCE,e.iorNode&&e.iorNode.isNode&&this.addSlot("fragment",new Be({node:e.iorNode,nodeType:"float",source:"material.ior = ior;",target:"material.ior = %RESULT%;"})),e.specularColorNode&&e.specularColorNode.isNode&&this.addSlot("fragment",new Be({node:e.specularColorNode,nodeType:"vec3",source:"vec3 specularColorFactor = specularColor;",target:"vec3 specularColorFactor = %RESULT%;"})),e.specularIntensityNode&&e.specularIntensityNode.isNode&&this.addSlot("fragment",new Be({node:e.specularIntensityNode,nodeType:"float",source:"float specularIntensityFactor = specularIntensity;",target:"float specularIntensityFactor = %RESULT%;"})),e.transmissionNode&&e.transmissionNode.isNode?(this.addSlot("fragment",new Be({node:e.transmissionNode,nodeType:"float",source:"material.transmission = transmission;",target:"material.transmission = %RESULT%;"})),e.thicknessNode&&e.thicknessNode.isNode&&this.addSlot("fragment",new Be({node:e.thicknessNode,nodeType:"float",source:"material.thickness = thickness;",target:"material.thickness = %RESULT%;"})),e.attenuationDistanceNode&&e.attenuationDistanceNode.isNode&&this.addSlot("fragment",new Be({node:e.attenuationDistanceNode,nodeType:"float",source:"material.attenuationDistance = attenuationDistance;",target:"material.attenuationDistance = %RESULT%;"})),e.attenuationColorNode&&e.attenuationColorNode.isNode&&this.addSlot("fragment",new Be({node:e.attenuationColorNode,nodeType:"vec3",source:"material.attenuationColor = attenuationColor;",target:"material.attenuationColor = %RESULT%;"})),e.transmission=1,e.defines.USE_TRANSMISSION=""):(e.transmission=0,delete e.defines.USE_TRANSMISSION))),e.positionNode&&e.positionNode.isNode&&this.addSlot("vertex",new Be({node:e.positionNode,nodeType:"vec3",source:qt("begin_vertex"),target:"transformed = %RESULT%;",inclusionType:"append"})),e.sizeNode&&e.sizeNode.isNode&&this.addSlot("vertex",new Be({node:e.sizeNode,nodeType:"float",source:"gl_PointSize = size;",target:"gl_PointSize = %RESULT%;"}))}generateTexture(e,t,s){return e.isTextureCube?`textureCube( ${t}, ${s} )`:`texture2D( ${t}, ${s} )`}generateTextureLevel(e,t,s,n){return`textureLod( ${t}, ${s}, ${n} )`}buildFunctionCode(e){const t=e.layout,s=this.flowShaderNode(e),n=[];for(const o of t.inputs)n.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${n.join(", ")} ) {

	${s.vars}

${s.code}
	return ${s.result};

}`}getUniforms(e){const t=this.uniforms[e];let s="";for(const n of t){if(/^(modelViewMatrix|projectionMatrix)$/.test(n.name))continue;let i=null;n.type==="texture"?i=`sampler2D ${n.name}; `:n.type==="cubeTexture"?i=`samplerCube ${n.name}; `:i=`${this.getVectorType(n.type)} ${n.name}; `;const o=n.node.precision;o!==null?i="uniform "+bc[o]+" "+i:i="uniform "+i,s+=i}return s}getAttributes(e){let t="";if(e==="vertex"){const s=this.attributes;for(const n of s)/^(position|normal|uv[1-3]?)$/.test(n.name)||(t+=`attribute ${n.type} ${n.name}; `)}return t}getVaryings(e){let t="";const s=this.varyings;if(e==="vertex")for(const n of s)t+=`${n.needsInterpolation?"varying":"/*varying*/"} ${n.type} ${n.name}; `;else if(e==="fragment")for(const n of s)n.needsInterpolation&&(t+=`varying ${n.type} ${n.name}; `);return t}addCode(e,t,s,n=this){const i=Qn(e);let o=n[i];const a=o.indexOf(t);if(a!==-1){const r=o.substring(0,a+t.length),c=o.substring(a+t.length);o=`${r}
${s}
${c}`}n[i]=o}replaceCode(e,t,s,n=this){const i=Qn(e);n[i]=n[i].replaceAll(t,s)}getVertexIndex(){return"gl_VertexID"}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord"}isFlipY(){return!0}buildCode(){const e={};for(const t of Wn){const s=this.getUniforms(t),n=this.getAttributes(t),i=this.getVaryings(t),o=this.getVars(t),a=this.getCodes(t);e[t]=`${this.getSignature()}
// <node_builder>

// uniforms
${s}

// attributes
${n}

// varyings
${i}

// vars
${o}

// codes
${a}

// </node_builder>

${this.shader[Qn(t)]}
`}this.vertexShader=e.vertex,this.fragmentShader=e.fragment}build(){return super.build(!1),this._addSnippets(),this._addUniforms(),this._updateUniforms(),this.shader.vertexShader=this.vertexShader,this.shader.fragmentShader=this.fragmentShader,this}_parseInclude(e,...t){for(const s of t){const n=qt(s),i=vr[s],o=Qn(e);this.shader[o]=this.shader[o].replaceAll(n,i)}}_sortSlotsToFlow(){for(const e of Wn){const t=this.shader[Qn(e)],s=this.slots[e].sort((n,i)=>t.indexOf(n.source)>t.indexOf(i.source)?1:-1);for(const n of s)this.addFlow(e,n)}}_addSnippets(){for(const e of Wn){for(const t of this.slots[e]){const s=this.getFlowData(t),n=t.inclusionType,i=t.source,o=s.code+`
	`+t.target.replace("%RESULT%",s.result);n==="append"?this.addCode(e,i,o):n==="replace"?this.replaceCode(e,i,o):console.warn(`Inclusion type "${n}" not compatible.`)}this.addCode(e,"main() {",`
	`+this.flowCode[e])}}_addUniforms(){for(const e of Wn)for(const t of this.uniforms[e])this.shader.uniforms[t.name]=t}_updateUniforms(){st.object=this.object,st.renderer=this.renderer,st.material=this.material,st.scene=this.scene;for(const e of this.updateNodes)st.updateNode(e)}}const ra=new WeakMap;an.prototype.onBuild=function(A,e,t){const s=this;if(s.isNodeMaterial===!0){let n;try{n=new Ec(A,t,e,s).build(),ra.set(s,n)}catch(i){console.error("Material.prototype.onBuild: ",i)}}};an.prototype.onBeforeRender=function(A,e,t,s,n){const i=ra.get(this);if(i!==void 0){st.material=this,st.camera=t,st.object=n,st.renderer=A,st.scene=e,st.geometry=s;const o=i.updateNodes;if(o.length>0){A.state.useProgram(null);for(const a of o)st.updateNode(a)}}};var cs=function(){var A=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(l){l.preventDefault(),s(++A%e.children.length)},!1);function t(l){return e.appendChild(l.dom),l}function s(l){for(var h=0;h<e.children.length;h++)e.children[h].style.display=h===l?"block":"none";A=l}var n=(performance||Date).now(),i=n,o=0,a=t(new cs.Panel("FPS","#0ff","#002")),r=t(new cs.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new cs.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:e,addPanel:t,showPanel:s,begin:function(){n=(performance||Date).now()},end:function(){o++;var l=(performance||Date).now();if(r.update(l-n,200),l>=i+1e3&&(a.update(o*1e3/(l-i),100),i=l,o=0,c)){var h=performance.memory;c.update(h.usedJSHeapSize/1048576,h.jsHeapSizeLimit/1048576)}return l},update:function(){n=this.end()},domElement:e,setMode:s}};cs.Panel=function(A,e,t){var s=1/0,n=0,i=Math.round,o=i(window.devicePixelRatio||1),a=80*o,r=48*o,c=3*o,l=2*o,h=3*o,d=15*o,g=74*o,p=30*o,b=document.createElement("canvas");b.width=a,b.height=r,b.style.cssText="width:80px;height:48px";var f=b.getContext("2d");return f.font="bold "+9*o+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=t,f.fillRect(0,0,a,r),f.fillStyle=e,f.fillText(A,c,l),f.fillRect(h,d,g,p),f.fillStyle=t,f.globalAlpha=.9,f.fillRect(h,d,g,p),{dom:b,update:function(m,B){s=Math.min(s,m),n=Math.max(n,m),f.fillStyle=t,f.globalAlpha=1,f.fillRect(0,0,a,d),f.fillStyle=e,f.fillText(i(m)+" "+A+" ("+i(s)+"-"+i(n)+")",c,l),f.drawImage(b,h+o,d,g-o,p,h,d,g-o,p),f.fillRect(h+g-o,d,o,p),f.fillStyle=t,f.globalAlpha=.9,f.fillRect(h+g-o,d,o,i((1-m/B)*p))}}};function Uu(A,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},s=A.getIndex(),n=A.getAttribute("position"),i=s?s.count:n.count;let o=0;const a=Object.keys(A.attributes),r={},c={},l=[],h=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"];for(let B=0,E=a.length;B<E;B++){const w=a[B],y=A.attributes[w];r[w]=new y.constructor(new y.array.constructor(y.count*y.itemSize),y.itemSize,y.normalized);const v=A.morphAttributes[w];v&&(c[w]||(c[w]=[]),v.forEach((R,x)=>{const T=new R.array.constructor(R.count*R.itemSize);c[w][x]=new R.constructor(T,R.itemSize,R.normalized)}))}const g=e*.5,p=Math.log10(1/e),b=Math.pow(10,p),f=g*b;for(let B=0;B<i;B++){const E=s?s.getX(B):B;let w="";for(let y=0,v=a.length;y<v;y++){const R=a[y],x=A.getAttribute(R),T=x.itemSize;for(let L=0;L<T;L++)w+=`${~~(x[h[L]](E)*b+f)},`}if(w in t)l.push(t[w]);else{for(let y=0,v=a.length;y<v;y++){const R=a[y],x=A.getAttribute(R),T=A.morphAttributes[R],L=x.itemSize,N=r[R],O=c[R];for(let $=0;$<L;$++){const G=h[$],q=d[$];if(N[q](o,x[G](E)),T)for(let H=0,K=T.length;H<K;H++)O[H][q](o,T[H][G](E))}}t[w]=o,l.push(o),o++}}const m=A.clone();for(const B in A.attributes){const E=r[B];if(m.setAttribute(B,new E.constructor(E.array.slice(0,o*E.itemSize),E.itemSize,E.normalized)),B in c)for(let w=0;w<c[B].length;w++){const y=c[B][w];m.morphAttributes[B][w]=new y.constructor(y.array.slice(0,o*y.itemSize),y.itemSize,y.normalized)}}return m.setIndex(l),m}function qi(A,e){if(e===Tr)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),A;if(e===ei||e===Po){let t=A.getIndex();if(t===null){const o=[],a=A.getAttribute("position");if(a!==void 0){for(let r=0;r<a.count;r++)o.push(r);A.setIndex(o),t=A.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),A}const s=t.count-2,n=[];if(e===ei)for(let o=1;o<=s;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<s;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=A.clone();return i.setIndex(n),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),A}class Aa extends Dt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Qc(t)}),this.register(function(t){return new xc(t)}),this.register(function(t){return new Fc(t)}),this.register(function(t){return new Lc(t)}),this.register(function(t){return new Nc(t)}),this.register(function(t){return new vc(t)}),this.register(function(t){return new Tc(t)}),this.register(function(t){return new _c(t)}),this.register(function(t){return new Rc(t)}),this.register(function(t){return new yc(t)}),this.register(function(t){return new Dc(t)}),this.register(function(t){return new Sc(t)}),this.register(function(t){return new kc(t)}),this.register(function(t){return new Mc(t)}),this.register(function(t){return new Bc(t)}),this.register(function(t){return new Uc(t)}),this.register(function(t){return new Gc(t)})}load(e,t,s,n){const i=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=rn.extractUrlBase(e);o=rn.resolveURL(c,this.path)}else o=rn.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),i.manager.itemError(e),i.manager.itemEnd(e)},r=new gt(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(c){try{i.parse(c,o,function(l){t(l),i.manager.itemEnd(e)},a)}catch(l){a(l)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let i,o;const a={},r={},c=new TextDecoder;if(typeof e=="string")try{i=JSON.parse(e)}catch(h){o=e,n&&n(h);return}else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===ca){try{a[ae.KHR_BINARY_GLTF]=new Pc(e)}catch(d){n&&n(d);return}try{i=JSON.parse(a[ae.KHR_BINARY_GLTF].content)}catch(d){o=a[ae.KHR_BINARY_GLTF].content,n&&n(d);return}}else try{i=JSON.parse(c.decode(e))}catch(d){o=c.decode(e),n&&n(d);return}else i=e;if(i.asset===void 0||i.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}this.json=i,this.jsonErrorData=o;const l=new $c(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](l);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,a[d.name]=!0}if(i.extensionsUsed)for(let h=0;h<i.extensionsUsed.length;++h){const d=i.extensionsUsed[h],g=i.extensionsRequired||[];switch(d){case ae.KHR_MATERIALS_UNLIT:a[d]=new wc;break;case ae.KHR_DRACO_MESH_COMPRESSION:a[d]=new Oc(i,this.dracoLoader);break;case ae.KHR_TEXTURE_TRANSFORM:a[d]=new Hc;break;case ae.KHR_MESH_QUANTIZATION:a[d]=new jc;break;default:g.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(a),l.setPlugins(r),l.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,i){s.parse(e,t,n,i)})}}function Cc(){let A={};return{get:function(e){return A[e]},add:function(e,t){A[e]=t},remove:function(e){delete A[e]},removeAll:function(){A={}}}}const ae={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Bc{constructor(e){this.parser=e,this.name=ae.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const i=t.json,r=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let c;const l=new Te(16777215);r.color!==void 0&&l.setRGB(r.color[0],r.color[1],r.color[2],Ze);const h=r.range!==void 0?r.range:0;switch(r.type){case"directional":c=new Ho(l),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ti(l),c.distance=h;break;case"spot":c=new Oo(l),c.distance=h,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,c.angle=r.spot.outerConeAngle,c.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return c.position.set(0,0,0),c.decay=2,Ut(c,r),r.intensity!==void 0&&(c.intensity=r.intensity),c.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(c),t.cache.add(s,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(r){return s._getNodeRef(t.cache,a,r)})}}let wc=class{constructor(){this.name=ae.KHR_MATERIALS_UNLIT}getMaterialType(){return Tt}extendParams(e,t,s){const n=[];e.color=new Te(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Ze),e.opacity=o[3]}i.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",i.baseColorTexture,ge))}return Promise.all(n)}},yc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}},Qc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Ne(a,a)}return Promise.all(i)}},xc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_DISPERSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}},Sc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}},vc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new Te(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Ze)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,ge)),o.sheenRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}},Tc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}},_c=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Te().setRGB(a[0],a[1],a[2],Ze),Promise.all(i)}},Rc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}},Dc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Te().setRGB(a[0],a[1],a[2],Ze),o.specularColorTexture!==void 0&&i.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,ge)),Promise.all(i)}},Mc=class{constructor(e){this.parser=e,this.name=ae.EXT_MATERIALS_BUMP}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&i.push(s.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(i)}},kc=class{constructor(e){this.parser=e,this.name=ae.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:Mt}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(s.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}};class Fc{constructor(e){this.parser=e,this.name=ae.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class Lc{constructor(e){this.parser=e,this.name=ae.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=n.images[o.source];let r=s.textureLoader;if(a.uri){const c=s.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,o.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Nc{constructor(e){this.parser=e,this.name=ae.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=n.images[o.source];let r=s.textureLoader;if(a.uri){const c=s.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,o.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Uc{constructor(e){this.name=ae.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const r=n.byteOffset||0,c=n.byteLength||0,l=n.count,h=n.byteStride,d=new Uint8Array(a,r,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(l,h,d,n.mode,n.filter).then(function(g){return g.buffer}):o.ready.then(function(){const g=new ArrayBuffer(l*h);return o.decodeGltfBuffer(new Uint8Array(g),l,h,d,n.mode,n.filter),g})})}else return null}}let Gc=class{constructor(e){this.name=ae.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const n=t.meshes[s.mesh];for(const c of n.primitives)if(c.mode!==dt.TRIANGLES&&c.mode!==dt.TRIANGLE_STRIP&&c.mode!==dt.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=s.extensions[this.name].attributes,a=[],r={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(l=>(r[c]=l,r[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const l=c.pop(),h=l.isGroup?l.children:[l],d=c[0].count,g=[];for(const p of h){const b=new he,f=new U,m=new xe,B=new U(1,1,1),E=new _r(p.geometry,p.material,d);for(let w=0;w<d;w++)r.TRANSLATION&&f.fromBufferAttribute(r.TRANSLATION,w),r.ROTATION&&m.fromBufferAttribute(r.ROTATION,w),r.SCALE&&B.fromBufferAttribute(r.SCALE,w),E.setMatrixAt(w,b.compose(f,m,B));for(const w in r)if(w==="_COLOR_0"){const y=r[w];E.instanceColor=new Rr(y.array,y.itemSize,y.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&p.geometry.setAttribute(w,r[w]);bt.prototype.copy.call(E,p),this.parser.assignFinalMaterial(E),g.push(E)}return l.isGroup?(l.clear(),l.add(...g),l):g[0]}))}};const ca="glTF",xn=12,zi={JSON:1313821514,BIN:5130562};class Pc{constructor(e){this.name=ae.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,xn),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ca)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-xn,i=new DataView(e,xn);let o=0;for(;o<n;){const a=i.getUint32(o,!0);o+=4;const r=i.getUint32(o,!0);if(o+=4,r===zi.JSON){const c=new Uint8Array(e,xn+o,a);this.content=s.decode(c)}else if(r===zi.BIN){const c=xn+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Oc{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ae.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},r={},c={};for(const l in o){const h=ai[l]||l.toLowerCase();a[h]=o[l]}for(const l in e.attributes){const h=ai[l]||l.toLowerCase();if(o[l]!==void 0){const d=s.accessors[e.attributes[l]],g=Cn[d.componentType];c[h]=g.name,r[h]=d.normalized===!0}}return t.getDependency("bufferView",i).then(function(l){return new Promise(function(h,d){n.decodeDracoFile(l,function(g){for(const p in g.attributes){const b=g.attributes[p],f=r[p];f!==void 0&&(b.normalized=f)}h(g)},a,c,Ze,d)})})}}class Hc{constructor(){this.name=ae.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class jc{constructor(){this.name=ae.KHR_MESH_QUANTIZATION}}class la extends Fr{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let o=0;o!==n;o++)t[o]=s[i+o];return t}interpolate_(e,t,s,n){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,r=a*2,c=a*3,l=n-t,h=(s-t)/l,d=h*h,g=d*h,p=e*c,b=p-c,f=-2*g+3*d,m=g-d,B=1-f,E=m-d+h;for(let w=0;w!==a;w++){const y=o[b+w+a],v=o[b+w+r]*l,R=o[p+w+a],x=o[p+w]*l;i[w]=B*y+E*v+f*R+m*x}return i}}const qc=new xe;class zc extends la{interpolate_(e,t,s,n){const i=super.interpolate_(e,t,s,n);return qc.fromArray(i).normalize().toArray(i),i}}const dt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Cn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ki={9728:zo,9729:Et,9984:Ko,9985:Yo,9986:Jo,9987:Es},Yi={33071:ds,33648:Wo,10497:Vt},xs={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ai={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},zt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Kc={CUBICSPLINE:void 0,LINEAR:Kn,STEP:Bi},Ss={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Yc(A){return A.DefaultMaterial===void 0&&(A.DefaultMaterial=new Ii({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Vo})),A.DefaultMaterial}function en(A,e,t){for(const s in t.extensions)A[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function Ut(A,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(A.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Jc(A,e,t){let s=!1,n=!1,i=!1;for(let c=0,l=e.length;c<l;c++){const h=e[c];if(h.POSITION!==void 0&&(s=!0),h.NORMAL!==void 0&&(n=!0),h.COLOR_0!==void 0&&(i=!0),s&&n&&i)break}if(!s&&!n&&!i)return Promise.resolve(A);const o=[],a=[],r=[];for(let c=0,l=e.length;c<l;c++){const h=e[c];if(s){const d=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):A.attributes.position;o.push(d)}if(n){const d=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):A.attributes.normal;a.push(d)}if(i){const d=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):A.attributes.color;r.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(r)]).then(function(c){const l=c[0],h=c[1],d=c[2];return s&&(A.morphAttributes.position=l),n&&(A.morphAttributes.normal=h),i&&(A.morphAttributes.color=d),A.morphTargetsRelative=!0,A})}function Wc(A,e){if(A.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)A.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(A.morphTargetInfluences.length===t.length){A.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)A.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Vc(A){let e;const t=A.extensions&&A.extensions[ae.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+vs(t.attributes):e=A.indices+":"+vs(A.attributes)+":"+A.mode,A.targets!==void 0)for(let s=0,n=A.targets.length;s<n;s++)e+=":"+vs(A.targets[s]);return e}function vs(A){let e="";const t=Object.keys(A).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+A[t[s]]+";";return e}function ri(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Xc(A){return A.search(/\.jpe?g($|\?)/i)>0||A.search(/^data\:image\/jpeg/)===0?"image/jpeg":A.search(/\.webp($|\?)/i)>0||A.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Zc=new he;class $c{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Cc,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=-1,i=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(a)===!0;const r=a.match(/Version\/(\d+)/);n=s&&r?parseInt(r[1],10):-1,i=a.indexOf("Firefox")>-1,o=i?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&n<17||i&&o<98?this.textureLoader=new bs(this.options.manager):this.textureLoader=new Dr(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new gt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:s,userData:{}};return en(i,a,n),Ut(a,n),Promise.all(s._invokeAll(function(r){return r.afterRoot&&r.afterRoot(a)})).then(function(){for(const r of a.scenes)r.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n].joints;for(let a=0,r=o.length;a<r;a++)e[o[a]].isBone=!0}for(let n=0,i=e.length;n<i;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),i=(o,a)=>{const r=this.associations.get(o);r!=null&&this.associations.set(a,r);for(const[c,l]of o.children.entries())i(l,a.children[c])};return i(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(i,o){return s.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ae.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,o){s.load(rn.resolveURL(t.uri,n.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,i=t.byteOffset||0;return s.slice(i,i+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=xs[n.type],a=Cn[n.componentType],r=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new it(c,o,r))}const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(o){const a=o[0],r=xs[n.type],c=Cn[n.componentType],l=c.BYTES_PER_ELEMENT,h=l*r,d=n.byteOffset||0,g=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,p=n.normalized===!0;let b,f;if(g&&g!==h){const m=Math.floor(d/g),B="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+m+":"+n.count;let E=t.cache.get(B);E||(b=new c(a,m*g,n.count*g/l),E=new Mr(b,g/l),t.cache.add(B,E)),f=new on(E,r,d%g/l,p)}else a===null?b=new c(n.count*r):b=new c(a,d,n.count*r),f=new it(b,r,p);if(n.sparse!==void 0){const m=xs.SCALAR,B=Cn[n.sparse.indices.componentType],E=n.sparse.indices.byteOffset||0,w=n.sparse.values.byteOffset||0,y=new B(o[1],E,n.sparse.count*m),v=new c(o[2],w,n.sparse.count*r);a!==null&&(f=new it(f.array.slice(),f.itemSize,f.normalized)),f.normalized=!1;for(let R=0,x=y.length;R<x;R++){const T=y[R];if(f.setX(T,v[R*r]),r>=2&&f.setY(T,v[R*r+1]),r>=3&&f.setZ(T,v[R*r+2]),r>=4&&f.setW(T,v[R*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}f.normalized=p}return f})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,o=t.images[i];let a=this.textureLoader;if(o.uri){const r=s.manager.getHandler(o.uri);r!==null&&(a=r)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,s){const n=this,i=this.json,o=i.textures[e],a=i.images[t],r=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[r])return this.textureCache[r];const c=this.loadImageSource(t,s).then(function(l){l.flipY=!1,l.name=o.name||a.name||"",l.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(l.name=a.uri);const d=(i.samplers||{})[o.sampler]||{};return l.magFilter=Ki[d.magFilter]||Et,l.minFilter=Ki[d.minFilter]||Es,l.wrapS=Yi[d.wrapS]||Vt,l.wrapT=Yi[d.wrapT]||Vt,l.anisotropy=4,n.associations.set(l,{textures:e}),l}).catch(function(){return null});return this.textureCache[r]=c,c}loadImageSource(e,t){const s=this,n=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=n.images[e],a=self.URL||self.webkitURL;let r=o.uri||"",c=!1;if(o.bufferView!==void 0)r=s.getDependency("bufferView",o.bufferView).then(function(h){c=!0;const d=new Blob([h],{type:o.mimeType});return r=a.createObjectURL(d),r});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(r).then(function(h){return new Promise(function(d,g){let p=d;t.isImageBitmapLoader===!0&&(p=function(b){const f=new si(b);f.needsUpdate=!0,d(f)}),t.load(rn.resolveURL(h,i.path),p,void 0,g)})}).then(function(h){return c===!0&&a.revokeObjectURL(r),Ut(h,o),h.userData.mimeType=o.mimeType||Xc(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),h});return this.sourceCache[e]=l,l}assignTexture(e,t,s,n){const i=this;return this.getDependency("texture",s.index).then(function(o){if(!o)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(o=o.clone(),o.channel=s.texCoord),i.extensions[ae.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[ae.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const r=i.associations.get(o);o=i.extensions[ae.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,r)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let r=this.cache.get(a);r||(r=new Fn,an.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,r.sizeAttenuation=!1,this.cache.add(a,r)),s=r}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let r=this.cache.get(a);r||(r=new Pt,an.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,this.cache.add(a,r)),s=r}if(n||i||o){let a="ClonedMaterial:"+s.uuid+":";n&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let r=this.cache.get(a);r||(r=s.clone(),i&&(r.vertexColors=!0),o&&(r.flatShading=!0),n&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(a,r),this.associations.set(r,this.associations.get(s))),s=r}e.material=s}getMaterialType(){return Ii}loadMaterial(e){const t=this,s=this.json,n=this.extensions,i=s.materials[e];let o;const a={},r=i.extensions||{},c=[];if(r[ae.KHR_MATERIALS_UNLIT]){const h=n[ae.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),c.push(h.extendParams(a,i,t))}else{const h=i.pbrMetallicRoughness||{};if(a.color=new Te(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],Ze),a.opacity=d[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",h.baseColorTexture,ge)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=bi);const l=i.alphaMode||Ss.OPAQUE;if(l===Ss.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===Ss.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==Tt&&(c.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new Ne(1,1),i.normalTexture.scale!==void 0)){const h=i.normalTexture.scale;a.normalScale.set(h,h)}if(i.occlusionTexture!==void 0&&o!==Tt&&(c.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==Tt){const h=i.emissiveFactor;a.emissive=new Te().setRGB(h[0],h[1],h[2],Ze)}return i.emissiveTexture!==void 0&&o!==Tt&&c.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,ge)),Promise.all(c).then(function(){const h=new o(a);return i.name&&(h.name=i.name),Ut(h,i),t.associations.set(h,{materials:e}),i.extensions&&en(n,h,i),h})}createUniqueName(e){const t=Ct.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function i(a){return s[ae.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(r){return Ji(r,a,t)})}const o=[];for(let a=0,r=e.length;a<r;a++){const c=e[a],l=Vc(c),h=n[l];if(h)o.push(h.promise);else{let d;c.extensions&&c.extensions[ae.KHR_DRACO_MESH_COMPRESSION]?d=i(c):d=Ji(new pt,c,t),n[l]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,n=this.extensions,i=s.meshes[e],o=i.primitives,a=[];for(let r=0,c=o.length;r<c;r++){const l=o[r].material===void 0?Yc(this.cache):this.getDependency("material",o[r].material);a.push(l)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(r){const c=r.slice(0,r.length-1),l=r[r.length-1],h=[];for(let g=0,p=l.length;g<p;g++){const b=l[g],f=o[g];let m;const B=c[g];if(f.mode===dt.TRIANGLES||f.mode===dt.TRIANGLE_STRIP||f.mode===dt.TRIANGLE_FAN||f.mode===void 0)m=i.isSkinnedMesh===!0?new Ei(b,B):new z(b,B),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),f.mode===dt.TRIANGLE_STRIP?m.geometry=qi(m.geometry,Po):f.mode===dt.TRIANGLE_FAN&&(m.geometry=qi(m.geometry,ei));else if(f.mode===dt.LINES)m=new us(b,B);else if(f.mode===dt.LINE_STRIP)m=new mt(b,B);else if(f.mode===dt.LINE_LOOP)m=new kr(b,B);else if(f.mode===dt.POINTS)m=new rs(b,B);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);Object.keys(m.geometry.morphAttributes).length>0&&Wc(m,i),m.name=t.createUniqueName(i.name||"mesh_"+e),Ut(m,i),f.extensions&&en(n,m,f),t.assignFinalMaterial(m),h.push(m)}for(let g=0,p=h.length;g<p;g++)t.associations.set(h[g],{meshes:e,primitives:g});if(h.length===1)return i.extensions&&en(n,h[0],i),h[0];const d=new An;i.extensions&&en(n,d,i),t.associations.set(d,{meshes:e});for(let g=0,p=h.length;g<p;g++)d.add(h[g]);return d})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new Is(Qe.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new jo(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),Ut(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let n=0,i=t.joints.length;n<i;n++)s.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(n){const i=n.pop(),o=n,a=[],r=[];for(let c=0,l=o.length;c<l;c++){const h=o[c];if(h){a.push(h);const d=new he;i!==null&&d.fromArray(i.array,c*16),r.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new qo(a,r)})}loadAnimation(e){const t=this.json,s=this,n=t.animations[e],i=n.name?n.name:"animation_"+e,o=[],a=[],r=[],c=[],l=[];let h=0,d=n.channels.length;for(h=0,d=n.channels.length;h<d;h++){const g=n.channels[h],p=n.samplers[g.sampler],b=g.target,f=b.node,m=n.parameters!==void 0?n.parameters[p.input]:p.input,B=n.parameters!==void 0?n.parameters[p.output]:p.output;b.node!==void 0&&(o.push(this.getDependency("node",f)),a.push(this.getDependency("accessor",m)),r.push(this.getDependency("accessor",B)),c.push(p),l.push(b))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(r),Promise.all(c),Promise.all(l)]).then(function(g){const p=g[0],b=g[1],f=g[2],m=g[3],B=g[4],E=[];for(h=0,d=p.length;h<d;h++){const w=p[h],y=b[h],v=f[h],R=m[h],x=B[h];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const T=s._createAnimationTracks(w,y,v,R,x);if(T)for(let L=0;L<T.length;L++)E.push(T[L])}return new Ci(i,void 0,E)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(i){const o=s._getNodeRef(s.meshCache,n.mesh,i);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let r=0,c=n.weights.length;r<c;r++)a.morphTargetInfluences[r]=n.weights[r]}),o})}loadNode(e){const t=this.json,s=this,n=t.nodes[e],i=s._loadNodeShallow(e),o=[],a=n.children||[];for(let c=0,l=a.length;c<l;c++)o.push(s.getDependency("node",a[c]));const r=n.skin===void 0?Promise.resolve(null):s.getDependency("skin",n.skin);return Promise.all([i,Promise.all(o),r]).then(function(c){const l=c[0],h=c[1],d=c[2];d!==null&&l.traverse(function(g){g.isSkinnedMesh&&g.bind(d,Zc)});for(let g=0,p=h.length;g<p;g++)l.add(h[g]);return l})}_loadNodeShallow(e){const t=this.json,s=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=t.nodes[e],o=i.name?n.createUniqueName(i.name):"",a=[],r=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return r&&a.push(r),i.camera!==void 0&&a.push(n.getDependency("camera",i.camera).then(function(c){return n._getNodeRef(n.cameraCache,i.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let l;if(i.isBone===!0?l=new ni:c.length>1?l=new An:c.length===1?l=c[0]:l=new bt,l!==c[0])for(let h=0,d=c.length;h<d;h++)l.add(c[h]);if(i.name&&(l.userData.name=i.name,l.name=o),Ut(l,i),i.extensions&&en(s,l,i),i.matrix!==void 0){const h=new he;h.fromArray(i.matrix),l.applyMatrix4(h)}else i.translation!==void 0&&l.position.fromArray(i.translation),i.rotation!==void 0&&l.quaternion.fromArray(i.rotation),i.scale!==void 0&&l.scale.fromArray(i.scale);return n.associations.has(l)||n.associations.set(l,{}),n.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],n=this,i=new An;s.name&&(i.name=n.createUniqueName(s.name)),Ut(i,s),s.extensions&&en(t,i,s);const o=s.nodes||[],a=[];for(let r=0,c=o.length;r<c;r++)a.push(n.getDependency("node",o[r]));return Promise.all(a).then(function(r){for(let l=0,h=r.length;l<h;l++)i.add(r[l]);const c=l=>{const h=new Map;for(const[d,g]of n.associations)(d instanceof an||d instanceof si)&&h.set(d,g);return l.traverse(d=>{const g=n.associations.get(d);g!=null&&h.set(d,g)}),h};return n.associations=c(i),i})}_createAnimationTracks(e,t,s,n,i){const o=[],a=e.name?e.name:e.uuid,r=[];zt[i.path]===zt.weights?e.traverse(function(d){d.morphTargetInfluences&&r.push(d.name?d.name:d.uuid)}):r.push(a);let c;switch(zt[i.path]){case zt.weights:c=ps;break;case zt.rotation:c=fs;break;case zt.position:case zt.scale:c=gs;break;default:switch(s.itemSize){case 1:c=ps;break;case 2:case 3:default:c=gs;break}break}const l=n.interpolation!==void 0?Kc[n.interpolation]:Kn,h=this._getArrayFromAccessor(s);for(let d=0,g=r.length;d<g;d++){const p=new c(r[d]+"."+zt[i.path],t.array,h,l);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=ri(t.constructor),n=new Float32Array(t.length);for(let i=0,o=t.length;i<o;i++)n[i]=t[i]*s;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const n=this instanceof fs?zc:la;return new n(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function el(A,e,t){const s=e.attributes,n=new Cs;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],r=a.min,c=a.max;if(r!==void 0&&c!==void 0){if(n.set(new U(r[0],r[1],r[2]),new U(c[0],c[1],c[2])),a.normalized){const l=ri(Cn[a.componentType]);n.min.multiplyScalar(l),n.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const a=new U,r=new U;for(let c=0,l=i.length;c<l;c++){const h=i[c];if(h.POSITION!==void 0){const d=t.json.accessors[h.POSITION],g=d.min,p=d.max;if(g!==void 0&&p!==void 0){if(r.setX(Math.max(Math.abs(g[0]),Math.abs(p[0]))),r.setY(Math.max(Math.abs(g[1]),Math.abs(p[1]))),r.setZ(Math.max(Math.abs(g[2]),Math.abs(p[2]))),d.normalized){const b=ri(Cn[d.componentType]);r.multiplyScalar(b)}a.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}A.boundingBox=n;const o=new wi;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,A.boundingSphere=o}function Ji(A,e,t){const s=e.attributes,n=[];function i(o,a){return t.getDependency("accessor",o).then(function(r){A.setAttribute(a,r)})}for(const o in s){const a=ai[o]||o.toLowerCase();a in A.attributes||n.push(i(s[o],a))}if(e.indices!==void 0&&!A.index){const o=t.getDependency("accessor",e.indices).then(function(a){A.setIndex(a)});n.push(o)}return Xe.workingColorSpace!==Ze&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Xe.workingColorSpace}" not supported.`),Ut(A,e),el(A,e,t),Promise.all(n).then(function(){return e.targets!==void 0?Jc(A,e.targets,t):A})}var Zu=function(){var A="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),s=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n=WebAssembly.validate(t)?e:A,i,o=WebAssembly.instantiate(a(n),{}).then(function(m){i=m.instance,i.exports.__wasm_call_ctors()});function a(m){for(var B=new Uint8Array(m.length),E=0;E<m.length;++E){var w=m.charCodeAt(E);B[E]=w>96?w-97:w>64?w-39:w+4}for(var y=0,E=0;E<m.length;++E)B[y++]=B[E]<60?s[B[E]]:(B[E]-60)*64+B[++E];return B.buffer.slice(0,y)}function r(m,B,E,w,y,v){var R=i.exports.sbrk,x=E+3&-4,T=R(x*w),L=R(y.length),N=new Uint8Array(i.exports.memory.buffer);N.set(y,L);var O=m(T,E,w,L,y.length);if(O==0&&v&&v(T,x,w),B.set(N.subarray(T,T+E*w)),R(T-R(0)),O!=0)throw new Error("Malformed buffer data: "+O)}var c={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},h=[],d=0;function g(m){var B={object:new Worker(m),pending:0,requests:{}};return B.object.onmessage=function(E){var w=E.data;B.pending-=w.count,B.requests[w.id][w.action](w.value),delete B.requests[w.id]},B}function p(m){for(var B="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(n))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+r.toString()+f.toString(),E=new Blob([B],{type:"text/javascript"}),w=URL.createObjectURL(E),y=0;y<m;++y)h[y]=g(w);URL.revokeObjectURL(w)}function b(m,B,E,w,y){for(var v=h[0],R=1;R<h.length;++R)h[R].pending<v.pending&&(v=h[R]);return new Promise(function(x,T){var L=new Uint8Array(E),N=d++;v.pending+=m,v.requests[N]={resolve:x,reject:T},v.object.postMessage({id:N,count:m,size:B,source:L,mode:w,filter:y},[L.buffer])})}function f(m){o.then(function(){var B=m.data;try{var E=new Uint8Array(B.count*B.size);r(i.exports[B.mode],E,B.count,B.size,B.source,i.exports[B.filter]),self.postMessage({id:B.id,count:B.count,action:"resolve",value:E},[E.buffer])}catch(w){self.postMessage({id:B.id,count:B.count,action:"reject",value:w})}})}return{ready:o,supported:!0,useWorkers:function(m){p(m)},decodeVertexBuffer:function(m,B,E,w,y){r(i.exports.meshopt_decodeVertexBuffer,m,B,E,w,i.exports[c[y]])},decodeIndexBuffer:function(m,B,E,w){r(i.exports.meshopt_decodeIndexBuffer,m,B,E,w)},decodeIndexSequence:function(m,B,E,w){r(i.exports.meshopt_decodeIndexSequence,m,B,E,w)},decodeGltfBuffer:function(m,B,E,w,y,v){r(i.exports[l[y]],m,B,E,w,i.exports[c[v]])},decodeGltfBufferAsync:function(m,B,E,w,y){return h.length>0?b(m,B,E,l[w],c[y]):o.then(function(){var v=new Uint8Array(m*B);return r(i.exports[l[w]],v,m,B,E,i.exports[c[y]]),v})}}}();const Ts=new WeakMap;class $u extends Dt{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,n){const i=new gt(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,o=>{this.parse(o,t,n)},s,n)}parse(e,t,s=()=>{}){this.decodeDracoFile(e,t,null,null,ge,s).catch(s)}decodeDracoFile(e,t,s,n,i=Ze,o=()=>{}){const a={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:i};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const s=JSON.stringify(t);if(Ts.has(e)){const r=Ts.get(e);if(r.key===s)return r.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const i=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(i,o).then(r=>(n=r,new Promise((c,l)=>{n._callbacks[i]={resolve:c,reject:l},n.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(r=>this._createGeometry(r.geometry));return a.catch(()=>!0).then(()=>{n&&i&&this._releaseTask(n,i)}),Ts.set(e,{key:s,promise:a}),a}_createGeometry(e){const t=new pt;e.index&&t.setIndex(new it(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s],i=n.name,o=n.array,a=n.itemSize,r=new it(o,a);i==="color"&&(this._assignVertexColorSpace(r,n.vertexColorSpace),r.normalized=!(o instanceof Float32Array)),t.setAttribute(i,r)}return t}_assignVertexColorSpace(e,t){if(t!==ge)return;const s=new Te;for(let n=0,i=e.count;n<i;n++)s.fromBufferAttribute(e,n),Xe.toWorkingColorSpace(s,ge),e.setXYZ(n,s.r,s.g,s.b)}_loadLibrary(e,t){const s=new gt(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((n,i)=>{s.load(e,n,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(s=>{const n=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const i=tl.toString(),o=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(i){const o=i.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,i){return n._taskLoad>i._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function tl(){let A,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":A=a.decoderConfig,e=new Promise(function(l){A.onModuleLoaded=function(h){l({draco:h})},DracoDecoderModule(A)});break;case"decode":const r=a.buffer,c=a.taskConfig;e.then(l=>{const h=l.draco,d=new h.Decoder;try{const g=t(h,d,new Int8Array(r),c),p=g.attributes.map(b=>b.array.buffer);g.index&&p.push(g.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:g},p)}catch(g){console.error(g),self.postMessage({type:"error",id:a.id,error:g.message})}finally{h.destroy(d)}});break}};function t(o,a,r,c){const l=c.attributeIDs,h=c.attributeTypes;let d,g;const p=a.GetEncodedGeometryType(r);if(p===o.TRIANGULAR_MESH)d=new o.Mesh,g=a.DecodeArrayToMesh(r,r.byteLength,d);else if(p===o.POINT_CLOUD)d=new o.PointCloud,g=a.DecodeArrayToPointCloud(r,r.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!g.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+g.error_msg());const b={index:null,attributes:[]};for(const f in l){const m=self[h[f]];let B,E;if(c.useUniqueIDs)E=l[f],B=a.GetAttributeByUniqueId(d,E);else{if(E=a.GetAttributeId(d,o[l[f]]),E===-1)continue;B=a.GetAttribute(d,E)}const w=n(o,a,d,f,m,B);f==="color"&&(w.vertexColorSpace=c.vertexColorSpace),b.attributes.push(w)}return p===o.TRIANGULAR_MESH&&(b.index=s(o,a,d)),o.destroy(d),b}function s(o,a,r){const l=r.num_faces()*3,h=l*4,d=o._malloc(h);a.GetTrianglesUInt32Array(r,h,d);const g=new Uint32Array(o.HEAPF32.buffer,d,l).slice();return o._free(d),{array:g,itemSize:1}}function n(o,a,r,c,l,h){const d=h.num_components(),p=r.num_points()*d,b=p*l.BYTES_PER_ELEMENT,f=i(o,l),m=o._malloc(b);a.GetAttributeDataArrayForAllPoints(r,h,f,b,m);const B=new l(o.HEAPF32.buffer,m,p).slice();return o._free(m),{name:c,array:B,itemSize:d}}function i(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class nl{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:n,msg:i,transfer:o}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(i,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(s=>{const n=this._getIdleWorker();n!==-1?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=s,this.workers[n].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const sl=0,Wi=2,il=1,Vi=2,ol=0,al=1,rl=10,Al=0,ha=9,ua=15,da=16,ga=22,pa=37,fa=43,ma=76,Ia=83,ba=97,Ea=100,Ca=103,Ba=109,wa=165,ya=166,Qa=1000066e3;class cl{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Sn{constructor(e,t,s,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const s=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,n)}}const ze=[171,75,84,88,32,50,48,187,13,10,26,10];function Xi(A){return new TextDecoder().decode(A)}function ll(A){const e=new Uint8Array(A.buffer,A.byteOffset,ze.length);if(e[0]!==ze[0]||e[1]!==ze[1]||e[2]!==ze[2]||e[3]!==ze[3]||e[4]!==ze[4]||e[5]!==ze[5]||e[6]!==ze[6]||e[7]!==ze[7]||e[8]!==ze[8]||e[9]!==ze[9]||e[10]!==ze[10]||e[11]!==ze[11])throw new Error("Missing KTX 2.0 identifier.");const t=new cl,s=17*Uint32Array.BYTES_PER_ELEMENT,n=new Sn(A,ze.length,s,!0);t.vkFormat=n._nextUint32(),t.typeSize=n._nextUint32(),t.pixelWidth=n._nextUint32(),t.pixelHeight=n._nextUint32(),t.pixelDepth=n._nextUint32(),t.layerCount=n._nextUint32(),t.faceCount=n._nextUint32();const i=n._nextUint32();t.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),r=n._nextUint32(),c=n._nextUint32(),l=n._nextUint64(),h=n._nextUint64(),d=new Sn(A,ze.length+s,3*i*8,!0);for(let K=0;K<i;K++)t.levels.push({levelData:new Uint8Array(A.buffer,A.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const g=new Sn(A,o,a,!0),p={vendorId:g._skip(4)._nextUint16(),descriptorType:g._nextUint16(),versionNumber:g._nextUint16(),descriptorBlockSize:g._nextUint16(),colorModel:g._nextUint8(),colorPrimaries:g._nextUint8(),transferFunction:g._nextUint8(),flags:g._nextUint8(),texelBlockDimension:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],bytesPlane:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],samples:[]},b=(p.descriptorBlockSize/4-6)/4;for(let K=0;K<b;K++){const te={bitOffset:g._nextUint16(),bitLength:g._nextUint8(),channelType:g._nextUint8(),samplePosition:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&te.channelType?(te.sampleLower=g._nextInt32(),te.sampleUpper=g._nextInt32()):(te.sampleLower=g._nextUint32(),te.sampleUpper=g._nextUint32()),p.samples[K]=te}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(p);const f=new Sn(A,r,c,!0);for(;f._offset<c;){const K=f._nextUint32(),te=f._scan(K),ne=Xi(te);if(t.keyValue[ne]=f._nextUint8Array(K-te.byteLength-1),ne.match(/^ktx/i)){const oe=Xi(t.keyValue[ne]);t.keyValue[ne]=oe.substring(0,oe.lastIndexOf("\0"))}f._skip(K%4?4-K%4:0)}if(h<=0)return t;const m=new Sn(A,l,h,!0),B=m._nextUint16(),E=m._nextUint16(),w=m._nextUint32(),y=m._nextUint32(),v=m._nextUint32(),R=m._nextUint32(),x=[];for(let K=0;K<i;K++)x.push({imageFlags:m._nextUint32(),rgbSliceByteOffset:m._nextUint32(),rgbSliceByteLength:m._nextUint32(),alphaSliceByteOffset:m._nextUint32(),alphaSliceByteLength:m._nextUint32()});const T=l+m._offset,L=T+w,N=L+y,O=N+v,$=new Uint8Array(A.buffer,A.byteOffset+T,w),G=new Uint8Array(A.buffer,A.byteOffset+L,y),q=new Uint8Array(A.buffer,A.byteOffset+N,v),H=new Uint8Array(A.buffer,A.byteOffset+O,R);return t.globalData={endpointCount:B,selectorCount:E,imageDescs:x,endpointsData:$,selectorsData:G,tablesData:q,extendedData:H},t}let _s,Nt,Ai;const Rs={env:{emscripten_notify_memory_growth:function(A){Ai=new Uint8Array(Nt.exports.memory.buffer)}}};class hl{init(){return _s||(_s=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Zi).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Rs)).then(this._init):WebAssembly.instantiate(Buffer.from(Zi,"base64"),Rs).then(this._init),_s)}_init(e){Nt=e.instance,Rs.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Nt)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,n=Nt.exports.malloc(s);Ai.set(e,n),t=t||Number(Nt.exports.ZSTD_findDecompressedSize(n,s));const i=Nt.exports.malloc(t),o=Nt.exports.ZSTD_decompress(i,t,n,s),a=Ai.slice(i,i+o);return Nt.exports.free(n),Nt.exports.free(i),a}}const Zi="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",Ds=new WeakMap;let Ms=0,ks;class Gt extends Dt{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new nl,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new gt(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new gt(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const n=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([i,o])=>{const a=Gt.BasisWorker.toString(),r=["/* constants */","let _EngineFormat = "+JSON.stringify(Gt.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Gt.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Gt.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),l=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:l},[l]),c})}),Ms>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Ms++}return this.transcoderPending}load(e,t,s,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new gt(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials),i.load(e,o=>{this.parse(o,t,n)},s,n)}parse(e,t,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Ds.has(e))return Ds.get(e).promise.then(t).catch(s);this._createTexture(e).then(n=>t?t(n):null).catch(s)}_createTextureFrom(e,t){const{faces:s,width:n,height:i,format:o,type:a,error:r,dfdFlags:c}=e;if(a==="error")return Promise.reject(r);let l;if(t.faceCount===6)l=new Lr(s,o,It);else{const h=s[0].mipmaps;l=t.layerCount>1?new Nr(h,n,i,t.layerCount,o,It):new Hn(h,n,i,o,It)}return l.minFilter=s[0].mipmaps.length===1?Et:Es,l.magFilter=Et,l.generateMipmaps=!1,l.needsUpdate=!0,l.colorSpace=xa(t),l.premultiplyAlpha=!!(c&il),l}async _createTexture(e,t={}){const s=ll(new Uint8Array(e));if(s.vkFormat!==Al)return dl(s);const n=t,i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(o=>this._createTextureFrom(o.data,s));return Ds.set(e,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Ms--,this}}Gt.BasisFormat={ETC1S:0,UASTC_4x4:1};Gt.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Gt.EngineFormat={RGBAFormat:Wt,RGBA_ASTC_4x4_Format:Xo,RGBA_BPTC_Format:Ur,RGBA_ETC2_EAC_Format:Gr,RGBA_PVRTC_4BPPV1_Format:Pr,RGBA_S3TC_DXT5_Format:Or,RGB_ETC1_Format:Hr,RGB_ETC2_Format:jr,RGB_PVRTC_4BPPV1_Format:qr,RGBA_S3TC_DXT1_Format:zr};Gt.BasisWorker=function(){let A,e,t;const s=_EngineFormat,n=_TranscoderFormat,i=_BasisFormat;self.addEventListener("message",function(p){const b=p.data;switch(b.type){case"init":A=b.config,o(b.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:f,buffers:m,width:B,height:E,hasAlpha:w,format:y,dfdFlags:v}=a(b.buffer);self.postMessage({type:"transcode",id:b.id,faces:f,width:B,height:E,hasAlpha:w,format:y,dfdFlags:v},m)}catch(f){console.error(f),self.postMessage({type:"error",id:b.id,error:f.message})}});break}});function o(p){e=new Promise(b=>{t={wasmBinary:p,onRuntimeInitialized:b},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(p){const b=new t.KTX2File(new Uint8Array(p));function f(){b.close(),b.delete()}if(!b.isValid())throw f(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const m=b.isUASTC()?i.UASTC_4x4:i.ETC1S,B=b.getWidth(),E=b.getHeight(),w=b.getLayers()||1,y=b.getLevels(),v=b.getFaces(),R=b.getHasAlpha(),x=b.getDFDFlags(),{transcoderFormat:T,engineFormat:L}=h(m,B,E,R);if(!B||!E||!y)throw f(),new Error("THREE.KTX2Loader:	Invalid texture");if(!b.startTranscoding())throw f(),new Error("THREE.KTX2Loader: .startTranscoding failed");const N=[],O=[];for(let $=0;$<v;$++){const G=[];for(let q=0;q<y;q++){const H=[];let K,te;for(let oe=0;oe<w;oe++){const ue=b.getImageLevelInfo(q,oe,$);$===0&&q===0&&oe===0&&(ue.origWidth%4!==0||ue.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),y>1?(K=ue.origWidth,te=ue.origHeight):(K=ue.width,te=ue.height);const Ae=new Uint8Array(b.getImageTranscodedSizeInBytes(q,oe,0,T));if(!b.transcodeImage(Ae,q,oe,$,T,0,-1,-1))throw f(),new Error("THREE.KTX2Loader: .transcodeImage failed.");H.push(Ae)}const ne=g(H);G.push({data:ne,width:K,height:te}),O.push(ne.buffer)}N.push({mipmaps:G,width:B,height:E,format:L})}return f(),{faces:N,buffers:O,width:B,height:E,hasAlpha:R,format:L,dfdFlags:x}}const r=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=r.sort(function(p,b){return p.priorityETC1S-b.priorityETC1S}),l=r.sort(function(p,b){return p.priorityUASTC-b.priorityUASTC});function h(p,b,f,m){let B,E;const w=p===i.ETC1S?c:l;for(let y=0;y<w.length;y++){const v=w[y];if(A[v.if]&&v.basisFormat.includes(p)&&!(m&&v.transcoderFormat.length<2)&&!(v.needsPowerOfTwo&&!(d(b)&&d(f))))return B=v.transcoderFormat[m?1:0],E=v.engineFormat[m?1:0],{transcoderFormat:B,engineFormat:E}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),B=n.RGBA32,E=s.RGBAFormat,{transcoderFormat:B,engineFormat:E}}function d(p){return p<=2?!0:(p&p-1)===0&&p!==0}function g(p){if(p.length===1)return p[0];let b=0;for(let B=0;B<p.length;B++){const E=p[B];b+=E.byteLength}const f=new Uint8Array(b);let m=0;for(let B=0;B<p.length;B++){const E=p[B];f.set(E,m),m+=E.byteLength}return f}};const ul=new Set([Wt,Ln,mn]),Fs={[Ba]:Wt,[ba]:Wt,[pa]:Wt,[fa]:Wt,[Ca]:Ln,[Ia]:Ln,[da]:Ln,[ga]:Ln,[Ea]:mn,[ma]:mn,[ua]:mn,[ha]:mn,[Qa]:Xo,[ya]:Li,[wa]:Li},Ls={[Ba]:_t,[ba]:ot,[pa]:It,[fa]:It,[Ca]:_t,[Ia]:ot,[da]:It,[ga]:It,[Ea]:_t,[ma]:ot,[ua]:It,[ha]:It,[Qa]:ot,[ya]:It,[wa]:It};async function dl(A){const{vkFormat:e}=A;if(Fs[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;A.supercompressionScheme===Wi&&(ks||(ks=new Promise(async i=>{const o=new hl;await o.init(),i(o)})),t=await ks);const s=[];for(let i=0;i<A.levels.length;i++){const o=Math.max(1,A.pixelWidth>>i),a=Math.max(1,A.pixelHeight>>i),r=A.pixelDepth?Math.max(1,A.pixelDepth>>i):0,c=A.levels[i];let l;if(A.supercompressionScheme===sl)l=c.levelData;else if(A.supercompressionScheme===Wi)l=t.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let h;Ls[e]===_t?h=new Float32Array(l.buffer,l.byteOffset,l.byteLength/Float32Array.BYTES_PER_ELEMENT):Ls[e]===ot?h=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/Uint16Array.BYTES_PER_ELEMENT):h=l,s.push({data:h,width:o,height:a,depth:r})}let n;if(ul.has(Fs[e]))n=A.pixelDepth===0?new Kr(s[0].data,A.pixelWidth,A.pixelHeight):new Yr(s[0].data,A.pixelWidth,A.pixelHeight,A.pixelDepth);else{if(A.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new Hn(s,A.pixelWidth,A.pixelHeight)}return n.mipmaps=s,n.type=Ls[e],n.format=Fs[e],n.colorSpace=xa(A),n.needsUpdate=!0,Promise.resolve(n)}function xa(A){const e=A.dataFormatDescriptor[0];return e.colorPrimaries===al?e.transferFunction===Vi?ge:Ze:e.colorPrimaries===rl?e.transferFunction===Vi?Jr:Wr:e.colorPrimaries===ol?ms:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),ms)}class ed extends Vr{constructor(e,t={}){const s=t.font;if(s===void 0)super();else{const n=s.generateShapes(e,t.size);t.depth===void 0&&t.height!==void 0&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),t.depth=t.depth!==void 0?t.depth:t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(n,t)}this.type="TextGeometry"}}class td extends Dt{constructor(e){super(e)}load(e,t,s,n){const i=this,o=new gt(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){const r=i.parse(JSON.parse(a));t&&t(r)},s,n)}parse(e){return new gl(e)}}class gl{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const s=[],n=pl(e,t,this.data);for(let i=0,o=n.length;i<o;i++)s.push(...n[i].toShapes());return s}}function pl(A,e,t){const s=Array.from(A),n=e/t.resolution,i=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*n,o=[];let a=0,r=0;for(let c=0;c<s.length;c++){const l=s[c];if(l===`
`)a=0,r-=i;else{const h=fl(l,n,a,r,t);a+=h.offsetX,o.push(h.path)}}return o}function fl(A,e,t,s,n){const i=n.glyphs[A]||n.glyphs["?"];if(!i){console.error('THREE.Font: character "'+A+'" does not exists in font family '+n.familyName+".");return}const o=new Xr;let a,r,c,l,h,d,g,p;if(i.o){const b=i._cachedOutline||(i._cachedOutline=i.o.split(" "));for(let f=0,m=b.length;f<m;)switch(b[f++]){case"m":a=b[f++]*e+t,r=b[f++]*e+s,o.moveTo(a,r);break;case"l":a=b[f++]*e+t,r=b[f++]*e+s,o.lineTo(a,r);break;case"q":c=b[f++]*e+t,l=b[f++]*e+s,h=b[f++]*e+t,d=b[f++]*e+s,o.quadraticCurveTo(h,d,c,l);break;case"b":c=b[f++]*e+t,l=b[f++]*e+s,h=b[f++]*e+t,d=b[f++]*e+s,g=b[f++]*e+t,p=b[f++]*e+s,o.bezierCurveTo(h,d,g,p,c,l);break}}return{offsetX:i.ha*e,path:o}}const tn=new yi,je=new U,Kt=new U,ye=new xe,$i={X:new U(1,0,0),Y:new U(0,1,0),Z:new U(0,0,1)},Ns={type:"change"},eo={type:"mouseDown",mode:null},to={type:"mouseUp",mode:null},no={type:"objectChange"};class nd extends Zo{constructor(e,t=null){super(void 0,t);const s=new Bl(this);this._root=s;const n=new wl;this._gizmo=n,s.add(n);const i=new yl;this._plane=i,s.add(i);const o=this;function a(E,w){let y=w;Object.defineProperty(o,E,{get:function(){return y!==void 0?y:w},set:function(v){y!==v&&(y=v,i[E]=v,n[E]=v,o.dispatchEvent({type:E+"-changed",value:v}),o.dispatchEvent(Ns))}}),o[E]=w,i[E]=w,n[E]=w}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const r=new U,c=new U,l=new xe,h=new xe,d=new U,g=new xe,p=new U,b=new U,f=new U,m=0,B=new U;a("worldPosition",r),a("worldPositionStart",c),a("worldQuaternion",l),a("worldQuaternionStart",h),a("cameraPosition",d),a("cameraQuaternion",g),a("pointStart",p),a("pointEnd",b),a("rotationAxis",f),a("rotationAngle",m),a("eye",B),this._offset=new U,this._startNorm=new U,this._endNorm=new U,this._cameraScale=new U,this._parentPosition=new U,this._parentQuaternion=new xe,this._parentQuaternionInv=new xe,this._parentScale=new U,this._worldScaleStart=new U,this._worldQuaternionInv=new xe,this._worldScale=new U,this._positionStart=new U,this._quaternionStart=new xe,this._scaleStart=new U,this._getPointer=ml.bind(this),this._onPointerDown=bl.bind(this),this._onPointerHover=Il.bind(this),this._onPointerMove=El.bind(this),this._onPointerUp=Cl.bind(this),t!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&tn.setFromCamera(e,this.camera);const t=Us(this._gizmo.picker[this.mode],tn);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&tn.setFromCamera(e,this.camera);const t=Us(this._plane,tn,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,eo.mode=this.mode,this.dispatchEvent(eo)}}pointerMove(e){const t=this.axis,s=this.mode,n=this.object;let i=this.space;if(s==="scale"?i="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(i="world"),n===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&tn.setFromCamera(e,this.camera);const o=Us(this._plane,tn,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),i==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),i==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(i==="local"&&(n.position.applyQuaternion(ye.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),i==="world"&&(n.parent&&n.position.add(je.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(je.setFromMatrixPosition(n.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Kt.set(a,a,a)}else je.copy(this.pointStart),Kt.copy(this.pointEnd),je.applyQuaternion(this._worldQuaternionInv),Kt.applyQuaternion(this._worldQuaternionInv),Kt.divide(je),t.search("X")===-1&&(Kt.x=1),t.search("Y")===-1&&(Kt.y=1),t.search("Z")===-1&&(Kt.z=1);n.scale.copy(this._scaleStart).multiply(Kt),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(je.setFromMatrixPosition(this.camera.matrixWorld));let r=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(je.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy($i[t]),je.copy($i[t]),i==="local"&&je.applyQuaternion(this.worldQuaternion),je.cross(this.eye),je.length()===0?r=!0:this.rotationAngle=this._offset.dot(je.normalize())*a),(t==="E"||r)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),i==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(ye.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(ye.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ns),this.dispatchEvent(no)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(to.mode=this.mode,this.dispatchEvent(to)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ns),this.dispatchEvent(no),this.pointStart.copy(this.pointEnd))}getRaycaster(){return tn}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function ml(A){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:A.button};{const e=this.domElement.getBoundingClientRect();return{x:(A.clientX-e.left)/e.width*2-1,y:-(A.clientY-e.top)/e.height*2+1,button:A.button}}}function Il(A){if(this.enabled)switch(A.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(A));break}}function bl(A){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(A.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(A)),this.pointerDown(this._getPointer(A)))}function El(A){this.enabled&&this.pointerMove(this._getPointer(A))}function Cl(A){this.enabled&&(this.domElement.releasePointerCapture(A.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(A)))}function Us(A,e,t){const s=e.intersectObject(A,!0);for(let n=0;n<s.length;n++)if(s[n].object.visible||t)return s[n];return!1}const Xn=new Jt,Ie=new U(0,1,0),so=new U(0,0,0),io=new he,Zn=new xe,ls=new xe,wt=new U,oo=new he,Nn=new U(1,0,0),sn=new U(0,1,0),Un=new U(0,0,1),$n=new U,vn=new U,Tn=new U;class Bl extends bt{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}}class wl extends bt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Tt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Pt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const n=t.clone();n.opacity=.5;const i=e.clone();i.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const r=e.clone();r.color.setHex(16711680),r.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const l=e.clone();l.color.setHex(255),l.opacity=.5;const h=e.clone();h.opacity=.25;const d=e.clone();d.color.setHex(16776960),d.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const b=new Je(0,.04,.1,12);b.translate(0,.05,0);const f=new qe(.08,.08,.08);f.translate(0,.04,0);const m=new pt;m.setAttribute("position",new Fe([0,0,0,1,0,0],3));const B=new Je(.0075,.0075,.5,3);B.translate(0,.25,0);function E(q,H){const K=new yn(q,.0075,3,64,H*Math.PI*2);return K.rotateY(Math.PI/2),K.rotateX(Math.PI/2),K}function w(){const q=new pt;return q.setAttribute("position",new Fe([0,0,0,1,1,1],3)),q}const y={X:[[new z(b,i),[.5,0,0],[0,0,-Math.PI/2]],[new z(b,i),[-.5,0,0],[0,0,Math.PI/2]],[new z(B,i),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new z(b,o),[0,.5,0]],[new z(b,o),[0,-.5,0],[Math.PI,0,0]],[new z(B,o)]],Z:[[new z(b,a),[0,0,.5],[Math.PI/2,0,0]],[new z(b,a),[0,0,-.5],[-Math.PI/2,0,0]],[new z(B,a),null,[Math.PI/2,0,0]]],XYZ:[[new z(new Vn(.1,0),h.clone()),[0,0,0]]],XY:[[new z(new qe(.15,.15,.01),l.clone()),[.15,.15,0]]],YZ:[[new z(new qe(.15,.15,.01),r.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new z(new qe(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},v={X:[[new z(new Je(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new z(new Je(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new z(new Je(.2,0,.6,4),s),[0,.3,0]],[new z(new Je(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new z(new Je(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new z(new Je(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new z(new Vn(.2,0),s)]],XY:[[new z(new qe(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new z(new qe(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new z(new qe(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},R={START:[[new z(new Vn(.01,2),n),null,null,null,"helper"]],END:[[new z(new Vn(.01,2),n),null,null,null,"helper"]],DELTA:[[new mt(w(),n),null,null,null,"helper"]],X:[[new mt(m,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new mt(m,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new mt(m,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},x={XYZE:[[new z(E(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new z(E(.5,.5),i)]],Y:[[new z(E(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new z(E(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new z(E(.75,1),d),null,[0,Math.PI/2,0]]]},T={AXIS:[[new mt(m,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={XYZE:[[new z(new fi(.25,10,8),s)]],X:[[new z(new yn(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new z(new yn(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new z(new yn(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new z(new yn(.75,.1,2,24),s)]]},N={X:[[new z(f,i),[.5,0,0],[0,0,-Math.PI/2]],[new z(B,i),[0,0,0],[0,0,-Math.PI/2]],[new z(f,i),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new z(f,o),[0,.5,0]],[new z(B,o)],[new z(f,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new z(f,a),[0,0,.5],[Math.PI/2,0,0]],[new z(B,a),[0,0,0],[Math.PI/2,0,0]],[new z(f,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new z(new qe(.15,.15,.01),l),[.15,.15,0]]],YZ:[[new z(new qe(.15,.15,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new z(new qe(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new z(new qe(.1,.1,.1),h.clone())]]},O={X:[[new z(new Je(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new z(new Je(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new z(new Je(.2,0,.6,4),s),[0,.3,0]],[new z(new Je(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new z(new Je(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new z(new Je(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new z(new qe(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new z(new qe(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new z(new qe(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new z(new qe(.2,.2,.2),s),[0,0,0]]]},$={X:[[new mt(m,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new mt(m,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new mt(m,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function G(q){const H=new bt;for(const K in q)for(let te=q[K].length;te--;){const ne=q[K][te][0].clone(),oe=q[K][te][1],ue=q[K][te][2],Ae=q[K][te][3],de=q[K][te][4];ne.name=K,ne.tag=de,oe&&ne.position.set(oe[0],oe[1],oe[2]),ue&&ne.rotation.set(ue[0],ue[1],ue[2]),Ae&&ne.scale.set(Ae[0],Ae[1],Ae[2]),ne.updateMatrix();const Se=ne.geometry.clone();Se.applyMatrix4(ne.matrix),ne.geometry=Se,ne.renderOrder=1/0,ne.position.set(0,0,0),ne.rotation.set(0,0,0),ne.scale.set(1,1,1),H.add(ne)}return H}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=G(y)),this.add(this.gizmo.rotate=G(x)),this.add(this.gizmo.scale=G(N)),this.add(this.picker.translate=G(v)),this.add(this.picker.rotate=G(L)),this.add(this.picker.scale=G(O)),this.add(this.helper.translate=G(R)),this.add(this.helper.rotate=G(T)),this.add(this.helper.scale=G($)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const s=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ls;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const o=n[i];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(ye.setFromEuler(Xn.set(0,0,0)),o.quaternion.copy(s).multiply(ye),Math.abs(Ie.copy(Nn).applyQuaternion(s).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(ye.setFromEuler(Xn.set(0,0,Math.PI/2)),o.quaternion.copy(s).multiply(ye),Math.abs(Ie.copy(sn).applyQuaternion(s).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(ye.setFromEuler(Xn.set(0,Math.PI/2,0)),o.quaternion.copy(s).multiply(ye),Math.abs(Ie.copy(Un).applyQuaternion(s).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(ye.setFromEuler(Xn.set(0,Math.PI/2,0)),Ie.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(io.lookAt(so,Ie,sn)),o.quaternion.multiply(ye),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),je.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),je.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(je),o.visible=this.dragging):(o.quaternion.copy(s),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(s),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Ie.copy(Nn).applyQuaternion(s).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Ie.copy(sn).applyQuaternion(s).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Ie.copy(Un).applyQuaternion(s).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Ie.copy(Un).applyQuaternion(s).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Ie.copy(Nn).applyQuaternion(s).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Ie.copy(sn).applyQuaternion(s).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Zn.copy(s),Ie.copy(this.eye).applyQuaternion(ye.copy(s).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(io.lookAt(this.eye,so,sn)),o.name==="X"&&(ye.setFromAxisAngle(Nn,Math.atan2(-Ie.y,Ie.z)),ye.multiplyQuaternions(Zn,ye),o.quaternion.copy(ye)),o.name==="Y"&&(ye.setFromAxisAngle(sn,Math.atan2(Ie.x,Ie.z)),ye.multiplyQuaternions(Zn,ye),o.quaternion.copy(ye)),o.name==="Z"&&(ye.setFromAxisAngle(Un,Math.atan2(Ie.y,Ie.x)),ye.multiplyQuaternions(Zn,ye),o.quaternion.copy(ye))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(r){return o.name===r}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class yl extends z{constructor(){super(new Qi(1e5,1e5,2,2),new Tt({visible:!1,wireframe:!0,side:bi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),$n.copy(Nn).applyQuaternion(t==="local"?this.worldQuaternion:ls),vn.copy(sn).applyQuaternion(t==="local"?this.worldQuaternion:ls),Tn.copy(Un).applyQuaternion(t==="local"?this.worldQuaternion:ls),Ie.copy(vn),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ie.copy(this.eye).cross($n),wt.copy($n).cross(Ie);break;case"Y":Ie.copy(this.eye).cross(vn),wt.copy(vn).cross(Ie);break;case"Z":Ie.copy(this.eye).cross(Tn),wt.copy(Tn).cross(Ie);break;case"XY":wt.copy(Tn);break;case"YZ":wt.copy($n);break;case"XZ":Ie.copy(Tn),wt.copy(vn);break;case"XYZ":case"E":wt.set(0,0,0);break}break;case"rotate":default:wt.set(0,0,0)}wt.length()===0?this.quaternion.copy(this.cameraQuaternion):(oo.lookAt(je.set(0,0,0),wt,Ie),this.quaternion.setFromRotationMatrix(oo)),super.updateMatrixWorld(e)}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Re=Uint8Array,at=Uint16Array,xi=Int32Array,Bs=new Re([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ws=new Re([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ci=new Re([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sa=function(A,e){for(var t=new at(31),s=0;s<31;++s)t[s]=e+=1<<A[s-1];for(var n=new xi(t[30]),s=1;s<30;++s)for(var i=t[s];i<t[s+1];++i)n[i]=i-t[s]<<5|s;return{b:t,r:n}},va=Sa(Bs,2),Ta=va.b,li=va.r;Ta[28]=258,li[258]=28;var _a=Sa(ws,0),Ql=_a.b,ao=_a.r,hi=new at(32768);for(var we=0;we<32768;++we){var Yt=(we&43690)>>1|(we&21845)<<1;Yt=(Yt&52428)>>2|(Yt&13107)<<2,Yt=(Yt&61680)>>4|(Yt&3855)<<4,hi[we]=((Yt&65280)>>8|(Yt&255)<<8)>>1}var Rt=function(A,e,t){for(var s=A.length,n=0,i=new at(e);n<s;++n)A[n]&&++i[A[n]-1];var o=new at(e);for(n=1;n<e;++n)o[n]=o[n-1]+i[n-1]<<1;var a;if(t){a=new at(1<<e);var r=15-e;for(n=0;n<s;++n)if(A[n])for(var c=n<<4|A[n],l=e-A[n],h=o[A[n]-1]++<<l,d=h|(1<<l)-1;h<=d;++h)a[hi[h]>>r]=c}else for(a=new at(s),n=0;n<s;++n)A[n]&&(a[n]=hi[o[A[n]-1]++]>>15-A[n]);return a},Xt=new Re(288);for(var we=0;we<144;++we)Xt[we]=8;for(var we=144;we<256;++we)Xt[we]=9;for(var we=256;we<280;++we)Xt[we]=7;for(var we=280;we<288;++we)Xt[we]=8;var qn=new Re(32);for(var we=0;we<32;++we)qn[we]=5;var xl=Rt(Xt,9,0),Sl=Rt(Xt,9,1),vl=Rt(qn,5,0),Tl=Rt(qn,5,1),Gs=function(A){for(var e=A[0],t=1;t<A.length;++t)A[t]>e&&(e=A[t]);return e},ft=function(A,e,t){var s=e/8|0;return(A[s]|A[s+1]<<8)>>(e&7)&t},Ps=function(A,e){var t=e/8|0;return(A[t]|A[t+1]<<8|A[t+2]<<16)>>(e&7)},Si=function(A){return(A+7)/8|0},vi=function(A,e,t){return(e==null||e<0)&&(e=0),(t==null||t>A.length)&&(t=A.length),new Re(A.subarray(e,t))},_l=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ve=function(A,e,t){var s=new Error(e||_l[A]);if(s.code=A,Error.captureStackTrace&&Error.captureStackTrace(s,Ve),!t)throw s;return s},Rl=function(A,e,t,s){var n=A.length,i=s?s.length:0;if(!n||e.f&&!e.l)return t||new Re(0);var o=!t,a=o||e.i!=2,r=e.i;o&&(t=new Re(n*3));var c=function(Ht){var Zt=t.length;if(Ht>Zt){var kt=new Re(Math.max(Zt*2,Ht));kt.set(t),t=kt}},l=e.f||0,h=e.p||0,d=e.b||0,g=e.l,p=e.d,b=e.m,f=e.n,m=n*8;do{if(!g){l=ft(A,h,1);var B=ft(A,h+1,3);if(h+=3,B)if(B==1)g=Sl,p=Tl,b=9,f=5;else if(B==2){var v=ft(A,h,31)+257,R=ft(A,h+10,15)+4,x=v+ft(A,h+5,31)+1;h+=14;for(var T=new Re(x),L=new Re(19),N=0;N<R;++N)L[ci[N]]=ft(A,h+N*3,7);h+=R*3;for(var O=Gs(L),$=(1<<O)-1,G=Rt(L,O,1),N=0;N<x;){var q=G[ft(A,h,$)];h+=q&15;var E=q>>4;if(E<16)T[N++]=E;else{var H=0,K=0;for(E==16?(K=3+ft(A,h,3),h+=2,H=T[N-1]):E==17?(K=3+ft(A,h,7),h+=3):E==18&&(K=11+ft(A,h,127),h+=7);K--;)T[N++]=H}}var te=T.subarray(0,v),ne=T.subarray(v);b=Gs(te),f=Gs(ne),g=Rt(te,b,1),p=Rt(ne,f,1)}else Ve(1);else{var E=Si(h)+4,w=A[E-4]|A[E-3]<<8,y=E+w;if(y>n){r&&Ve(0);break}a&&c(d+w),t.set(A.subarray(E,y),d),e.b=d+=w,e.p=h=y*8,e.f=l;continue}if(h>m){r&&Ve(0);break}}a&&c(d+131072);for(var oe=(1<<b)-1,ue=(1<<f)-1,Ae=h;;Ae=h){var H=g[Ps(A,h)&oe],de=H>>4;if(h+=H&15,h>m){r&&Ve(0);break}if(H||Ve(2),de<256)t[d++]=de;else if(de==256){Ae=h,g=null;break}else{var Se=de-254;if(de>264){var N=de-257,Ee=Bs[N];Se=ft(A,h,(1<<Ee)-1)+Ta[N],h+=Ee}var ce=p[Ps(A,h)&ue],$e=ce>>4;ce||Ve(3),h+=ce&15;var ne=Ql[$e];if($e>3){var Ee=ws[$e];ne+=Ps(A,h)&(1<<Ee)-1,h+=Ee}if(h>m){r&&Ve(0);break}a&&c(d+131072);var et=d+Se;if(d<ne){var ln=i-ne,hn=Math.min(ne,et);for(ln+d<0&&Ve(3);d<hn;++d)t[d]=s[ln+d]}for(;d<et;++d)t[d]=t[d-ne]}}e.l=g,e.p=Ae,e.b=d,e.f=l,g&&(l=1,e.m=b,e.d=p,e.n=f)}while(!l);return d!=t.length&&o?vi(t,0,d):t.subarray(0,d)},Lt=function(A,e,t){t<<=e&7;var s=e/8|0;A[s]|=t,A[s+1]|=t>>8},_n=function(A,e,t){t<<=e&7;var s=e/8|0;A[s]|=t,A[s+1]|=t>>8,A[s+2]|=t>>16},Os=function(A,e){for(var t=[],s=0;s<A.length;++s)A[s]&&t.push({s,f:A[s]});var n=t.length,i=t.slice();if(!n)return{t:Da,l:0};if(n==1){var o=new Re(t[0].s+1);return o[t[0].s]=1,{t:o,l:1}}t.sort(function(y,v){return y.f-v.f}),t.push({s:-1,f:25001});var a=t[0],r=t[1],c=0,l=1,h=2;for(t[0]={s:-1,f:a.f+r.f,l:a,r};l!=n-1;)a=t[t[c].f<t[h].f?c++:h++],r=t[c!=l&&t[c].f<t[h].f?c++:h++],t[l++]={s:-1,f:a.f+r.f,l:a,r};for(var d=i[0].s,s=1;s<n;++s)i[s].s>d&&(d=i[s].s);var g=new at(d+1),p=ui(t[l-1],g,0);if(p>e){var s=0,b=0,f=p-e,m=1<<f;for(i.sort(function(v,R){return g[R.s]-g[v.s]||v.f-R.f});s<n;++s){var B=i[s].s;if(g[B]>e)b+=m-(1<<p-g[B]),g[B]=e;else break}for(b>>=f;b>0;){var E=i[s].s;g[E]<e?b-=1<<e-g[E]++-1:++s}for(;s>=0&&b;--s){var w=i[s].s;g[w]==e&&(--g[w],++b)}p=e}return{t:new Re(g),l:p}},ui=function(A,e,t){return A.s==-1?Math.max(ui(A.l,e,t+1),ui(A.r,e,t+1)):e[A.s]=t},ro=function(A){for(var e=A.length;e&&!A[--e];);for(var t=new at(++e),s=0,n=A[0],i=1,o=function(r){t[s++]=r},a=1;a<=e;++a)if(A[a]==n&&a!=e)++i;else{if(!n&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(n),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(n);i=1,n=A[a]}return{c:t.subarray(0,s),n:e}},Rn=function(A,e){for(var t=0,s=0;s<e.length;++s)t+=A[s]*e[s];return t},Ra=function(A,e,t){var s=t.length,n=Si(e+2);A[n]=s&255,A[n+1]=s>>8,A[n+2]=A[n]^255,A[n+3]=A[n+1]^255;for(var i=0;i<s;++i)A[n+i+4]=t[i];return(n+4+s)*8},Ao=function(A,e,t,s,n,i,o,a,r,c,l){Lt(e,l++,t),++n[256];for(var h=Os(n,15),d=h.t,g=h.l,p=Os(i,15),b=p.t,f=p.l,m=ro(d),B=m.c,E=m.n,w=ro(b),y=w.c,v=w.n,R=new at(19),x=0;x<B.length;++x)++R[B[x]&31];for(var x=0;x<y.length;++x)++R[y[x]&31];for(var T=Os(R,7),L=T.t,N=T.l,O=19;O>4&&!L[ci[O-1]];--O);var $=c+5<<3,G=Rn(n,Xt)+Rn(i,qn)+o,q=Rn(n,d)+Rn(i,b)+o+14+3*O+Rn(R,L)+2*R[16]+3*R[17]+7*R[18];if(r>=0&&$<=G&&$<=q)return Ra(e,l,A.subarray(r,r+c));var H,K,te,ne;if(Lt(e,l,1+(q<G)),l+=2,q<G){H=Rt(d,g,0),K=d,te=Rt(b,f,0),ne=b;var oe=Rt(L,N,0);Lt(e,l,E-257),Lt(e,l+5,v-1),Lt(e,l+10,O-4),l+=14;for(var x=0;x<O;++x)Lt(e,l+3*x,L[ci[x]]);l+=3*O;for(var ue=[B,y],Ae=0;Ae<2;++Ae)for(var de=ue[Ae],x=0;x<de.length;++x){var Se=de[x]&31;Lt(e,l,oe[Se]),l+=L[Se],Se>15&&(Lt(e,l,de[x]>>5&127),l+=de[x]>>12)}}else H=xl,K=Xt,te=vl,ne=qn;for(var x=0;x<a;++x){var Ee=s[x];if(Ee>255){var Se=Ee>>18&31;_n(e,l,H[Se+257]),l+=K[Se+257],Se>7&&(Lt(e,l,Ee>>23&31),l+=Bs[Se]);var ce=Ee&31;_n(e,l,te[ce]),l+=ne[ce],ce>3&&(_n(e,l,Ee>>5&8191),l+=ws[ce])}else _n(e,l,H[Ee]),l+=K[Ee]}return _n(e,l,H[256]),l+K[256]},Dl=new xi([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Da=new Re(0),Ml=function(A,e,t,s,n,i){var o=i.z||A.length,a=new Re(s+o+5*(1+Math.ceil(o/7e3))+n),r=a.subarray(s,a.length-n),c=i.l,l=(i.r||0)&7;if(e){l&&(r[0]=i.r>>3);for(var h=Dl[e-1],d=h>>13,g=h&8191,p=(1<<t)-1,b=i.p||new at(32768),f=i.h||new at(p+1),m=Math.ceil(t/3),B=2*m,E=function(un){return(A[un]^A[un+1]<<m^A[un+2]<<B)&p},w=new xi(25e3),y=new at(288),v=new at(32),R=0,x=0,T=i.i||0,L=0,N=i.w||0,O=0;T+2<o;++T){var $=E(T),G=T&32767,q=f[$];if(b[G]=q,f[$]=G,N<=T){var H=o-T;if((R>7e3||L>24576)&&(H>423||!c)){l=Ao(A,r,0,w,y,v,x,L,O,T-O,l),L=R=x=0,O=T;for(var K=0;K<286;++K)y[K]=0;for(var K=0;K<30;++K)v[K]=0}var te=2,ne=0,oe=g,ue=G-q&32767;if(H>2&&$==E(T-ue))for(var Ae=Math.min(d,H)-1,de=Math.min(32767,T),Se=Math.min(258,H);ue<=de&&--oe&&G!=q;){if(A[T+te]==A[T+te-ue]){for(var Ee=0;Ee<Se&&A[T+Ee]==A[T+Ee-ue];++Ee);if(Ee>te){if(te=Ee,ne=ue,Ee>Ae)break;for(var ce=Math.min(ue,Ee-2),$e=0,K=0;K<ce;++K){var et=T-ue+K&32767,ln=b[et],hn=et-ln&32767;hn>$e&&($e=hn,q=et)}}}G=q,q=b[G],ue+=G-q&32767}if(ne){w[L++]=268435456|li[te]<<18|ao[ne];var Ht=li[te]&31,Zt=ao[ne]&31;x+=Bs[Ht]+ws[Zt],++y[257+Ht],++v[Zt],N=T+te,++R}else w[L++]=A[T],++y[A[T]]}}for(T=Math.max(T,N);T<o;++T)w[L++]=A[T],++y[A[T]];l=Ao(A,r,c,w,y,v,x,L,O,T-O,l),c||(i.r=l&7|r[l/8|0]<<3,l-=7,i.h=f,i.p=b,i.i=T,i.w=N)}else{for(var T=i.w||0;T<o+c;T+=65535){var kt=T+65535;kt>=o&&(r[l/8|0]=c,kt=o),l=Ra(r,l+1,A.subarray(T,kt))}i.i=o}return vi(a,0,s+Si(l)+n)},kl=function(){for(var A=new Int32Array(256),e=0;e<256;++e){for(var t=e,s=9;--s;)t=(t&1&&-306674912)^t>>>1;A[e]=t}return A}(),Fl=function(){var A=-1;return{p:function(e){for(var t=A,s=0;s<e.length;++s)t=kl[t&255^e[s]]^t>>>8;A=t},d:function(){return~A}}},Ll=function(A,e,t,s,n){if(!n&&(n={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new Re(i.length+A.length);o.set(i),o.set(A,i.length),A=o,n.w=i.length}return Ml(A,e.level==null?6:e.level,e.mem==null?n.l?Math.ceil(Math.max(8,Math.min(13,Math.log(A.length)))*1.5):20:12+e.mem,t,s,n)},Ma=function(A,e){var t={};for(var s in A)t[s]=A[s];for(var s in e)t[s]=e[s];return t},Pe=function(A,e,t){for(;t;++e)A[e]=t,t>>>=8},Nl=function(A,e){return((A[0]&15)!=8||A[0]>>4>7||(A[0]<<8|A[1])%31)&&Ve(6,"invalid zlib data"),(A[1]>>5&1)==+!e&&Ve(6,"invalid zlib data: "+(A[1]&32?"need":"unexpected")+" dictionary"),(A[1]>>3&4)+2};function Ul(A,e){return Ll(A,e||{},0,0)}function Gn(A,e){return Rl(A.subarray(Nl(A,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}var ka=function(A,e,t,s){for(var n in A){var i=A[n],o=e+n,a=s;Array.isArray(i)&&(a=Ma(s,i[1]),i=i[0]),i instanceof Re?t[o]=[i,a]:(t[o+="/"]=[new Re(0),a],ka(i,o,t,s))}},co=typeof TextEncoder<"u"&&new TextEncoder,Gl=typeof TextDecoder<"u"&&new TextDecoder,Pl=0;try{Gl.decode(Da,{stream:!0}),Pl=1}catch{}function lo(A,e){if(e){for(var t=new Re(A.length),s=0;s<A.length;++s)t[s]=A.charCodeAt(s);return t}if(co)return co.encode(A);for(var n=A.length,i=new Re(A.length+(A.length>>1)),o=0,a=function(l){i[o++]=l},s=0;s<n;++s){if(o+5>i.length){var r=new Re(o+8+(n-s<<1));r.set(i),i=r}var c=A.charCodeAt(s);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|A.charCodeAt(++s)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return vi(i,0,o)}var di=function(A){var e=0;if(A)for(var t in A){var s=A[t].length;s>65535&&Ve(9),e+=s+4}return e},ho=function(A,e,t,s,n,i,o,a){var r=s.length,c=t.extra,l=a&&a.length,h=di(c);Pe(A,e,o!=null?33639248:67324752),e+=4,o!=null&&(A[e++]=20,A[e++]=t.os),A[e]=20,e+=2,A[e++]=t.flag<<1|(i<0&&8),A[e++]=n&&8,A[e++]=t.compression&255,A[e++]=t.compression>>8;var d=new Date(t.mtime==null?Date.now():t.mtime),g=d.getFullYear()-1980;if((g<0||g>119)&&Ve(10),Pe(A,e,g<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>1),e+=4,i!=-1&&(Pe(A,e,t.crc),Pe(A,e+4,i<0?-i-2:i),Pe(A,e+8,t.size)),Pe(A,e+12,r),Pe(A,e+14,h),e+=16,o!=null&&(Pe(A,e,l),Pe(A,e+6,t.attrs),Pe(A,e+10,o),e+=14),A.set(s,e),e+=r,h)for(var p in c){var b=c[p],f=b.length;Pe(A,e,+p),Pe(A,e+2,f),A.set(b,e+4),e+=4+f}return l&&(A.set(a,e),e+=l),e},Ol=function(A,e,t,s,n){Pe(A,e,101010256),Pe(A,e+8,t),Pe(A,e+10,t),Pe(A,e+12,s),Pe(A,e+16,n)};function sd(A,e){e||(e={});var t={},s=[];ka(A,"",t,e);var n=0,i=0;for(var o in t){var a=t[o],r=a[0],c=a[1],l=c.level==0?0:8,h=lo(o),d=h.length,g=c.comment,p=g&&lo(g),b=p&&p.length,f=di(c.extra);d>65535&&Ve(11);var m=l?Ul(r,c):r,B=m.length,E=Fl();E.p(r),s.push(Ma(c,{size:r.length,crc:E.d(),c:m,f:h,m:p,u:d!=o.length||p&&g.length!=b,o:n,compression:l})),n+=30+d+f+B,i+=76+2*(d+f)+(b||0)+B}for(var w=new Re(i+22),y=n,v=i-n,R=0;R<s.length;++R){var h=s[R];ho(w,h.o,h,h.f,h.u,h.c.length);var x=30+h.f.length+di(h.extra);w.set(h.c,h.o+x),ho(w,n,h,h.f,h.u,h.c.length,h.o,h.m),n+=16+x+(h.m?h.m.length:0)}return Ol(w,n,s.length,v,y),w}class Hl extends $o{constructor(e){super(e),this.type=ot}parse(e){const T=Math.pow(2.7182818,2.2);function L(u,I){let C=0;for(let _=0;_<65536;++_)(_==0||u[_>>3]&1<<(_&7))&&(I[C++]=_);const Q=C-1;for(;C<65536;)I[C++]=0;return Q}function N(u){for(let I=0;I<16384;I++)u[I]={},u[I].len=0,u[I].lit=0,u[I].p=null}const O={l:0,c:0,lc:0};function $(u,I,C,Q,_){for(;C<u;)I=I<<8|Di(Q,_),C+=8;C-=u,O.l=I>>C&(1<<u)-1,O.c=I,O.lc=C}const G=new Array(59);function q(u){for(let C=0;C<=58;++C)G[C]=0;for(let C=0;C<65537;++C)G[u[C]]+=1;let I=0;for(let C=58;C>0;--C){const Q=I+G[C]>>1;G[C]=I,I=Q}for(let C=0;C<65537;++C){const Q=u[C];Q>0&&(u[C]=Q|G[Q]++<<6)}}function H(u,I,C,Q,_,S){const k=I;let P=0,F=0;for(;Q<=_;Q++){if(k.value-I.value>C)return!1;$(6,P,F,u,k);const M=O.l;if(P=O.c,F=O.lc,S[Q]=M,M==63){if(k.value-I.value>C)throw new Error("Something wrong with hufUnpackEncTable");$(8,P,F,u,k);let D=O.l+6;if(P=O.c,F=O.lc,Q+D>_+1)throw new Error("Something wrong with hufUnpackEncTable");for(;D--;)S[Q++]=0;Q--}else if(M>=59){let D=M-59+2;if(Q+D>_+1)throw new Error("Something wrong with hufUnpackEncTable");for(;D--;)S[Q++]=0;Q--}}q(S)}function K(u){return u&63}function te(u){return u>>6}function ne(u,I,C,Q){for(;I<=C;I++){const _=te(u[I]),S=K(u[I]);if(_>>S)throw new Error("Invalid table entry");if(S>14){const k=Q[_>>S-14];if(k.len)throw new Error("Invalid table entry");if(k.lit++,k.p){const P=k.p;k.p=new Array(k.lit);for(let F=0;F<k.lit-1;++F)k.p[F]=P[F]}else k.p=new Array(1);k.p[k.lit-1]=I}else if(S){let k=0;for(let P=1<<14-S;P>0;P--){const F=Q[(_<<14-S)+k];if(F.len||F.p)throw new Error("Invalid table entry");F.len=S,F.lit=I,k++}}}return!0}const oe={c:0,lc:0};function ue(u,I,C,Q){u=u<<8|Di(C,Q),I+=8,oe.c=u,oe.lc=I}const Ae={c:0,lc:0};function de(u,I,C,Q,_,S,k,P,F){if(u==I){Q<8&&(ue(C,Q,_,S),C=oe.c,Q=oe.lc),Q-=8;let M=C>>Q;if(M=new Uint8Array([M])[0],P.value+M>F)return!1;const D=k[P.value-1];for(;M-- >0;)k[P.value++]=D}else if(P.value<F)k[P.value++]=u;else return!1;Ae.c=C,Ae.lc=Q}function Se(u){return u&65535}function Ee(u){const I=Se(u);return I>32767?I-65536:I}const ce={a:0,b:0};function $e(u,I){const C=Ee(u),_=Ee(I),S=C+(_&1)+(_>>1),k=S,P=S-_;ce.a=k,ce.b=P}function et(u,I){const C=Se(u),Q=Se(I),_=C-(Q>>1)&65535,S=Q+_-32768&65535;ce.a=S,ce.b=_}function ln(u,I,C,Q,_,S,k){const P=k<16384,F=C>_?_:C;let M=1,D,j;for(;M<=F;)M<<=1;for(M>>=1,D=M,M>>=1;M>=1;){j=0;const V=j+S*(_-D),Y=S*M,ee=S*D,J=Q*M,X=Q*D;let se,fe,ve,nt;for(;j<=V;j+=ee){let Ce=j;const le=j+Q*(C-D);for(;Ce<=le;Ce+=X){const Me=Ce+J,lt=Ce+Y,Le=lt+J;P?($e(u[Ce+I],u[lt+I]),se=ce.a,ve=ce.b,$e(u[Me+I],u[Le+I]),fe=ce.a,nt=ce.b,$e(se,fe),u[Ce+I]=ce.a,u[Me+I]=ce.b,$e(ve,nt),u[lt+I]=ce.a,u[Le+I]=ce.b):(et(u[Ce+I],u[lt+I]),se=ce.a,ve=ce.b,et(u[Me+I],u[Le+I]),fe=ce.a,nt=ce.b,et(se,fe),u[Ce+I]=ce.a,u[Me+I]=ce.b,et(ve,nt),u[lt+I]=ce.a,u[Le+I]=ce.b)}if(C&M){const Me=Ce+Y;P?$e(u[Ce+I],u[Me+I]):et(u[Ce+I],u[Me+I]),se=ce.a,u[Me+I]=ce.b,u[Ce+I]=se}}if(_&M){let Ce=j;const le=j+Q*(C-D);for(;Ce<=le;Ce+=X){const Me=Ce+J;P?$e(u[Ce+I],u[Me+I]):et(u[Ce+I],u[Me+I]),se=ce.a,u[Me+I]=ce.b,u[Ce+I]=se}}D=M,M>>=1}return j}function hn(u,I,C,Q,_,S,k,P,F){let M=0,D=0;const j=k,V=Math.trunc(Q.value+(_+7)/8);for(;Q.value<V;)for(ue(M,D,C,Q),M=oe.c,D=oe.lc;D>=14;){const ee=M>>D-14&16383,J=I[ee];if(J.len)D-=J.len,de(J.lit,S,M,D,C,Q,P,F,j),M=Ae.c,D=Ae.lc;else{if(!J.p)throw new Error("hufDecode issues");let X;for(X=0;X<J.lit;X++){const se=K(u[J.p[X]]);for(;D<se&&Q.value<V;)ue(M,D,C,Q),M=oe.c,D=oe.lc;if(D>=se&&te(u[J.p[X]])==(M>>D-se&(1<<se)-1)){D-=se,de(J.p[X],S,M,D,C,Q,P,F,j),M=Ae.c,D=Ae.lc;break}}if(X==J.lit)throw new Error("hufDecode issues")}}const Y=8-_&7;for(M>>=Y,D-=Y;D>0;){const ee=I[M<<14-D&16383];if(ee.len)D-=ee.len,de(ee.lit,S,M,D,C,Q,P,F,j),M=Ae.c,D=Ae.lc;else throw new Error("hufDecode issues")}return!0}function Ht(u,I,C,Q,_,S){const k={value:0},P=C.value,F=ct(I,C),M=ct(I,C);C.value+=4;const D=ct(I,C);if(C.value+=4,F<0||F>=65537||M<0||M>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const j=new Array(65537),V=new Array(16384);N(V);const Y=Q-(C.value-P);if(H(u,C,Y,F,M,j),D>8*(Q-(C.value-P)))throw new Error("Something wrong with hufUncompress");ne(j,F,M,V),hn(j,V,u,C,D,M,S,_,k)}function Zt(u,I,C){for(let Q=0;Q<C;++Q)I[Q]=u[I[Q]]}function kt(u){for(let I=1;I<u.length;I++){const C=u[I-1]+u[I]-128;u[I]=C}}function un(u,I){let C=0,Q=Math.floor((u.length+1)/2),_=0;const S=u.length-1;for(;!(_>S||(I[_++]=u[C++],_>S));)I[_++]=u[Q++]}function _i(u){let I=u.byteLength;const C=new Array;let Q=0;const _=new DataView(u);for(;I>0;){const S=_.getInt8(Q++);if(S<0){const k=-S;I-=k+1;for(let P=0;P<k;P++)C.push(_.getUint8(Q++))}else{const k=S;I-=2;const P=_.getUint8(Q++);for(let F=0;F<k+1;F++)C.push(P)}}return C}function za(u,I,C,Q,_,S){let k=new DataView(S.buffer);const P=C[u.idx[0]].width,F=C[u.idx[0]].height,M=3,D=Math.floor(P/8),j=Math.ceil(P/8),V=Math.ceil(F/8),Y=P-(j-1)*8,ee=F-(V-1)*8,J={value:0},X=new Array(M),se=new Array(M),fe=new Array(M),ve=new Array(M),nt=new Array(M);for(let le=0;le<M;++le)nt[le]=I[u.idx[le]],X[le]=le<1?0:X[le-1]+j*V,se[le]=new Float32Array(64),fe[le]=new Uint16Array(64),ve[le]=new Uint16Array(j*64);for(let le=0;le<V;++le){let Me=8;le==V-1&&(Me=ee);let lt=8;for(let pe=0;pe<j;++pe){pe==j-1&&(lt=Y);for(let be=0;be<M;++be)fe[be].fill(0),fe[be][0]=_[X[be]++],Ka(J,Q,fe[be]),Ya(fe[be],se[be]),Ja(se[be]);Wa(se);for(let be=0;be<M;++be)Va(se[be],ve[be],pe*64)}let Le=0;for(let pe=0;pe<M;++pe){const be=C[u.idx[pe]].type;for(let Ft=8*le;Ft<8*le+Me;++Ft){Le=nt[pe][Ft];for(let wn=0;wn<D;++wn){const Bt=wn*64+(Ft&7)*8;k.setUint16(Le+0*2*be,ve[pe][Bt+0],!0),k.setUint16(Le+1*2*be,ve[pe][Bt+1],!0),k.setUint16(Le+2*2*be,ve[pe][Bt+2],!0),k.setUint16(Le+3*2*be,ve[pe][Bt+3],!0),k.setUint16(Le+4*2*be,ve[pe][Bt+4],!0),k.setUint16(Le+5*2*be,ve[pe][Bt+5],!0),k.setUint16(Le+6*2*be,ve[pe][Bt+6],!0),k.setUint16(Le+7*2*be,ve[pe][Bt+7],!0),Le+=8*2*be}}if(D!=j)for(let Ft=8*le;Ft<8*le+Me;++Ft){const wn=nt[pe][Ft]+8*D*2*be,Bt=D*64+(Ft&7)*8;for(let Jn=0;Jn<lt;++Jn)k.setUint16(wn+Jn*2*be,ve[pe][Bt+Jn],!0)}}}const Ce=new Uint16Array(P);k=new DataView(S.buffer);for(let le=0;le<M;++le){C[u.idx[le]].decoded=!0;const Me=C[u.idx[le]].type;if(C[le].type==2)for(let lt=0;lt<F;++lt){const Le=nt[le][lt];for(let pe=0;pe<P;++pe)Ce[pe]=k.getUint16(Le+pe*2*Me,!0);for(let pe=0;pe<P;++pe)k.setFloat32(Le+pe*2*Me,W(Ce[pe]),!0)}}}function Ka(u,I,C){let Q,_=1;for(;_<64;)Q=I[u.value],Q==65280?_=64:Q>>8==255?_+=Q&255:(C[_]=Q,_++),u.value++}function Ya(u,I){I[0]=W(u[0]),I[1]=W(u[1]),I[2]=W(u[5]),I[3]=W(u[6]),I[4]=W(u[14]),I[5]=W(u[15]),I[6]=W(u[27]),I[7]=W(u[28]),I[8]=W(u[2]),I[9]=W(u[4]),I[10]=W(u[7]),I[11]=W(u[13]),I[12]=W(u[16]),I[13]=W(u[26]),I[14]=W(u[29]),I[15]=W(u[42]),I[16]=W(u[3]),I[17]=W(u[8]),I[18]=W(u[12]),I[19]=W(u[17]),I[20]=W(u[25]),I[21]=W(u[30]),I[22]=W(u[41]),I[23]=W(u[43]),I[24]=W(u[9]),I[25]=W(u[11]),I[26]=W(u[18]),I[27]=W(u[24]),I[28]=W(u[31]),I[29]=W(u[40]),I[30]=W(u[44]),I[31]=W(u[53]),I[32]=W(u[10]),I[33]=W(u[19]),I[34]=W(u[23]),I[35]=W(u[32]),I[36]=W(u[39]),I[37]=W(u[45]),I[38]=W(u[52]),I[39]=W(u[54]),I[40]=W(u[20]),I[41]=W(u[22]),I[42]=W(u[33]),I[43]=W(u[38]),I[44]=W(u[46]),I[45]=W(u[51]),I[46]=W(u[55]),I[47]=W(u[60]),I[48]=W(u[21]),I[49]=W(u[34]),I[50]=W(u[37]),I[51]=W(u[47]),I[52]=W(u[50]),I[53]=W(u[56]),I[54]=W(u[59]),I[55]=W(u[61]),I[56]=W(u[35]),I[57]=W(u[36]),I[58]=W(u[48]),I[59]=W(u[49]),I[60]=W(u[57]),I[61]=W(u[58]),I[62]=W(u[62]),I[63]=W(u[63])}function Ja(u){const I=.5*Math.cos(.7853975),C=.5*Math.cos(3.14159/16),Q=.5*Math.cos(3.14159/8),_=.5*Math.cos(3*3.14159/16),S=.5*Math.cos(5*3.14159/16),k=.5*Math.cos(3*3.14159/8),P=.5*Math.cos(7*3.14159/16),F=new Array(4),M=new Array(4),D=new Array(4),j=new Array(4);for(let V=0;V<8;++V){const Y=V*8;F[0]=Q*u[Y+2],F[1]=k*u[Y+2],F[2]=Q*u[Y+6],F[3]=k*u[Y+6],M[0]=C*u[Y+1]+_*u[Y+3]+S*u[Y+5]+P*u[Y+7],M[1]=_*u[Y+1]-P*u[Y+3]-C*u[Y+5]-S*u[Y+7],M[2]=S*u[Y+1]-C*u[Y+3]+P*u[Y+5]+_*u[Y+7],M[3]=P*u[Y+1]-S*u[Y+3]+_*u[Y+5]-C*u[Y+7],D[0]=I*(u[Y+0]+u[Y+4]),D[3]=I*(u[Y+0]-u[Y+4]),D[1]=F[0]+F[3],D[2]=F[1]-F[2],j[0]=D[0]+D[1],j[1]=D[3]+D[2],j[2]=D[3]-D[2],j[3]=D[0]-D[1],u[Y+0]=j[0]+M[0],u[Y+1]=j[1]+M[1],u[Y+2]=j[2]+M[2],u[Y+3]=j[3]+M[3],u[Y+4]=j[3]-M[3],u[Y+5]=j[2]-M[2],u[Y+6]=j[1]-M[1],u[Y+7]=j[0]-M[0]}for(let V=0;V<8;++V)F[0]=Q*u[16+V],F[1]=k*u[16+V],F[2]=Q*u[48+V],F[3]=k*u[48+V],M[0]=C*u[8+V]+_*u[24+V]+S*u[40+V]+P*u[56+V],M[1]=_*u[8+V]-P*u[24+V]-C*u[40+V]-S*u[56+V],M[2]=S*u[8+V]-C*u[24+V]+P*u[40+V]+_*u[56+V],M[3]=P*u[8+V]-S*u[24+V]+_*u[40+V]-C*u[56+V],D[0]=I*(u[V]+u[32+V]),D[3]=I*(u[V]-u[32+V]),D[1]=F[0]+F[3],D[2]=F[1]-F[2],j[0]=D[0]+D[1],j[1]=D[3]+D[2],j[2]=D[3]-D[2],j[3]=D[0]-D[1],u[0+V]=j[0]+M[0],u[8+V]=j[1]+M[1],u[16+V]=j[2]+M[2],u[24+V]=j[3]+M[3],u[32+V]=j[3]-M[3],u[40+V]=j[2]-M[2],u[48+V]=j[1]-M[1],u[56+V]=j[0]-M[0]}function Wa(u){for(let I=0;I<64;++I){const C=u[0][I],Q=u[1][I],_=u[2][I];u[0][I]=C+1.5747*_,u[1][I]=C-.1873*Q-.4682*_,u[2][I]=C+1.8556*Q}}function Va(u,I,C){for(let Q=0;Q<64;++Q)I[C+Q]=In.toHalfFloat(Xa(u[Q]))}function Xa(u){return u<=1?Math.sign(u)*Math.pow(Math.abs(u),2.2):Math.sign(u)*Math.pow(T,Math.abs(u)-1)}function ys(u){return new DataView(u.array.buffer,u.offset.value,u.size)}function Za(u){const I=u.viewer.buffer.slice(u.offset.value,u.offset.value+u.size),C=new Uint8Array(_i(I)),Q=new Uint8Array(C.length);return kt(C),un(C,Q),new DataView(Q.buffer)}function Qs(u){const I=u.array.slice(u.offset.value,u.offset.value+u.size),C=Gn(I),Q=new Uint8Array(C.length);return kt(C),un(C,Q),new DataView(Q.buffer)}function $a(u){const I=u.viewer,C={value:u.offset.value},Q=new Uint16Array(u.columns*u.lines*(u.inputChannels.length*u.type)),_=new Uint8Array(8192);let S=0;const k=new Array(u.inputChannels.length);for(let ee=0,J=u.inputChannels.length;ee<J;ee++)k[ee]={},k[ee].start=S,k[ee].end=k[ee].start,k[ee].nx=u.columns,k[ee].ny=u.lines,k[ee].size=u.type,S+=k[ee].nx*k[ee].ny*k[ee].size;const P=Bn(I,C),F=Bn(I,C);if(F>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(P<=F)for(let ee=0;ee<F-P+1;ee++)_[ee+P]=jt(I,C);const M=new Uint16Array(65536),D=L(_,M),j=ct(I,C);Ht(u.array,I,C,j,Q,S);for(let ee=0;ee<u.inputChannels.length;++ee){const J=k[ee];for(let X=0;X<k[ee].size;++X)ln(Q,J.start+X,J.nx,J.size,J.ny,J.nx*J.size,D)}Zt(M,Q,S);let V=0;const Y=new Uint8Array(Q.buffer.byteLength);for(let ee=0;ee<u.lines;ee++)for(let J=0;J<u.inputChannels.length;J++){const X=k[J],se=X.nx*X.size,fe=new Uint8Array(Q.buffer,X.end*2,se*2);Y.set(fe,V),V+=se*2,X.end+=se}return new DataView(Y.buffer)}function er(u){const I=u.array.slice(u.offset.value,u.offset.value+u.size),C=Gn(I),Q=u.inputChannels.length*u.lines*u.columns*u.totalBytes,_=new ArrayBuffer(Q),S=new DataView(_);let k=0,P=0;const F=new Array(4);for(let M=0;M<u.lines;M++)for(let D=0;D<u.inputChannels.length;D++){let j=0;switch(u.inputChannels[D].pixelType){case 1:F[0]=k,F[1]=F[0]+u.columns,k=F[1]+u.columns;for(let Y=0;Y<u.columns;++Y){const ee=C[F[0]++]<<8|C[F[1]++];j+=ee,S.setUint16(P,j,!0),P+=2}break;case 2:F[0]=k,F[1]=F[0]+u.columns,F[2]=F[1]+u.columns,k=F[2]+u.columns;for(let Y=0;Y<u.columns;++Y){const ee=C[F[0]++]<<24|C[F[1]++]<<16|C[F[2]++]<<8;j+=ee,S.setUint32(P,j,!0),P+=4}break}}return S}function Ri(u){const I=u.viewer,C={value:u.offset.value},Q=new Uint8Array(u.columns*u.lines*(u.inputChannels.length*u.type*2)),_={version:tt(I,C),unknownUncompressedSize:tt(I,C),unknownCompressedSize:tt(I,C),acCompressedSize:tt(I,C),dcCompressedSize:tt(I,C),rleCompressedSize:tt(I,C),rleUncompressedSize:tt(I,C),rleRawSize:tt(I,C),totalAcUncompressedCount:tt(I,C),totalDcUncompressedCount:tt(I,C),acCompression:tt(I,C)};if(_.version<2)throw new Error("EXRLoader.parse: "+$t.compression+" version "+_.version+" is unsupported");const S=new Array;let k=Bn(I,C)-2;for(;k>0;){const J=Yn(I.buffer,C),X=jt(I,C),se=X>>2&3,fe=(X>>4)-1,ve=new Int8Array([fe])[0],nt=jt(I,C);S.push({name:J,index:ve,type:nt,compression:se}),k-=J.length+3}const P=$t.channels,F=new Array(u.inputChannels.length);for(let J=0;J<u.inputChannels.length;++J){const X=F[J]={},se=P[J];X.name=se.name,X.compression=0,X.decoded=!1,X.type=se.pixelType,X.pLinear=se.pLinear,X.width=u.columns,X.height=u.lines}const M={idx:new Array(3)};for(let J=0;J<u.inputChannels.length;++J){const X=F[J];for(let se=0;se<S.length;++se){const fe=S[se];X.name==fe.name&&(X.compression=fe.compression,fe.index>=0&&(M.idx[fe.index]=J),X.offset=J)}}let D,j,V;if(_.acCompressedSize>0)switch(_.acCompression){case 0:D=new Uint16Array(_.totalAcUncompressedCount),Ht(u.array,I,C,_.acCompressedSize,D,_.totalAcUncompressedCount);break;case 1:const J=u.array.slice(C.value,C.value+_.totalAcUncompressedCount),X=Gn(J);D=new Uint16Array(X.buffer),C.value+=_.totalAcUncompressedCount;break}if(_.dcCompressedSize>0){const J={array:u.array,offset:C,size:_.dcCompressedSize};j=new Uint16Array(Qs(J).buffer),C.value+=_.dcCompressedSize}if(_.rleRawSize>0){const J=u.array.slice(C.value,C.value+_.rleCompressedSize),X=Gn(J);V=_i(X.buffer),C.value+=_.rleCompressedSize}let Y=0;const ee=new Array(F.length);for(let J=0;J<ee.length;++J)ee[J]=new Array;for(let J=0;J<u.lines;++J)for(let X=0;X<F.length;++X)ee[X].push(Y),Y+=F[X].width*u.type*2;za(M,ee,F,D,j,Q);for(let J=0;J<F.length;++J){const X=F[J];if(!X.decoded)switch(X.compression){case 2:let se=0,fe=0;for(let ve=0;ve<u.lines;++ve){let nt=ee[J][se];for(let Ce=0;Ce<X.width;++Ce){for(let le=0;le<2*X.type;++le)Q[nt++]=V[fe+le*X.width*X.height];fe++}se++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(Q.buffer)}function Yn(u,I){const C=new Uint8Array(u);let Q=0;for(;C[I.value+Q]!=0;)Q+=1;const _=new TextDecoder().decode(C.slice(I.value,I.value+Q));return I.value=I.value+Q+1,_}function tr(u,I,C){const Q=new TextDecoder().decode(new Uint8Array(u).slice(I.value,I.value+C));return I.value=I.value+C,Q}function nr(u,I){const C=At(u,I),Q=ct(u,I);return[C,Q]}function sr(u,I){const C=ct(u,I),Q=ct(u,I);return[C,Q]}function At(u,I){const C=u.getInt32(I.value,!0);return I.value=I.value+4,C}function ct(u,I){const C=u.getUint32(I.value,!0);return I.value=I.value+4,C}function Di(u,I){const C=u[I.value];return I.value=I.value+1,C}function jt(u,I){const C=u.getUint8(I.value);return I.value=I.value+1,C}const tt=function(u,I){let C;return"getBigInt64"in DataView.prototype?C=Number(u.getBigInt64(I.value,!0)):C=u.getUint32(I.value+4,!0)+Number(u.getUint32(I.value,!0)<<32),I.value+=8,C};function He(u,I){const C=u.getFloat32(I.value,!0);return I.value+=4,C}function ir(u,I){return In.toHalfFloat(He(u,I))}function W(u){const I=(u&31744)>>10,C=u&1023;return(u>>15?-1:1)*(I?I===31?C?NaN:1/0:Math.pow(2,I-15)*(1+C/1024):6103515625e-14*(C/1024))}function Bn(u,I){const C=u.getUint16(I.value,!0);return I.value+=2,C}function or(u,I){return W(Bn(u,I))}function ar(u,I,C,Q){const _=C.value,S=[];for(;C.value<_+Q-1;){const k=Yn(I,C),P=At(u,C),F=jt(u,C);C.value+=3;const M=At(u,C),D=At(u,C);S.push({name:k,pixelType:P,pLinear:F,xSampling:M,ySampling:D})}return C.value+=1,S}function rr(u,I){const C=He(u,I),Q=He(u,I),_=He(u,I),S=He(u,I),k=He(u,I),P=He(u,I),F=He(u,I),M=He(u,I);return{redX:C,redY:Q,greenX:_,greenY:S,blueX:k,blueY:P,whiteX:F,whiteY:M}}function Ar(u,I){const C=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Q=jt(u,I);return C[Q]}function cr(u,I){const C=At(u,I),Q=At(u,I),_=At(u,I),S=At(u,I);return{xMin:C,yMin:Q,xMax:_,yMax:S}}function lr(u,I){const C=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],Q=jt(u,I);return C[Q]}function hr(u,I){const C=["ENVMAP_LATLONG","ENVMAP_CUBE"],Q=jt(u,I);return C[Q]}function ur(u,I){const C=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],Q=["ROUND_DOWN","ROUND_UP"],_=ct(u,I),S=ct(u,I),k=jt(u,I);return{xSize:_,ySize:S,levelMode:C[k&15],roundingMode:Q[k>>4]}}function dr(u,I){const C=He(u,I),Q=He(u,I);return[C,Q]}function gr(u,I){const C=He(u,I),Q=He(u,I),_=He(u,I);return[C,Q,_]}function pr(u,I,C,Q,_){if(Q==="string"||Q==="stringvector"||Q==="iccProfile")return tr(I,C,_);if(Q==="chlist")return ar(u,I,C,_);if(Q==="chromaticities")return rr(u,C);if(Q==="compression")return Ar(u,C);if(Q==="box2i")return cr(u,C);if(Q==="envmap")return hr(u,C);if(Q==="tiledesc")return ur(u,C);if(Q==="lineOrder")return lr(u,C);if(Q==="float")return He(u,C);if(Q==="v2f")return dr(u,C);if(Q==="v3f")return gr(u,C);if(Q==="int")return At(u,C);if(Q==="rational")return nr(u,C);if(Q==="timecode")return sr(u,C);if(Q==="preview")return C.value+=_,"skipped";C.value+=_}function fr(u,I){const C=Math.log2(u);return I=="ROUND_DOWN"?Math.floor(C):Math.ceil(C)}function mr(u,I,C){let Q=0;switch(u.levelMode){case"ONE_LEVEL":Q=1;break;case"MIPMAP_LEVELS":Q=fr(Math.max(I,C),u.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return Q}function Mi(u,I,C,Q){const _=new Array(u);for(let S=0;S<u;S++){const k=1<<S;let P=I/k|0;Q=="ROUND_UP"&&P*k<I&&(P+=1);const F=Math.max(P,1);_[S]=(F+C-1)/C|0}return _}function Ir(){const u=this,I=u.offset,C={value:0};for(let Q=0;Q<u.tileCount;Q++){const _=At(u.viewer,I),S=At(u.viewer,I);I.value+=8,u.size=ct(u.viewer,I);const k=_*u.blockWidth,P=S*u.blockHeight;u.columns=k+u.blockWidth>u.width?u.width-k:u.blockWidth,u.lines=P+u.blockHeight>u.height?u.height-P:u.blockHeight;const F=u.columns*u.totalBytes,D=u.size<u.lines*F?u.uncompress(u):ys(u);I.value+=u.size;for(let j=0;j<u.lines;j++){const V=j*u.columns*u.totalBytes;for(let Y=0;Y<u.inputChannels.length;Y++){const ee=$t.channels[Y].name,J=u.channelByteOffsets[ee]*u.columns,X=u.decodeChannels[ee];if(X===void 0)continue;C.value=V+J;const se=(u.height-(1+P+j))*u.outLineWidth;for(let fe=0;fe<u.columns;fe++){const ve=se+(fe+k)*u.outputChannels+X;u.byteArray[ve]=u.getter(D,C)}}}}}function br(){const u=this,I=u.offset,C={value:0};for(let Q=0;Q<u.height/u.blockHeight;Q++){const _=At(u.viewer,I)-$t.dataWindow.yMin;u.size=ct(u.viewer,I),u.lines=_+u.blockHeight>u.height?u.height-_:u.blockHeight;const S=u.columns*u.totalBytes,P=u.size<u.lines*S?u.uncompress(u):ys(u);I.value+=u.size;for(let F=0;F<u.blockHeight;F++){const M=Q*u.blockHeight,D=F+u.scanOrder(M);if(D>=u.height)continue;const j=F*S,V=(u.height-1-D)*u.outLineWidth;for(let Y=0;Y<u.inputChannels.length;Y++){const ee=$t.channels[Y].name,J=u.channelByteOffsets[ee]*u.columns,X=u.decodeChannels[ee];if(X!==void 0){C.value=j+J;for(let se=0;se<u.columns;se++){const fe=V+se*u.outputChannels+X;u.byteArray[fe]=u.getter(P,C)}}}}}}function Er(u,I,C){const Q={};if(u.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");Q.version=u.getUint8(4);const _=u.getUint8(5);Q.spec={singleTile:!!(_&2),longName:!!(_&4),deepFormat:!!(_&8),multiPart:!!(_&16)},C.value=8;let S=!0;for(;S;){const k=Yn(I,C);if(k==0)S=!1;else{const P=Yn(I,C),F=ct(u,C),M=pr(u,I,C,P,F);M===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${P}'.`):Q[k]=M}}if(_&-7)throw console.error("THREE.EXRHeader:",Q),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return Q}function Cr(u,I,C,Q,_){const S={size:0,viewer:I,array:C,offset:Q,width:u.dataWindow.xMax-u.dataWindow.xMin+1,height:u.dataWindow.yMax-u.dataWindow.yMin+1,inputChannels:u.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:Ze};switch(u.compression){case"NO_COMPRESSION":S.blockHeight=1,S.uncompress=ys;break;case"RLE_COMPRESSION":S.blockHeight=1,S.uncompress=Za;break;case"ZIPS_COMPRESSION":S.blockHeight=1,S.uncompress=Qs;break;case"ZIP_COMPRESSION":S.blockHeight=16,S.uncompress=Qs;break;case"PIZ_COMPRESSION":S.blockHeight=32,S.uncompress=$a;break;case"PXR24_COMPRESSION":S.blockHeight=16,S.uncompress=er;break;case"DWAA_COMPRESSION":S.blockHeight=32,S.uncompress=Ri;break;case"DWAB_COMPRESSION":S.blockHeight=256,S.uncompress=Ri;break;default:throw new Error("EXRLoader.parse: "+u.compression+" is unsupported")}const k={};for(const D of u.channels)switch(D.name){case"Y":case"R":case"G":case"B":case"A":k[D.name]=!0,S.type=D.pixelType}let P=!1;if(k.R&&k.G&&k.B)P=!k.A,S.outputChannels=4,S.decodeChannels={R:0,G:1,B:2,A:3};else if(k.Y)S.outputChannels=1,S.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(S.type==1)switch(_){case _t:S.getter=or;break;case ot:S.getter=Bn;break}else if(S.type==2)switch(_){case _t:S.getter=He;break;case ot:S.getter=ir}else throw new Error("EXRLoader.parse: unsupported pixelType "+S.type+" for "+u.compression+".");S.columns=S.width;const F=S.width*S.height*S.outputChannels;switch(_){case _t:S.byteArray=new Float32Array(F),P&&S.byteArray.fill(1,0,F);break;case ot:S.byteArray=new Uint16Array(F),P&&S.byteArray.fill(15360,0,F);break;default:console.error("THREE.EXRLoader: unsupported type: ",_);break}let M=0;for(const D of u.channels)S.decodeChannels[D.name]!==void 0&&(S.channelByteOffsets[D.name]=M),M+=D.pixelType*2;if(S.totalBytes=M,S.outLineWidth=S.width*S.outputChannels,u.lineOrder==="INCREASING_Y"?S.scanOrder=D=>D:S.scanOrder=D=>S.height-1-D,S.outputChannels==4?(S.format=Wt,S.colorSpace=Ze):(S.format=mn,S.colorSpace=ms),u.spec.singleTile){S.blockHeight=u.tiles.ySize,S.blockWidth=u.tiles.xSize;const D=mr(u.tiles,S.width,S.height),j=Mi(D,S.width,u.tiles.xSize,u.tiles.roundingMode),V=Mi(D,S.height,u.tiles.ySize,u.tiles.roundingMode);S.tileCount=j[0]*V[0];for(let Y=0;Y<D;Y++)for(let ee=0;ee<V[Y];ee++)for(let J=0;J<j[Y];J++)tt(I,Q);S.decode=Ir.bind(S)}else{S.blockWidth=S.width;const D=Math.ceil(S.height/S.blockHeight);for(let j=0;j<D;j++)tt(I,Q);S.decode=br.bind(S)}return S}const ki={value:0},Fi=new DataView(e),Br=new Uint8Array(e),$t=Er(Fi,e,ki),dn=Cr($t,Fi,Br,ki,this.type);return dn.decode(),{header:$t,width:dn.width,height:dn.height,data:dn.byteArray,format:dn.format,colorSpace:dn.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,s,n){function i(o,a){o.colorSpace=a.colorSpace,o.minFilter=Et,o.magFilter=Et,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,i,s,n)}}const id=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:Hl},Symbol.toStringTag,{value:"Module"}));class jl extends $o{constructor(e){super(e),this.type=ot}parse(e){const o=function(x,T){switch(x){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(T||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(T||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(T||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(T||""))}},l=`
`,h=function(x,T,L){T=T||1024;let O=x.pos,$=-1,G=0,q="",H=String.fromCharCode.apply(null,new Uint16Array(x.subarray(O,O+128)));for(;0>($=H.indexOf(l))&&G<T&&O<x.byteLength;)q+=H,G+=H.length,O+=128,H+=String.fromCharCode.apply(null,new Uint16Array(x.subarray(O,O+128)));return-1<$?(L!==!1&&(x.pos+=G+$+1),q+H.slice(0,$)):!1},d=function(x){const T=/^#\?(\S+)/,L=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,N=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,O=/^\s*FORMAT=(\S+)\s*$/,$=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,G={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let q,H;for((x.pos>=x.byteLength||!(q=h(x)))&&o(1,"no header found"),(H=q.match(T))||o(3,"bad initial token"),G.valid|=1,G.programtype=H[1],G.string+=q+`
`;q=h(x),q!==!1;){if(G.string+=q+`
`,q.charAt(0)==="#"){G.comments+=q+`
`;continue}if((H=q.match(L))&&(G.gamma=parseFloat(H[1])),(H=q.match(N))&&(G.exposure=parseFloat(H[1])),(H=q.match(O))&&(G.valid|=2,G.format=H[1]),(H=q.match($))&&(G.valid|=4,G.height=parseInt(H[1],10),G.width=parseInt(H[2],10)),G.valid&2&&G.valid&4)break}return G.valid&2||o(3,"missing format specifier"),G.valid&4||o(3,"missing image size specifier"),G},g=function(x,T,L){const N=T;if(N<8||N>32767||x[0]!==2||x[1]!==2||x[2]&128)return new Uint8Array(x);N!==(x[2]<<8|x[3])&&o(3,"wrong scanline width");const O=new Uint8Array(4*T*L);O.length||o(4,"unable to allocate buffer space");let $=0,G=0;const q=4*N,H=new Uint8Array(4),K=new Uint8Array(q);let te=L;for(;te>0&&G<x.byteLength;){G+4>x.byteLength&&o(1),H[0]=x[G++],H[1]=x[G++],H[2]=x[G++],H[3]=x[G++],(H[0]!=2||H[1]!=2||(H[2]<<8|H[3])!=N)&&o(3,"bad rgbe scanline format");let ne=0,oe;for(;ne<q&&G<x.byteLength;){oe=x[G++];const Ae=oe>128;if(Ae&&(oe-=128),(oe===0||ne+oe>q)&&o(3,"bad scanline data"),Ae){const de=x[G++];for(let Se=0;Se<oe;Se++)K[ne++]=de}else K.set(x.subarray(G,G+oe),ne),ne+=oe,G+=oe}const ue=N;for(let Ae=0;Ae<ue;Ae++){let de=0;O[$]=K[Ae+de],de+=N,O[$+1]=K[Ae+de],de+=N,O[$+2]=K[Ae+de],de+=N,O[$+3]=K[Ae+de],$+=4}te--}return O},p=function(x,T,L,N){const O=x[T+3],$=Math.pow(2,O-128)/255;L[N+0]=x[T+0]*$,L[N+1]=x[T+1]*$,L[N+2]=x[T+2]*$,L[N+3]=1},b=function(x,T,L,N){const O=x[T+3],$=Math.pow(2,O-128)/255;L[N+0]=In.toHalfFloat(Math.min(x[T+0]*$,65504)),L[N+1]=In.toHalfFloat(Math.min(x[T+1]*$,65504)),L[N+2]=In.toHalfFloat(Math.min(x[T+2]*$,65504)),L[N+3]=In.toHalfFloat(1)},f=new Uint8Array(e);f.pos=0;const m=d(f),B=m.width,E=m.height,w=g(f.subarray(f.pos),B,E);let y,v,R;switch(this.type){case _t:R=w.length/4;const x=new Float32Array(R*4);for(let L=0;L<R;L++)p(w,L*4,x,L*4);y=x,v=_t;break;case ot:R=w.length/4;const T=new Uint16Array(R*4);for(let L=0;L<R;L++)b(w,L*4,T,L*4);y=T,v=ot;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:B,height:E,data:y,header:m.string,gamma:m.gamma,exposure:m.exposure,type:v}}setDataType(e){return this.type=e,this}load(e,t,s,n){function i(o,a){switch(o.type){case _t:case ot:o.colorSpace=Ze,o.minFilter=Et,o.magFilter=Et,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,i,s,n)}}const od=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:jl},Symbol.toStringTag,{value:"Module"}));function Fa(A,e,t){const s=t.length-A-1;if(e>=t[s])return s-1;if(e<=t[A])return A;let n=A,i=s,o=Math.floor((n+i)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?i=o:n=o,o=Math.floor((n+i)/2);return o}function ql(A,e,t,s){const n=[],i=[],o=[];n[0]=1;for(let a=1;a<=t;++a){i[a]=e-s[A+1-a],o[a]=s[A+a]-e;let r=0;for(let c=0;c<a;++c){const l=o[c+1],h=i[a-c],d=n[c]/(l+h);n[c]=r+l*d,r=h*d}n[a]=r}return n}function zl(A,e,t,s){const n=Fa(A,s,e),i=ql(n,s,A,e),o=new Ot(0,0,0,0);for(let a=0;a<=A;++a){const r=t[n-A+a],c=i[a],l=r.w*c;o.x+=r.x*l,o.y+=r.y*l,o.z+=r.z*l,o.w+=r.w*c}return o}function Kl(A,e,t,s,n){const i=[];for(let h=0;h<=t;++h)i[h]=0;const o=[];for(let h=0;h<=s;++h)o[h]=i.slice(0);const a=[];for(let h=0;h<=t;++h)a[h]=i.slice(0);a[0][0]=1;const r=i.slice(0),c=i.slice(0);for(let h=1;h<=t;++h){r[h]=e-n[A+1-h],c[h]=n[A+h]-e;let d=0;for(let g=0;g<h;++g){const p=c[g+1],b=r[h-g];a[h][g]=p+b;const f=a[g][h-1]/a[h][g];a[g][h]=d+p*f,d=b*f}a[h][h]=d}for(let h=0;h<=t;++h)o[0][h]=a[h][t];for(let h=0;h<=t;++h){let d=0,g=1;const p=[];for(let b=0;b<=t;++b)p[b]=i.slice(0);p[0][0]=1;for(let b=1;b<=s;++b){let f=0;const m=h-b,B=t-b;h>=b&&(p[g][0]=p[d][0]/a[B+1][m],f=p[g][0]*a[m][B]);const E=m>=-1?1:-m,w=h-1<=B?b-1:t-h;for(let v=E;v<=w;++v)p[g][v]=(p[d][v]-p[d][v-1])/a[B+1][m+v],f+=p[g][v]*a[m+v][B];h<=B&&(p[g][b]=-p[d][b-1]/a[B+1][h],f+=p[g][b]*a[h][B]),o[b][h]=f;const y=d;d=g,g=y}}let l=t;for(let h=1;h<=s;++h){for(let d=0;d<=t;++d)o[h][d]*=l;l*=t-h}return o}function Yl(A,e,t,s,n){const i=n<A?n:A,o=[],a=Fa(A,s,e),r=Kl(a,s,A,i,e),c=[];for(let l=0;l<t.length;++l){const h=t[l].clone(),d=h.w;h.x*=d,h.y*=d,h.z*=d,c[l]=h}for(let l=0;l<=i;++l){const h=c[a-A].clone().multiplyScalar(r[l][0]);for(let d=1;d<=A;++d)h.add(c[a-A+d].clone().multiplyScalar(r[l][d]));o[l]=h}for(let l=i+1;l<=n+1;++l)o[l]=new Ot(0,0,0);return o}function Jl(A,e){let t=1;for(let n=2;n<=A;++n)t*=n;let s=1;for(let n=2;n<=e;++n)s*=n;for(let n=2;n<=A-e;++n)s*=n;return t/s}function Wl(A){const e=A.length,t=[],s=[];for(let i=0;i<e;++i){const o=A[i];t[i]=new U(o.x,o.y,o.z),s[i]=o.w}const n=[];for(let i=0;i<e;++i){const o=t[i].clone();for(let a=1;a<=i;++a)o.sub(n[i-a].clone().multiplyScalar(Jl(i,a)*s[a]));n[i]=o.divideScalar(s[0])}return n}function Vl(A,e,t,s,n){const i=Yl(A,e,t,s,n);return Wl(i)}class Xl extends Zr{constructor(e,t,s,n,i){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=i||this.knots.length-1;for(let o=0;o<s.length;++o){const a=s[o];this.controlPoints[o]=new Ot(a.x,a.y,a.z,a.w)}}getPoint(e,t=new U){const s=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=zl(this.degree,this.knots,this.controlPoints,n);return i.w!==1&&i.divideScalar(i.w),s.set(i.x,i.y,i.z)}getTangent(e,t=new U){const s=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=Vl(this.degree,this.knots,this.controlPoints,n,1);return s.copy(i[1]).normalize(),s}}let ie,De,Ke;class ad extends Dt{constructor(e){super(e)}load(e,t,s,n){const i=this,o=i.path===""?rn.extractUrlBase(e):i.path,a=new gt(this.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,function(r){try{t(i.parse(r,o))}catch(c){n?n(c):console.error(c),i.manager.itemError(e)}},s,n)}parse(e,t){if(sh(e))ie=new nh().parse(e);else{const n=Ua(e);if(!ih(n))throw new Error("THREE.FBXLoader: Unknown format.");if(go(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+go(n));ie=new th().parse(n)}const s=new bs(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Zl(s,this.manager).parse(ie)}getFbxTree(){return ie}}class Zl{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){De=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),s=this.parseMaterials(t),n=this.parseDeformers(),i=new $l().parse(n);return this.parseScene(n,i,s),Ke}parseConnections(){const e=new Map;return"Connections"in ie&&ie.Connections.connections.forEach(function(s){const n=s[0],i=s[1],o=s[2];e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:i,relationship:o};e.get(n).parents.push(a),e.has(i)||e.set(i,{parents:[],children:[]});const r={ID:n,relationship:o};e.get(i).children.push(r)}),e}parseImages(){const e={},t={};if("Video"in ie.Objects){const s=ie.Objects.Video;for(const n in s){const i=s[n],o=parseInt(n);if(e[o]=i.RelativeFilename||i.Filename,"Content"in i){const a=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,r=typeof i.Content=="string"&&i.Content!=="";if(a||r){const c=this.parseImage(s[n]);t[i.RelativeFilename||i.Filename]=c}}}}for(const s in e){const n=e[s];t[n]!==void 0?e[s]=t[n]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const t=e.Content,s=e.RelativeFilename||e.Filename,n=s.slice(s.lastIndexOf(".")+1).toLowerCase();let i;switch(n){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),i="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if(typeof t=="string")return"data:"+i+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:i}))}}parseTextures(e){const t=new Map;if("Texture"in ie.Objects){const s=ie.Objects.Texture;for(const n in s){const i=this.parseTexture(s[n],e);t.set(parseInt(n),i)}}return t}parseTexture(e,t){const s=this.loadTexture(e,t);s.ID=e.id,s.name=e.attrName;const n=e.WrapModeU,i=e.WrapModeV,o=n!==void 0?n.value:0,a=i!==void 0?i.value:0;if(s.wrapS=o===0?Vt:ds,s.wrapT=a===0?Vt:ds,"Scaling"in e){const r=e.Scaling.value;s.repeat.x=r[0],s.repeat.y=r[1]}if("Translation"in e){const r=e.Translation.value;s.offset.x=r[0],s.offset.y=r[1]}return s}loadTexture(e,t){const s=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),n=e.FileName.split(".").pop().toLowerCase(),i=s.has(n)?this.manager.getHandler(`.${n}`):this.textureLoader;if(!i)return console.warn(`FBXLoader: ${n.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new si;const o=i.path;o||i.setPath(this.textureLoader.path);const a=De.get(e.id).children;let r;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(r=t[a[0].ID],(r.indexOf("blob:")===0||r.indexOf("data:")===0)&&i.setPath(void 0));const c=i.load(r);return i.setPath(o),c}parseMaterials(e){const t=new Map;if("Material"in ie.Objects){const s=ie.Objects.Material;for(const n in s){const i=this.parseMaterial(s[n],e);i!==null&&t.set(parseInt(n),i)}}return t}parseMaterial(e,t){const s=e.id,n=e.attrName;let i=e.ShadingModel;if(typeof i=="object"&&(i=i.value),!De.has(s))return null;const o=this.parseParameters(e,t,s);let a;switch(i.toLowerCase()){case"phong":a=new jn;break;case"lambert":a=new $r;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),a=new jn;break}return a.setValues(o),a.name=n,a}parseParameters(e,t,s){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=Xe.toWorkingColorSpace(new Te().fromArray(e.Diffuse.value),ge):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(n.color=Xe.toWorkingColorSpace(new Te().fromArray(e.DiffuseColor.value),ge)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=Xe.toWorkingColorSpace(new Te().fromArray(e.Emissive.value),ge):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(n.emissive=Xe.toWorkingColorSpace(new Te().fromArray(e.EmissiveColor.value),ge)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=Xe.toWorkingColorSpace(new Te().fromArray(e.Specular.value),ge):e.SpecularColor&&e.SpecularColor.type==="Color"&&(n.specular=Xe.toWorkingColorSpace(new Te().fromArray(e.SpecularColor.value),ge));const i=this;return De.get(s).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":n.bumpMap=i.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":n.aoMap=i.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=i.getTexture(t,o.ID),n.map!==void 0&&(n.map.colorSpace=ge);break;case"DisplacementColor":n.displacementMap=i.getTexture(t,o.ID);break;case"EmissiveColor":n.emissiveMap=i.getTexture(t,o.ID),n.emissiveMap!==void 0&&(n.emissiveMap.colorSpace=ge);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=i.getTexture(t,o.ID);break;case"ReflectionColor":n.envMap=i.getTexture(t,o.ID),n.envMap!==void 0&&(n.envMap.mapping=eA,n.envMap.colorSpace=ge);break;case"SpecularColor":n.specularMap=i.getTexture(t,o.ID),n.specularMap!==void 0&&(n.specularMap.colorSpace=ge);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=i.getTexture(t,o.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),n}getTexture(e,t){return"LayeredTexture"in ie.Objects&&t in ie.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=De.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ie.Objects){const s=ie.Objects.Deformer;for(const n in s){const i=s[n],o=De.get(parseInt(n));if(i.attrType==="Skin"){const a=this.parseSkeleton(o,s);a.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[n]=a}else if(i.attrType==="BlendShape"){const a={id:n};a.rawTargets=this.parseMorphTargets(o,s),a.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const s=[];return e.children.forEach(function(n){const i=t[n.ID];if(i.attrType!=="Cluster")return;const o={ID:n.ID,indices:[],weights:[],transformLink:new he().fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),s.push(o)}),{rawBones:s,bones:[]}}parseMorphTargets(e,t){const s=[];for(let n=0;n<e.children.length;n++){const i=e.children[n],o=t[i.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=De.get(parseInt(i.ID)).children.filter(function(r){return r.relationship===void 0})[0].ID,s.push(a)}return s}parseScene(e,t,s){Ke=new An;const n=this.parseModels(e.skeletons,t,s),i=ie.Objects.Model,o=this;n.forEach(function(r){var h;const c=i[r.ID];o.setLookAtProperties(r,c);const l=(h=De.get(r.ID))==null?void 0:h.parents;l==null||l.forEach(function(d){const g=n.get(d.ID);g!==void 0&&g.add(r)}),r.parent===null&&Ke.add(r)}),this.bindSkeleton(e.skeletons,t,n),this.addGlobalSceneSettings(),Ke.traverse(function(r){if(r.userData.transformData){r.parent&&(r.userData.transformData.parentMatrix=r.parent.matrix,r.userData.transformData.parentMatrixWorld=r.parent.matrixWorld);const c=Na(r.userData.transformData);r.applyMatrix4(c),r.updateWorldMatrix()}r.isSkinnedMesh&&(r.computeBoundingBox(),r.computeBoundingSphere(),r.boundingBox.expandByScalar(3),r.boundingSphere.radius*=3)});const a=new eh().parse();Ke.children.length===1&&Ke.children[0].isGroup&&(Ke.children[0].animations=a,Ke=Ke.children[0]),Ke.animations=a}parseModels(e,t,s){const n=new Map,i=ie.Objects.Model;for(const o in i){const a=parseInt(o),r=i[o],c=De.get(a);let l=this.buildSkeleton(c,e,a,r.attrName);if(!l){switch(r.attrType){case"Camera":l=this.createCamera(c);break;case"Light":l=this.createLight(c);break;case"Mesh":l=this.createMesh(c,t,s);break;case"NurbsCurve":l=this.createCurve(c,t);break;case"LimbNode":case"Root":l=new ni;break;case"Null":default:l=new An;break}l.name=r.attrName?Ct.sanitizeNodeName(r.attrName):"",l.userData.originalName=r.attrName,l.ID=a}this.getTransformData(l,r),n.set(a,l)}return n}buildSkeleton(e,t,s,n){let i=null;return e==null||e.parents.forEach(function(o){for(const a in t){const r=t[a];r.rawBones.forEach(function(c,l){if(c.ID===o.ID){const h=i;i=new ni,i.matrixWorld.copy(c.transformLink),i.name=n?Ct.sanitizeNodeName(n):"",i.userData.originalName=n,i.ID=s,r.bones[l]=i,h!==null&&i.add(h)}})}}),i}createCamera(e){let t,s;if(e.children.forEach(function(n){const i=ie.Objects.NodeAttribute[n.ID];i!==void 0&&(s=i)}),s===void 0)t=new bt;else{let n=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(n=1);let i=1;s.NearPlane!==void 0&&(i=s.NearPlane.value/1e3);let o=1e3;s.FarPlane!==void 0&&(o=s.FarPlane.value/1e3);let a=window.innerWidth,r=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(a=s.AspectWidth.value,r=s.AspectHeight.value);const c=a/r;let l=45;s.FieldOfView!==void 0&&(l=s.FieldOfView.value);const h=s.FocalLength?s.FocalLength.value:null;switch(n){case 0:t=new Is(l,c,i,o),h!==null&&t.setFocalLength(h);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new bt;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),t=new bt;break}}return t}createLight(e){let t,s;if(e.children.forEach(function(n){const i=ie.Objects.NodeAttribute[n.ID];i!==void 0&&(s=i)}),s===void 0)t=new bt;else{let n;s.LightType===void 0?n=0:n=s.LightType.value;let i=16777215;s.Color!==void 0&&(i=Xe.toWorkingColorSpace(new Te().fromArray(s.Color.value),ge));let o=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(o=0);let a=0;s.FarAttenuationEnd!==void 0&&(s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?a=0:a=s.FarAttenuationEnd.value);const r=1;switch(n){case 0:t=new ti(i,o,a,r);break;case 1:t=new Ho(i,o);break;case 2:let c=Math.PI/3;s.InnerAngle!==void 0&&(c=Qe.degToRad(s.InnerAngle.value));let l=0;s.OuterAngle!==void 0&&(l=Qe.degToRad(s.OuterAngle.value),l=Math.max(l,1)),t=new Oo(i,o,a,c,l,r);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),t=new ti(i,o);break}s.CastShadows!==void 0&&s.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,s){let n,i=null,o=null;const a=[];if(e.children.forEach(function(r){t.has(r.ID)&&(i=t.get(r.ID)),s.has(r.ID)&&a.push(s.get(r.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new jn({name:Dt.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in i.attributes&&a.forEach(function(r){r.vertexColors=!0}),i.groups.length>0){let r=!1;for(let c=0,l=i.groups.length;c<l;c++){const h=i.groups[c];(h.materialIndex<0||h.materialIndex>=a.length)&&(h.materialIndex=a.length,r=!0)}if(r){const c=new Ii;a.push(c)}}return i.FBX_Deformer?(n=new Ei(i,o),n.normalizeSkinWeights()):n=new z(i,o),n}createCurve(e,t){const s=e.children.reduce(function(i,o){return t.has(o.ID)&&(i=t.get(o.ID)),i},null),n=new Pt({name:Dt.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new mt(s,n)}getTransformData(e,t){const s={};"InheritType"in t&&(s.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?s.eulerOrder=zn(t.RotationOrder.value):s.eulerOrder=zn(0),"Lcl_Translation"in t&&(s.translation=t.Lcl_Translation.value),"PreRotation"in t&&(s.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(s.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(s.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(s.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(s.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(s.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(s.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(s.rotationPivot=t.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,t){"LookAtProperty"in t&&De.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const i=ie.Objects.Model[n.ID];if("Lcl_Translation"in i){const o=i.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Ke.add(e.target)):e.lookAt(new U().fromArray(o))}}})}bindSkeleton(e,t,s){const n=this.parsePoseNodes();for(const i in e){const o=e[i];De.get(parseInt(o.ID)).parents.forEach(function(r){if(t.has(r.ID)){const c=r.ID;De.get(c).parents.forEach(function(h){s.has(h.ID)&&s.get(h.ID).bind(new qo(o.bones),n[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ie.Objects){const t=ie.Objects.Pose;for(const s in t)if(t[s].attrType==="BindPose"&&t[s].NbPoseNodes>0){const n=t[s].PoseNode;Array.isArray(n)?n.forEach(function(i){e[i.Node]=new he().fromArray(i.Matrix.a)}):e[n.Node]=new he().fromArray(n.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in ie){if("AmbientColor"in ie.GlobalSettings){const e=ie.GlobalSettings.AmbientColor.value,t=e[0],s=e[1],n=e[2];if(t!==0||s!==0||n!==0){const i=new Te().setRGB(t,s,n,ge);Ke.add(new tA(i,1))}}"UnitScaleFactor"in ie.GlobalSettings&&(Ke.userData.unitScaleFactor=ie.GlobalSettings.UnitScaleFactor.value)}}}class $l{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in ie.Objects){const s=ie.Objects.Geometry;for(const n in s){const i=De.get(parseInt(n)),o=this.parseGeometry(i,s[n],e);t.set(parseInt(n),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,s){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,s);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,s){const n=s.skeletons,i=[],o=e.parents.map(function(h){return ie.Objects.Model[h.ID]});if(o.length===0)return;const a=e.children.reduce(function(h,d){return n[d.ID]!==void 0&&(h=n[d.ID]),h},null);e.children.forEach(function(h){s.morphTargets[h.ID]!==void 0&&i.push(s.morphTargets[h.ID])});const r=o[0],c={};"RotationOrder"in r&&(c.eulerOrder=zn(r.RotationOrder.value)),"InheritType"in r&&(c.inheritType=parseInt(r.InheritType.value)),"GeometricTranslation"in r&&(c.translation=r.GeometricTranslation.value),"GeometricRotation"in r&&(c.rotation=r.GeometricRotation.value),"GeometricScaling"in r&&(c.scale=r.GeometricScaling.value);const l=Na(c);return this.genGeometry(t,a,i,l)}genGeometry(e,t,s,n){const i=new pt;e.attrName&&(i.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),r=new Fe(a.vertex,3);if(r.applyMatrix4(n),i.setAttribute("position",r),a.colors.length>0&&i.setAttribute("color",new Fe(a.colors,3)),t&&(i.setAttribute("skinIndex",new nA(a.weightsIndices,4)),i.setAttribute("skinWeight",new Fe(a.vertexWeights,4)),i.FBX_Deformer=t),a.normal.length>0){const c=new ea().getNormalMatrix(n),l=new Fe(a.normal,3);l.applyNormalMatrix(c),i.setAttribute("normal",l)}if(a.uvs.forEach(function(c,l){const h=l===0?"uv":`uv${l}`;i.setAttribute(h,new Fe(a.uvs[l],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],l=0;if(a.materialIndex.forEach(function(h,d){h!==c&&(i.addGroup(l,d-l,c),c=h,l=d)}),i.groups.length>0){const h=i.groups[i.groups.length-1],d=h.start+h.count;d!==a.materialIndex.length&&i.addGroup(d,a.materialIndex.length-d,c)}i.groups.length===0&&i.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(i,e,s,n),i}parseGeoNode(e,t){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let n=0;for(;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return s.weightTable={},t!==null&&(s.skeleton=t,t.rawBones.forEach(function(n,i){n.indices.forEach(function(o,a){s.weightTable[o]===void 0&&(s.weightTable[o]=[]),s.weightTable[o].push({id:i,weight:n.weights[a]})})})),s}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,n=0,i=!1,o=[],a=[],r=[],c=[],l=[],h=[];const d=this;return e.vertexIndices.forEach(function(g,p){let b,f=!1;g<0&&(g=g^-1,f=!0);let m=[],B=[];if(o.push(g*3,g*3+1,g*3+2),e.color){const E=es(p,s,g,e.color);r.push(E[0],E[1],E[2])}if(e.skeleton){if(e.weightTable[g]!==void 0&&e.weightTable[g].forEach(function(E){B.push(E.weight),m.push(E.id)}),B.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const E=[0,0,0,0],w=[0,0,0,0];B.forEach(function(y,v){let R=y,x=m[v];w.forEach(function(T,L,N){if(R>T){N[L]=R,R=T;const O=E[L];E[L]=x,x=O}})}),m=E,B=w}for(;B.length<4;)B.push(0),m.push(0);for(let E=0;E<4;++E)l.push(B[E]),h.push(m[E])}if(e.normal){const E=es(p,s,g,e.normal);a.push(E[0],E[1],E[2])}e.material&&e.material.mappingType!=="AllSame"&&(b=es(p,s,g,e.material)[0],b<0&&(d.negativeMaterialIndices=!0,b=0)),e.uv&&e.uv.forEach(function(E,w){const y=es(p,s,g,E);c[w]===void 0&&(c[w]=[]),c[w].push(y[0]),c[w].push(y[1])}),n++,f&&(d.genFace(t,e,o,b,a,r,c,l,h,n),s++,n=0,o=[],a=[],r=[],c=[],l=[],h=[])}),t}getNormalNewell(e){const t=new U(0,0,0);for(let s=0;s<e.length;s++){const n=e[s],i=e[(s+1)%e.length];t.x+=(n.y-i.y)*(n.z+i.z),t.y+=(n.z-i.z)*(n.x+i.x),t.z+=(n.x-i.x)*(n.y+i.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new U(0,1,0):new U(0,0,1)).cross(t).normalize(),i=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:i}}flattenVertex(e,t,s){return new Ne(e.dot(t),e.dot(s))}genFace(e,t,s,n,i,o,a,r,c,l){let h;if(l>3){const d=[],g=t.baseVertexPositions||t.vertexPositions;for(let m=0;m<s.length;m+=3)d.push(new U(g[s[m]],g[s[m+1]],g[s[m+2]]));const{tangent:p,bitangent:b}=this.getNormalTangentAndBitangent(d),f=[];for(const m of d)f.push(this.flattenVertex(m,p,b));h=sA.triangulateShape(f,[])}else h=[[0,1,2]];for(const[d,g,p]of h)e.vertex.push(t.vertexPositions[s[d*3]]),e.vertex.push(t.vertexPositions[s[d*3+1]]),e.vertex.push(t.vertexPositions[s[d*3+2]]),e.vertex.push(t.vertexPositions[s[g*3]]),e.vertex.push(t.vertexPositions[s[g*3+1]]),e.vertex.push(t.vertexPositions[s[g*3+2]]),e.vertex.push(t.vertexPositions[s[p*3]]),e.vertex.push(t.vertexPositions[s[p*3+1]]),e.vertex.push(t.vertexPositions[s[p*3+2]]),t.skeleton&&(e.vertexWeights.push(r[d*4]),e.vertexWeights.push(r[d*4+1]),e.vertexWeights.push(r[d*4+2]),e.vertexWeights.push(r[d*4+3]),e.vertexWeights.push(r[g*4]),e.vertexWeights.push(r[g*4+1]),e.vertexWeights.push(r[g*4+2]),e.vertexWeights.push(r[g*4+3]),e.vertexWeights.push(r[p*4]),e.vertexWeights.push(r[p*4+1]),e.vertexWeights.push(r[p*4+2]),e.vertexWeights.push(r[p*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3]),e.weightsIndices.push(c[g*4]),e.weightsIndices.push(c[g*4+1]),e.weightsIndices.push(c[g*4+2]),e.weightsIndices.push(c[g*4+3]),e.weightsIndices.push(c[p*4]),e.weightsIndices.push(c[p*4+1]),e.weightsIndices.push(c[p*4+2]),e.weightsIndices.push(c[p*4+3])),t.color&&(e.colors.push(o[d*3]),e.colors.push(o[d*3+1]),e.colors.push(o[d*3+2]),e.colors.push(o[g*3]),e.colors.push(o[g*3+1]),e.colors.push(o[g*3+2]),e.colors.push(o[p*3]),e.colors.push(o[p*3+1]),e.colors.push(o[p*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[d*3]),e.normal.push(i[d*3+1]),e.normal.push(i[d*3+2]),e.normal.push(i[g*3]),e.normal.push(i[g*3+1]),e.normal.push(i[g*3+2]),e.normal.push(i[p*3]),e.normal.push(i[p*3+1]),e.normal.push(i[p*3+2])),t.uv&&t.uv.forEach(function(b,f){e.uvs[f]===void 0&&(e.uvs[f]=[]),e.uvs[f].push(a[f][d*2]),e.uvs[f].push(a[f][d*2+1]),e.uvs[f].push(a[f][g*2]),e.uvs[f].push(a[f][g*2+1]),e.uvs[f].push(a[f][p*2]),e.uvs[f].push(a[f][p*2+1])})}addMorphTargets(e,t,s,n){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;s.forEach(function(o){o.rawTargets.forEach(function(a){const r=ie.Objects.Geometry[a.geoID];r!==void 0&&i.genMorphGeometry(e,t,r,n,a.name)})})}genMorphGeometry(e,t,s,n,i){const o=t.Vertices!==void 0?t.Vertices.a:[],a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],r=s.Vertices!==void 0?s.Vertices.a:[],c=s.Indexes!==void 0?s.Indexes.a:[],l=e.attributes.position.count*3,h=new Float32Array(l);for(let b=0;b<c.length;b++){const f=c[b]*3;h[f]=r[b*3],h[f+1]=r[b*3+1],h[f+2]=r[b*3+2]}const d={vertexIndices:a,vertexPositions:h,baseVertexPositions:o},g=this.genBuffers(d),p=new Fe(g.vertex,3);p.name=i||s.attrName,p.applyMatrix4(n),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,n=e.Normals.a;let i=[];return s==="IndexToDirect"&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:s}}parseUVs(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,n=e.UV.a;let i=[];return s==="IndexToDirect"&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:s}}parseVertexColors(e){if(!e.Colors)return;const t=e.MappingInformationType,s=e.ReferenceInformationType,n=e.Colors.a;let i=[];s==="IndexToDirect"&&(i=e.ColorIndex.a);for(let o=0,a=new Te;o<n.length;o+=4)a.fromArray(n,o),Xe.toWorkingColorSpace(a,ge),a.toArray(n,o);return{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:s}}parseMaterialIndices(e){const t=e.MappingInformationType,s=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const n=e.Materials.a,i=[];for(let o=0;o<n.length;++o)i.push(o);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:s}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new pt;const s=t-1,n=e.KnotVector.a,i=[],o=e.Points.a;for(let h=0,d=o.length;h<d;h+=4)i.push(new Ot().fromArray(o,h));let a,r;if(e.Form==="Closed")i.push(i[0]);else if(e.Form==="Periodic"){a=s,r=n.length-1-a;for(let h=0;h<s;++h)i.push(i[h])}const l=new Xl(s,n,i,a,r).getPoints(i.length*12);return new pt().setFromPoints(l)}}class eh{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const s in t){const n=t[s],i=this.addClip(n);e.push(i)}return e}parseClips(){if(ie.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ie.Objects.AnimationCurveNode,t=new Map;for(const s in e){const n=e[s];if(n.attrName.match(/S|R|T|DeformPercent/)!==null){const i={id:n.id,attr:n.attrName,curves:{}};t.set(i.id,i)}}return t}parseAnimationCurves(e){const t=ie.Objects.AnimationCurve;for(const s in t){const n={id:t[s].id,times:t[s].KeyTime.a.map(oh),values:t[s].KeyValueFloat.a},i=De.get(n.id);if(i!==void 0){const o=i.parents[0].ID,a=i.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=n:a.match(/Y/)?e.get(o).curves.y=n:a.match(/Z/)?e.get(o).curves.z=n:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=n)}}}parseAnimationLayers(e){const t=ie.Objects.AnimationLayer,s=new Map;for(const n in t){const i=[],o=De.get(parseInt(n));o!==void 0&&(o.children.forEach(function(r,c){if(e.has(r.ID)){const l=e.get(r.ID);if(l.curves.x!==void 0||l.curves.y!==void 0||l.curves.z!==void 0){if(i[c]===void 0){const h=De.get(r.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(h!==void 0){const d=ie.Objects.Model[h.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",r);return}const g={modelName:d.attrName?Ct.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ke.traverse(function(p){p.ID===d.id&&(g.transform=p.matrix,p.userData.transformData&&(g.eulerOrder=p.userData.transformData.eulerOrder))}),g.transform||(g.transform=new he),"PreRotation"in d&&(g.preRotation=d.PreRotation.value),"PostRotation"in d&&(g.postRotation=d.PostRotation.value),i[c]=g}}i[c]&&(i[c][l.attr]=l)}else if(l.curves.morph!==void 0){if(i[c]===void 0){const h=De.get(r.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,d=De.get(h).parents[0].ID,g=De.get(d).parents[0].ID,p=De.get(g).parents[0].ID,b=ie.Objects.Model[p],f={modelName:b.attrName?Ct.sanitizeNodeName(b.attrName):"",morphName:ie.Objects.Deformer[h].attrName};i[c]=f}i[c][l.attr]=l}}}),s.set(parseInt(n),i))}return s}parseAnimStacks(e){const t=ie.Objects.AnimationStack,s={};for(const n in t){const i=De.get(parseInt(n)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(i[0].ID);s[n]={name:t[n].attrName,layer:o}}return s}addClip(e){let t=[];const s=this;return e.layer.forEach(function(n){t=t.concat(s.generateTracks(n))}),new Ci(e.name,-1,t)}generateTracks(e){const t=[];let s=new U,n=new U;if(e.transform&&e.transform.decompose(s,new xe,n),s=s.toArray(),n=n.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");i!==void 0&&t.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&t.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");i!==void 0&&t.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&t.push(i)}return t}generateVectorTrack(e,t,s,n){const i=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(i,t,s);return new gs(e+"."+n,i,o)}generateRotationTrack(e,t,s,n,i){let o,a;if(t.x===void 0||t.y===void 0||t.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(t.x===void 0?"x ":"")+(t.y===void 0?"y ":"")+(t.z===void 0?"z ":"")+" for animation of "+e+". This is currently not supported.");return}if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const d=this.interpolateRotations(t.x,t.y,t.z,i);o=d[0],a=d[1]}const r=zn(0);s!==void 0&&(s=s.map(Qe.degToRad),s.push(r),s=new Jt().fromArray(s),s=new xe().setFromEuler(s)),n!==void 0&&(n=n.map(Qe.degToRad),n.push(r),n=new Jt().fromArray(n),n=new xe().setFromEuler(n).invert());const c=new xe,l=new Jt,h=[];if(!(!a||!o)){for(let d=0;d<a.length;d+=3)l.set(a[d],a[d+1],a[d+2],i),c.setFromEuler(l),s!==void 0&&c.premultiply(s),n!==void 0&&c.multiply(n),d>2&&new xe().fromArray(h,(d-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(h,d/3*4);return new fs(e+".quaternion",o,h)}}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,s=t.values.map(function(i){return i/100}),n=Ke.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ps(e.modelName+".morphTargetInfluences["+n+"]",t.times,s)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(s,n){return s-n}),t.length>1){let s=1,n=t[0];for(let i=1;i<t.length;i++){const o=t[i];o!==n&&(t[s]=o,n=o,s++)}t=t.slice(0,s)}return t}getKeyframeTrackValues(e,t,s){const n=s,i=[];let o=-1,a=-1,r=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(r=t.z.times.indexOf(c)),o!==-1){const l=t.x.values[o];i.push(l),n[0]=l}else i.push(n[0]);if(a!==-1){const l=t.y.values[a];i.push(l),n[1]=l}else i.push(n[1]);if(r!==-1){const l=t.z.values[r];i.push(l),n[2]=l}else i.push(n[2])}),i}interpolateRotations(e,t,s,n){const i=[],o=[];i.push(e.times[0]),o.push(Qe.degToRad(e.values[0])),o.push(Qe.degToRad(t.values[0])),o.push(Qe.degToRad(s.values[0]));for(let a=1;a<e.values.length;a++){const r=[e.values[a-1],t.values[a-1],s.values[a-1]];if(isNaN(r[0])||isNaN(r[1])||isNaN(r[2]))continue;const c=r.map(Qe.degToRad),l=[e.values[a],t.values[a],s.values[a]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const h=l.map(Qe.degToRad),d=[l[0]-r[0],l[1]-r[1],l[2]-r[2]],g=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(g[0]>=180||g[1]>=180||g[2]>=180){const b=Math.max(...g)/180,f=new Jt(...c,n),m=new Jt(...h,n),B=new xe().setFromEuler(f),E=new xe().setFromEuler(m);B.dot(E)&&E.set(-E.x,-E.y,-E.z,-E.w);const w=e.times[a-1],y=e.times[a]-w,v=new xe,R=new Jt;for(let x=0;x<1;x+=1/b)v.copy(B.clone().slerp(E.clone(),x)),i.push(w+x*y),R.setFromQuaternion(v,n),o.push(R.x),o.push(R.y),o.push(R.z)}else i.push(e.times[a]),o.push(Qe.degToRad(e.values[a])),o.push(Qe.degToRad(t.values[a])),o.push(Qe.degToRad(s.values[a]))}return[i,o]}}class th{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new La,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,s=e.split(/[\r\n]+/);return s.forEach(function(n,i){const o=n.match(/^[\s\t]*;/),a=n.match(/^[\s\t]*$/);if(o||a)return;const r=n.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=n.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=n.match("^\\t{"+(t.currentIndent-1)+"}}");r?t.parseNodeBegin(n,r):c?t.parseNodeProperty(n,c,s[++i]):l?t.popStack():n.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(n)}),this.allNodes}parseNodeBegin(e,t){const s=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(r){return r.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:s},o=this.parseNodeAttr(n),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,i):s in a?(s==="PoseNode"?a.PoseNode.push(i):a[s].id!==void 0&&(a[s]={},a[s][a[s].id]=a[s]),o.id!==""&&(a[s][o.id]=i)):typeof o.id=="number"?(a[s]={},a[s][o.id]=i):s!=="Properties70"&&(s==="PoseNode"?a[s]=[i]:a[s]=i),typeof o.id=="number"&&(i.id=o.id),o.name!==""&&(i.attrName=o.name),o.type!==""&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let s="",n="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:s,type:n}}parseNodeProperty(e,t,s){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();n==="Content"&&i===","&&(i=s.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,n,i);return}if(n==="C"){const r=i.split(",").slice(1),c=parseInt(r[0]),l=parseInt(r[1]);let h=i.split(",").slice(3);h=h.map(function(d){return d.trim().replace(/^"/,"")}),n="connections",i=[c,l],rh(i,h),o[n]===void 0&&(o[n]=[])}n==="Node"&&(o.id=i),n in o&&Array.isArray(o[n])?o[n].push(i):n!=="a"?o[n]=i:o.a=i,this.setCurrentProp(o,n),n==="a"&&i.slice(-1)!==","&&(o.a=js(i))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=js(t.a))}parseNodeSpecialProperty(e,t,s){const n=s.split('",').map(function(l){return l.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=n[0],o=n[1],a=n[2],r=n[3];let c=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=js(c);break}this.getPrevNode()[i]={type:o,type2:a,flag:r,value:c},this.setCurrentProp(this.getPrevNode(),i)}}class nh{parse(e){const t=new uo(e);t.skip(23);const s=t.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const n=new La;for(;!this.endOfContent(t);){const i=this.parseNode(t,s);i!==null&&n.add(i.name,i)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const s={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(n===0)return null;const r=[];for(let d=0;d<i;d++)r.push(this.parseProperty(e));const c=r.length>0?r[0]:"",l=r.length>1?r[1]:"",h=r.length>2?r[2]:"";for(s.singleProperty=i===1&&e.getOffset()===n;n>e.getOffset();){const d=this.parseNode(e,t);d!==null&&this.parseSubNode(a,s,d)}return s.propertyList=r,typeof c=="number"&&(s.id=c),l!==""&&(s.attrName=l),h!==""&&(s.attrType=h),a!==""&&(s.name=a),s}parseSubNode(e,t,s){if(s.singleProperty===!0){const n=s.propertyList[0];Array.isArray(n)?(t[s.name]=s,s.a=n):t[s.name]=n}else if(e==="Connections"&&s.name==="C"){const n=[];s.propertyList.forEach(function(i,o){o!==0&&n.push(i)}),t.connections===void 0&&(t.connections=[]),t.connections.push(n)}else if(s.name==="Properties70")Object.keys(s).forEach(function(i){t[i]=s[i]});else if(e==="Properties70"&&s.name==="P"){let n=s.propertyList[0],i=s.propertyList[1];const o=s.propertyList[2],a=s.propertyList[3];let r;n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),i==="Color"||i==="ColorRGB"||i==="Vector"||i==="Vector3D"||i.indexOf("Lcl_")===0?r=[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:r=s.propertyList[4],t[n]={type:i,type2:o,flag:a,value:r}}else t[s.name]===void 0?typeof s.id=="number"?(t[s.name]={},t[s.name][s.id]=s):t[s.name]=s:s.name==="PoseNode"?(Array.isArray(t[s.name])||(t[s.name]=[t[s.name]]),t[s.name].push(s)):t[s.name][s.id]===void 0&&(t[s.name][s.id]=s)}parseProperty(e){const t=e.getString(1);let s;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(i===0)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const a=Gn(new Uint8Array(e.getArrayBuffer(o))),r=new uo(a.buffer);switch(t){case"b":case"c":return r.getBooleanArray(n);case"d":return r.getFloat64Array(n);case"f":return r.getFloat32Array(n);case"i":return r.getInt32Array(n);case"l":return r.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class uo{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let s=0;s<e;s++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let s=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=s.indexOf(0);return n>=0&&(s=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(s)}}class La{add(e,t){this[e]=t}}function sh(A){const e="Kaydara FBX Binary  \0";return A.byteLength>=e.length&&e===Ua(A,0,e.length)}function ih(A){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function s(n){const i=A[n-1];return A=A.slice(t+n),t++,i}for(let n=0;n<e.length;++n)if(s(1)===e[n])return!1;return!0}function go(A){const e=/FBXVersion: (\d+)/,t=A.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function oh(A){return A/46186158e3}const ah=[];function es(A,e,t,s){let n;switch(s.mappingType){case"ByPolygonVertex":n=A;break;case"ByPolygon":n=e;break;case"ByVertice":n=t;break;case"AllSame":n=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(n=s.indices[n]);const i=n*s.dataSize,o=i+s.dataSize;return Ah(ah,s.buffer,i,o)}const Hs=new Jt,gn=new U;function Na(A){const e=new he,t=new he,s=new he,n=new he,i=new he,o=new he,a=new he,r=new he,c=new he,l=new he,h=new he,d=new he,g=A.inheritType?A.inheritType:0;A.translation&&e.setPosition(gn.fromArray(A.translation));const p=zn(0);if(A.preRotation){const N=A.preRotation.map(Qe.degToRad);N.push(p),t.makeRotationFromEuler(Hs.fromArray(N))}if(A.rotation){const N=A.rotation.map(Qe.degToRad);N.push(A.eulerOrder||p),s.makeRotationFromEuler(Hs.fromArray(N))}if(A.postRotation){const N=A.postRotation.map(Qe.degToRad);N.push(p),n.makeRotationFromEuler(Hs.fromArray(N)),n.invert()}A.scale&&i.scale(gn.fromArray(A.scale)),A.scalingOffset&&a.setPosition(gn.fromArray(A.scalingOffset)),A.scalingPivot&&o.setPosition(gn.fromArray(A.scalingPivot)),A.rotationOffset&&r.setPosition(gn.fromArray(A.rotationOffset)),A.rotationPivot&&c.setPosition(gn.fromArray(A.rotationPivot)),A.parentMatrixWorld&&(h.copy(A.parentMatrix),l.copy(A.parentMatrixWorld));const b=t.clone().multiply(s).multiply(n),f=new he;f.extractRotation(l);const m=new he;m.copyPosition(l);const B=m.clone().invert().multiply(l),E=f.clone().invert().multiply(B),w=i,y=new he;if(g===0)y.copy(f).multiply(b).multiply(E).multiply(w);else if(g===1)y.copy(f).multiply(E).multiply(b).multiply(w);else{const O=new he().scale(new U().setFromMatrixScale(h)).clone().invert(),$=E.clone().multiply(O);y.copy(f).multiply(b).multiply($).multiply(w)}const v=c.clone().invert(),R=o.clone().invert();let x=e.clone().multiply(r).multiply(c).multiply(t).multiply(s).multiply(n).multiply(v).multiply(a).multiply(o).multiply(i).multiply(R);const T=new he().copyPosition(x),L=l.clone().multiply(T);return d.copyPosition(L),x=d.clone().multiply(y),x.premultiply(l.invert()),x}function zn(A){A=A||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return A===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[A]}function js(A){return A.split(",").map(function(t){return parseFloat(t)})}function Ua(A,e,t){return e===void 0&&(e=0),t===void 0&&(t=A.byteLength),new TextDecoder().decode(new Uint8Array(A,e,t))}function rh(A,e){for(let t=0,s=A.length,n=e.length;t<n;t++,s++)A[s]=e[t]}function Ah(A,e,t,s){for(let n=t,i=0;n<s;n++,i++)A[i]=e[n];return A}class ch extends Dt{constructor(e){super(e)}load(e,t,s,n){const i=this,o=this.path===""?rn.extractUrlBase(e):this.path,a=new gt(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(r){try{t(i.parse(r,o))}catch(c){n?n(c):console.error(c),i.manager.itemError(e)}},s,n)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const s=e.split(`
`);let n={};const i=/\s+/,o={};for(let r=0;r<s.length;r++){let c=s[r];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const l=c.indexOf(" ");let h=l>=0?c.substring(0,l):c;h=h.toLowerCase();let d=l>=0?c.substring(l+1):"";if(d=d.trim(),h==="newmtl")n={name:d},o[d]=n;else if(h==="ka"||h==="kd"||h==="ks"||h==="ke"){const g=d.split(i,3);n[h]=[parseFloat(g[0]),parseFloat(g[1]),parseFloat(g[2])]}else n[h]=d}const a=new lh(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}}class lh{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Vo,this.wrap=this.options.wrap!==void 0?this.options.wrap:Vt}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const s in e){const n=e[s],i={};t[s]=i;for(const o in n){let a=!0,r=n[o];const c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&r[0]===0&&r[1]===0&&r[2]===0&&(a=!1);break}a&&(i[c]=r)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,s=this.materialsInfo[e],n={name:e,side:this.side};function i(a,r){return typeof r!="string"||r===""?"":/^https?:\/\//i.test(r)?r:a+r}function o(a,r){if(n[a])return;const c=t.getTextureParams(r,n),l=t.loadTexture(i(t.baseUrl,c.url));l.repeat.copy(c.scale),l.offset.copy(c.offset),l.wrapS=t.wrap,l.wrapT=t.wrap,(a==="map"||a==="emissiveMap")&&(l.colorSpace=ge),n[a]=l}for(const a in s){const r=s[a];let c;if(r!=="")switch(a.toLowerCase()){case"kd":n.color=Xe.toWorkingColorSpace(new Te().fromArray(r),ge);break;case"ks":n.specular=Xe.toWorkingColorSpace(new Te().fromArray(r),ge);break;case"ke":n.emissive=Xe.toWorkingColorSpace(new Te().fromArray(r),ge);break;case"map_kd":o("map",r);break;case"map_ks":o("specularMap",r);break;case"map_ke":o("emissiveMap",r);break;case"norm":o("normalMap",r);break;case"map_bump":case"bump":o("bumpMap",r);break;case"map_d":o("alphaMap",r),n.transparent=!0;break;case"ns":n.shininess=parseFloat(r);break;case"d":c=parseFloat(r),c<1&&(n.opacity=c,n.transparent=!0);break;case"tr":c=parseFloat(r),this.options&&this.options.invertTrProperty&&(c=1-c),c>0&&(n.opacity=1-c,n.transparent=!0);break}}return this.materials[e]=new jn(n),this.materials[e]}getTextureParams(e,t){const s={scale:new Ne(1,1),offset:new Ne(0,0)},n=e.split(/\s+/);let i;return i=n.indexOf("-bm"),i>=0&&(t.bumpScale=parseFloat(n[i+1]),n.splice(i,2)),i=n.indexOf("-s"),i>=0&&(s.scale.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),i=n.indexOf("-o"),i>=0&&(s.offset.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),s.url=n.join(" ").trim(),s}loadTexture(e,t,s,n,i){const o=this.manager!==void 0?this.manager:iA;let a=o.getHandler(e);a===null&&(a=new bs(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const r=a.load(e,s,n,i);return t!==void 0&&(r.mapping=t),r}}const hh=/^[og]\s*(.+)?/,uh=/^mtllib /,dh=/^usemtl /,gh=/^usemap /,po=/\s+/,fo=new U,qs=new U,mo=new U,Io=new U,ht=new U,ts=new Te;function ph(){const A={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,i){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:n||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(r){const c={index:typeof r=="number"?r:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),n&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},s&&s.name&&typeof s.clone=="function"){const n=s.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/3)*3},parseNormalIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/3)*3},parseUVIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/2)*2},addVertex:function(e,t,s){const n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[s+0],n[s+1],n[s+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,s){const n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[s+0],n[s+1],n[s+2])},addFaceNormal:function(e,t,s){const n=this.vertices,i=this.object.geometry.normals;fo.fromArray(n,e),qs.fromArray(n,t),mo.fromArray(n,s),ht.subVectors(mo,qs),Io.subVectors(fo,qs),ht.cross(Io),ht.normalize(),i.push(ht.x,ht.y,ht.z),i.push(ht.x,ht.y,ht.z),i.push(ht.x,ht.y,ht.z)},addColor:function(e,t,s){const n=this.colors,i=this.object.geometry.colors;n[e]!==void 0&&i.push(n[e+0],n[e+1],n[e+2]),n[t]!==void 0&&i.push(n[t+0],n[t+1],n[t+2]),n[s]!==void 0&&i.push(n[s+0],n[s+1],n[s+2])},addUV:function(e,t,s){const n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[s+0],n[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,s,n,i,o,a,r,c){const l=this.vertices.length;let h=this.parseVertexIndex(e,l),d=this.parseVertexIndex(t,l),g=this.parseVertexIndex(s,l);if(this.addVertex(h,d,g),this.addColor(h,d,g),a!==void 0&&a!==""){const p=this.normals.length;h=this.parseNormalIndex(a,p),d=this.parseNormalIndex(r,p),g=this.parseNormalIndex(c,p),this.addNormal(h,d,g)}else this.addFaceNormal(h,d,g);if(n!==void 0&&n!==""){const p=this.uvs.length;h=this.parseUVIndex(n,p),d=this.parseUVIndex(i,p),g=this.parseUVIndex(o,p),this.addUV(h,d,g),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let s=0,n=e.length;s<n;s++){const i=this.parseVertexIndex(e[s],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const s=this.vertices.length,n=this.uvs.length;for(let i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],s));for(let i=0,o=t.length;i<o;i++)this.addUVLine(this.parseUVIndex(t[i],n))}};return A.startObject("",!1),A}class rd extends Dt{constructor(e){super(e),this.materials=null,this.materialsLoader=new ch(e)}load(e,t,s,n){const i=this,o=new gt(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,async function(a){try{const r=i.parse(a,!0);for(let c=0,l=r.materialLibraries.length;c<l;c++){const h=r.materialLibraries[c],d=e.startsWith("blob:")?e+"/"+h:new URL(h,e);console.debug("Loading MTL file: "+d),await new Promise((g,p)=>{i.materialsLoader.load(d.toString(),b=>{i.setMaterials(b),g()},null,p)})}t(i.createObjects(r))}catch(r){n?n(r):console.error(r),i.manager.itemError(e)}},s,n)}setMTLLoader(e){return this.materialsLoader=e,this}setMaterials(e){return this.materials=e,this}parse(e,t=!1){const s=new ph;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let i=[];for(let o=0,a=n.length;o<a;o++){const r=n[o].trimStart();if(r.length===0)continue;const c=r.charAt(0);if(c!=="#")if(c==="v"){const l=r.split(po);switch(l[0]){case"v":s.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),l.length>=7?(ts.setRGB(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6]),ge),s.colors.push(ts.r,ts.g,ts.b)):s.colors.push(void 0,void 0,void 0);break;case"vn":s.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":s.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(c==="f"){const h=r.slice(1).trim().split(po),d=[];for(let p=0,b=h.length;p<b;p++){const f=h[p];if(f.length>0){const m=f.split("/");d.push(m)}}const g=d[0];for(let p=1,b=d.length-1;p<b;p++){const f=d[p],m=d[p+1];s.addFace(g[0],f[0],m[0],g[1],f[1],m[1],g[2],f[2],m[2])}}else if(c==="l"){const l=r.substring(1).trim().split(" ");let h=[];const d=[];if(r.indexOf("/")===-1)h=l;else for(let g=0,p=l.length;g<p;g++){const b=l[g].split("/");b[0]!==""&&h.push(b[0]),b[1]!==""&&d.push(b[1])}s.addLineGeometry(h,d)}else if(c==="p"){const h=r.slice(1).trim().split(" ");s.addPointGeometry(h)}else if((i=hh.exec(r))!==null){const l=(" "+i[0].slice(1).trim()).slice(1);s.startObject(l)}else if(dh.test(r))s.object.startMaterial(r.substring(7).trim(),s.materialLibraries);else if(uh.test(r))s.materialLibraries.push(r.substring(7).trim());else if(gh.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(c==="s"){if(i=r.split(" "),i.length>1){const h=i[1].trim().toLowerCase();s.object.smooth=h!=="0"&&h!=="off"}else s.object.smooth=!0;const l=s.object.currentMaterial();l&&(l.smooth=s.object.smooth)}else{if(r==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}}return s.finalize(),t?s:this.createObjects(s)}createObjects(e){const t=new An;if(t.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let n=0,i=e.objects.length;n<i;n++){const o=e.objects[n],a=o.geometry,r=o.materials,c=a.type==="Line",l=a.type==="Points";let h=!1;if(a.vertices.length===0)continue;const d=new pt;d.setAttribute("position",new Fe(a.vertices,3)),a.normals.length>0&&d.setAttribute("normal",new Fe(a.normals,3)),a.colors.length>0&&(h=!0,d.setAttribute("color",new Fe(a.colors,3))),a.hasUVIndices===!0&&d.setAttribute("uv",new Fe(a.uvs,2));const g=[];for(let b=0,f=r.length;b<f;b++){const m=r[b],B=m.name+"_"+m.smooth+"_"+h;let E=e.materials[B];if(this.materials!==null){if(E=this.materials.create(m.name),c&&E&&!(E instanceof Pt)){const w=new Pt;an.prototype.copy.call(w,E),w.color.copy(E.color),E=w}else if(l&&E&&!(E instanceof Fn)){const w=new Fn({size:10,sizeAttenuation:!1});an.prototype.copy.call(w,E),w.color.copy(E.color),w.map=E.map,E=w}}E===void 0&&(c?E=new Pt:l?E=new Fn({size:1,sizeAttenuation:!1}):E=new jn,E.name=m.name,E.flatShading=!m.smooth,E.vertexColors=h,e.materials[B]=E),g.push(E)}let p;if(g.length>1){for(let b=0,f=r.length;b<f;b++){const m=r[b];d.addGroup(m.groupStart,m.groupCount,b)}c?p=new us(d,g):l?p=new rs(d,g):p=new z(d,g)}else c?p=new us(d,g[0]):l?p=new rs(d,g[0]):p=new z(d,g[0]);p.name=o.name,t.add(p)}else if(e.vertices.length>0){const n=new Fn({size:1,sizeAttenuation:!1}),i=new pt;i.setAttribute("position",new Fe(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(i.setAttribute("color",new Fe(e.colors,3)),n.vertexColors=!0);const o=new rs(i,n);t.add(o)}return t}}const bo={type:"change"},Ti={type:"start"},Ga={type:"end"},ns=new oA,Eo=new aA,fh=Math.cos(70*Qe.DEG2RAD),ke=new U;new U;const We=2*Math.PI,me={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},zs=1e-6;let Ad=class extends Zo{constructor(e,t=null){super(e,t),this.state=me.NONE,this.enabled=!0,this.target=new U,this.cursor=new U,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:En.ROTATE,MIDDLE:En.DOLLY,RIGHT:En.PAN},this.touches={ONE:bn.ROTATE,TWO:bn.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new U,this._lastQuaternion=new xe,this._lastTargetPosition=new U,this._quat=new xe().setFromUnitVectors(e.up,new U(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Ni,this._sphericalDelta=new Ni,this._scale=1,this._currentScale=1,this._panOffset=new U,this._rotateStart=new Ne,this._rotateEnd=new Ne,this._rotateDelta=new Ne,this._panStart=new Ne,this._panEnd=new Ne,this._panDelta=new Ne,this._dollyStart=new Ne,this._dollyEnd=new Ne,this._dollyDelta=new Ne,this._dollyDirection=new U,this._mouse=new Ne,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Ih.bind(this),this._onPointerDown=mh.bind(this),this._onPointerUp=bh.bind(this),this._onContextMenu=xh.bind(this),this._onMouseWheel=Bh.bind(this),this._onKeyDown=wh.bind(this),this._onTouchStart=yh.bind(this),this._onTouchMove=Qh.bind(this),this._onMouseDown=Eh.bind(this),this._onMouseMove=Ch.bind(this),this._interceptControlDown=Sh.bind(this),this._interceptControlUp=vh.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(bo),this.update(),this.state=me.NONE}update(e=null){const t=this.object.getWorldPosition(this.object.position);ke.copy(t).sub(this.target),ke.applyQuaternion(this._quat),this._spherical.setFromVector3(ke),this.autoRotate&&this.state===me.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(s)&&isFinite(n)&&(s<-Math.PI?s+=We:s>Math.PI&&(s-=We),n<-Math.PI?n+=We:n>Math.PI&&(n-=We),s<=n?this._spherical.theta=Math.max(s,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+n)/2?Math.max(s,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.enableDamping?this._currentScale=Qe.lerp(this._currentScale,this._scale,this.dampingFactor):this._currentScale=this._scale,this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._currentScale),i=o!=this._spherical.radius}if(ke.setFromSpherical(this._spherical),ke.applyQuaternion(this._quatInverse),t.copy(this.target).add(ke),this.object.parent?this.object.parent.worldToLocal(t):this.object.position.copy(t),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=ke.length();o=this._clampDistance(a*this._currentScale);const r=a-o;this.object.position.addScaledVector(this._dollyDirection,r),this.object.updateMatrixWorld(),i=!!r}else if(this.object.isOrthographicCamera){const a=new U(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._currentScale)),this.object.updateProjectionMatrix(),i=r!==this.object.zoom;const c=new U(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=ke.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(ns.origin.copy(this.object.position),ns.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ns.direction))<fh?this.object.lookAt(this.target):(Eo.setFromNormalAndCoplanarPoint(this.object.up,this.target),ns.intersectPlane(Eo,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,i||this._lastPosition.distanceToSquared(this.object.position)>zs||8*(1-this._lastQuaternion.dot(this.object.quaternion))>zs||this._lastTargetPosition.distanceToSquared(this.target)>zs?(this.dispatchEvent(bo),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):(this._performCursorZoom=!1,!1)}_getAutoRotationAngle(e){return e!==null?We/60*this.autoRotateSpeed*e:We/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){ke.setFromMatrixColumn(t,0),ke.multiplyScalar(-e),this._panOffset.add(ke)}_panUp(e,t){this.screenSpacePanning===!0?ke.setFromMatrixColumn(t,1):(ke.setFromMatrixColumn(t,0),ke.crossVectors(this.object.up,ke)),ke.multiplyScalar(e),this._panOffset.add(ke)}_pan(e,t){const s=this.domElement;if(this.object.isPerspectiveCamera){this.object.getWorldPosition(ke).sub(this.target);let n=ke.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*n/s.clientHeight,this.object.matrixWorld),this._panUp(2*t*n/s.clientHeight,this.object.matrixWorld)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrixWorld),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),n=e-s.left,i=t-s.top,o=s.width,a=s.height;this._mouse.x=n/o*2-1,this._mouse.y=-(i/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(We*this._rotateDelta.x/t.clientHeight),this._rotateUp(We*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(We*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-We*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(We*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-We*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(s,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(s,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,i=Math.sqrt(s*s+n*n);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),i=.5*(e.pageY+s.y);this._rotateEnd.set(n,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(We*this._rotateDelta.x/t.clientHeight),this._rotateUp(We*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(s,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,i=Math.sqrt(s*s+n*n);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ne,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,s={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}};function mh(A){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(A.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(A)&&(this._addPointer(A),A.pointerType==="touch"?this._onTouchStart(A):this._onMouseDown(A)))}function Ih(A){this.enabled!==!1&&(A.pointerType==="touch"?this._onTouchMove(A):this._onMouseMove(A))}function bh(A){switch(this._removePointer(A),this._pointers.length){case 0:this.domElement.releasePointerCapture(A.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Ga),this.state=me.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Eh(A){let e;switch(A.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case En.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(A),this.state=me.DOLLY;break;case En.ROTATE:if(A.ctrlKey||A.metaKey||A.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(A),this.state=me.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(A),this.state=me.ROTATE}break;case En.PAN:if(A.ctrlKey||A.metaKey||A.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(A),this.state=me.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(A),this.state=me.PAN}break;default:this.state=me.NONE}this.state!==me.NONE&&this.dispatchEvent(Ti)}function Ch(A){switch(this.state){case me.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(A);break;case me.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(A);break;case me.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(A);break}}function Bh(A){this.enabled===!1||this.enableZoom===!1||this.state!==me.NONE||(A.preventDefault(),this.dispatchEvent(Ti),this._handleMouseWheel(this._customWheelEvent(A)),this.dispatchEvent(Ga))}function wh(A){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(A)}function yh(A){switch(this._trackPointer(A),this._pointers.length){case 1:switch(this.touches.ONE){case bn.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(A),this.state=me.TOUCH_ROTATE;break;case bn.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(A),this.state=me.TOUCH_PAN;break;default:this.state=me.NONE}break;case 2:switch(this.touches.TWO){case bn.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(A),this.state=me.TOUCH_DOLLY_PAN;break;case bn.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(A),this.state=me.TOUCH_DOLLY_ROTATE;break;default:this.state=me.NONE}break;default:this.state=me.NONE}this.state!==me.NONE&&this.dispatchEvent(Ti)}function Qh(A){switch(this._trackPointer(A),this.state){case me.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(A),this.update();break;case me.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(A),this.update();break;case me.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(A),this.update();break;case me.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(A),this.update();break;default:this.state=me.NONE}}function xh(A){this.enabled!==!1&&A.preventDefault()}function Sh(A){A.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function vh(A){A.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class ld extends mt{constructor(e,t=1,s=16,n=2){const i=new pt,o=s+n*2,a=new Float32Array((o*3+3)*3);i.setAttribute("position",new it(a,3));const r=new Pt({color:65280}),c=new Pt({color:16776960});super(i,[c,r]),this.audio=e,this.range=t,this.divisionsInnerAngle=s,this.divisionsOuterAngle=n,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,s=this.divisionsInnerAngle,n=this.divisionsOuterAngle,i=Qe.degToRad(e.panner.coneInnerAngle),o=Qe.degToRad(e.panner.coneOuterAngle),a=i/2,r=o/2;let c=0,l=0,h,d;const g=this.geometry,p=g.attributes.position;g.clearGroups();function b(f,m,B,E){const w=(m-f)/B;for(p.setXYZ(c,0,0,0),l++,h=f;h<m;h+=w)d=c+l,p.setXYZ(d,Math.sin(h)*t,0,Math.cos(h)*t),p.setXYZ(d+1,Math.sin(Math.min(h+w,m))*t,0,Math.cos(Math.min(h+w,m))*t),p.setXYZ(d+2,0,0,0),l+=3;g.addGroup(c,l,E),c+=l,l=0}b(-r,-a,n,0),b(-a,a,s,1),b(a,r,n,0),p.needsUpdate=!0,i===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const hd={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},ud={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};let Dn,Ks,pn,ss;function Ys(A,e=1/0,t=null){Ks||(Ks=new Qi(2,2,1,1)),pn||(pn=new ta({uniforms:{blitTexture:new rA(A)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),pn.uniforms.blitTexture.value=A,pn.defines.IS_SRGB=A.colorSpace==ge,pn.needsUpdate=!0,ss||(ss=new z(Ks,pn),ss.frustumCulled=!1);const s=new Is,n=new ii;n.add(ss),t===null&&(t=Dn=new AA({antialias:!1}));const i=Math.min(A.image.width,e),o=Math.min(A.image.height,e);t.setSize(i,o),t.clear(),t.render(n,s);const a=document.createElement("canvas"),r=a.getContext("2d");a.width=i,a.height=o,r.drawImage(t.domElement,0,0,i,o);const c=new na(a);return c.minFilter=A.minFilter,c.magFilter=A.magFilter,c.wrapS=A.wrapS,c.wrapT=A.wrapT,c.colorSpace=A.colorSpace,c.name=A.name,Dn&&(Dn.forceContextLoss(),Dn.dispose(),Dn=null),c}const Co={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Pa{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Uh(e)}),this.register(function(e){return new Gh(e)}),this.register(function(e){return new jh(e)}),this.register(function(e){return new qh(e)}),this.register(function(e){return new zh(e)}),this.register(function(e){return new Kh(e)}),this.register(function(e){return new Ph(e)}),this.register(function(e){return new Oh(e)}),this.register(function(e){return new Hh(e)}),this.register(function(e){return new Yh(e)}),this.register(function(e){return new Jh(e)}),this.register(function(e){return new Wh(e)}),this.register(function(e){return new Vh(e)}),this.register(function(e){return new Xh(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){const i=new Nh,o=[];for(let a=0,r=this.pluginCallbacks.length;a<r;a++)o.push(this.pluginCallbacks[a](i));i.setPlugins(o),i.write(e,t,n).catch(s)}parseAsync(e,t){const s=this;return new Promise(function(n,i){s.parse(e,n,i,t)})}}const re={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Js="KHR_mesh_quantization",rt={};rt[zo]=re.NEAREST;rt[Ko]=re.NEAREST_MIPMAP_NEAREST;rt[Jo]=re.NEAREST_MIPMAP_LINEAR;rt[Et]=re.LINEAR;rt[Yo]=re.LINEAR_MIPMAP_NEAREST;rt[Es]=re.LINEAR_MIPMAP_LINEAR;rt[ds]=re.CLAMP_TO_EDGE;rt[Vt]=re.REPEAT;rt[Wo]=re.MIRRORED_REPEAT;const Bo={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Th=new Te,wo=12,_h=1179937895,Rh=2,yo=8,Dh=1313821514,Mh=5130562;function Pn(A,e){return A.length===e.length&&A.every(function(t,s){return t===e[s]})}function kh(A){return new TextEncoder().encode(A).buffer}function Fh(A){return Pn(A.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Lh(A,e,t){const s={min:new Array(A.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(A.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+t;n++)for(let i=0;i<A.itemSize;i++){let o;A.itemSize>4?o=A.array[n*A.itemSize+i]:(i===0?o=A.getX(n):i===1?o=A.getY(n):i===2?o=A.getZ(n):i===3&&(o=A.getW(n)),A.normalized===!0&&(o=Qe.normalize(o,A.array))),s.min[i]=Math.min(s.min[i],o),s.max[i]=Math.max(s.max[i],o)}return s}function Oa(A){return Math.ceil(A/4)*4}function Ws(A,e=0){const t=Oa(A.byteLength);if(t!==A.byteLength){const s=new Uint8Array(t);if(s.set(new Uint8Array(A)),e!==0)for(let n=A.byteLength;n<t;n++)s[n]=e;return s.buffer}return A}function Qo(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function xo(A,e){if(A.toBlob!==void 0)return new Promise(s=>A.toBlob(s,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),A.convertToBlob({type:e,quality:t})}class Nh{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+cA}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const n=this,i=n.buffers,o=n.json;s=n.options;const a=n.extensionsUsed,r=n.extensionsRequired,c=new Blob(i,{type:"application/octet-stream"}),l=Object.keys(a),h=Object.keys(r);if(l.length>0&&(o.extensionsUsed=l),h.length>0&&(o.extensionsRequired=h),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=c.size),s.binary===!0){const d=new FileReader;d.readAsArrayBuffer(c),d.onloadend=function(){const g=Ws(d.result),p=new DataView(new ArrayBuffer(yo));p.setUint32(0,g.byteLength,!0),p.setUint32(4,Mh,!0);const b=Ws(kh(JSON.stringify(o)),32),f=new DataView(new ArrayBuffer(yo));f.setUint32(0,b.byteLength,!0),f.setUint32(4,Dh,!0);const m=new ArrayBuffer(wo),B=new DataView(m);B.setUint32(0,_h,!0),B.setUint32(4,Rh,!0);const E=wo+f.byteLength+b.byteLength+p.byteLength+g.byteLength;B.setUint32(8,E,!0);const w=new Blob([m,f,b,p,g],{type:"application/octet-stream"}),y=new FileReader;y.readAsArrayBuffer(w),y.onloadend=function(){t(y.result)}}}else if(o.buffers&&o.buffers.length>0){const d=new FileReader;d.readAsDataURL(c),d.onloadend=function(){const g=d.result;o.buffers[0].uri=g,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const s=this.options,n=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&i.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in i.gltfExtensions)t.extensions[o]=i.gltfExtensions[o],n[o]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(i){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+i.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const s=new U;for(let n=0,i=e.count;n<i;n++)if(Math.abs(s.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const s=e.clone(),n=new U;for(let i=0,o=s.count;i<o;i++)n.fromBufferAttribute(s,i),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),s.setXYZ(i,n.x,n.y,n.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1;const n={};(t.offset.x!==0||t.offset.y!==0)&&(n.offset=t.offset.toArray(),s=!0),t.rotation!==0&&(n.rotation=t.rotation,s=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(n.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function s(g){return g.colorSpace===ge?function(b){return b<.04045?b*.0773993808:Math.pow(b*.9478672986+.0521327014,2.4)}:function(b){return b}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Hn&&(e=Ys(e)),t instanceof Hn&&(t=Ys(t));const n=e?e.image:null,i=t?t.image:null,o=Math.max(n?n.width:0,i?i.width:0),a=Math.max(n?n.height:0,i?i.height:0),r=Qo();r.width=o,r.height=a;const c=r.getContext("2d",{willReadFrequently:!0});c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const l=c.getImageData(0,0,o,a);if(n){c.drawImage(n,0,0,o,a);const g=s(e),p=c.getImageData(0,0,o,a).data;for(let b=2;b<p.length;b+=4)l.data[b]=g(p[b]/256)*256}if(i){c.drawImage(i,0,0,o,a);const g=s(t),p=c.getImageData(0,0,o,a).data;for(let b=1;b<p.length;b+=4)l.data[b]=g(p[b]/256)*256}c.putImageData(l,0,0);const d=(e||t).clone();return d.source=new lA(r),d.colorSpace=ms,d.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),d}processBuffer(e){const t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,n,i){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(t){case re.BYTE:case re.UNSIGNED_BYTE:a=1;break;case re.SHORT:case re.UNSIGNED_SHORT:a=2;break;default:a=4}let r=e.itemSize*a;i===re.ARRAY_BUFFER&&(r=Math.ceil(r/4)*4);const c=Oa(n*r),l=new DataView(new ArrayBuffer(c));let h=0;for(let p=s;p<s+n;p++){for(let b=0;b<e.itemSize;b++){let f;e.itemSize>4?f=e.array[p*e.itemSize+b]:(b===0?f=e.getX(p):b===1?f=e.getY(p):b===2?f=e.getZ(p):b===3&&(f=e.getW(p)),e.normalized===!0&&(f=Qe.normalize(f,e.array))),t===re.FLOAT?l.setFloat32(h,f,!0):t===re.INT?l.setInt32(h,f,!0):t===re.UNSIGNED_INT?l.setUint32(h,f,!0):t===re.SHORT?l.setInt16(h,f,!0):t===re.UNSIGNED_SHORT?l.setUint16(h,f,!0):t===re.BYTE?l.setInt8(h,f):t===re.UNSIGNED_BYTE&&l.setUint8(h,f),h+=a}h%r!==0&&(h+=r-h%r)}const d={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:c};return i!==void 0&&(d.target=i),i===re.ARRAY_BUFFER&&(d.byteStride=r),this.byteOffset+=c,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(n){const i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){const o=Ws(i.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,n(s.bufferViews.push(a)-1)}})}processAccessor(e,t,s,n){const i=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=re.FLOAT;else if(e.array.constructor===Int32Array)a=re.INT;else if(e.array.constructor===Uint32Array)a=re.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=re.SHORT;else if(e.array.constructor===Uint16Array)a=re.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=re.BYTE;else if(e.array.constructor===Uint8Array)a=re.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(s===void 0&&(s=0),(n===void 0||n===1/0)&&(n=e.count),n===0)return null;const r=Lh(e,s,n);let c;t!==void 0&&(c=e===t.index?re.ELEMENT_ARRAY_BUFFER:re.ARRAY_BUFFER);const l=this.processBufferView(e,a,s,n,c),h={bufferView:l.id,byteOffset:l.byteOffset,componentType:a,count:n,max:r.max,min:r.min,type:o[e.itemSize]};return e.normalized===!0&&(h.normalized=!0),i.accessors||(i.accessors=[]),i.accessors.push(h)-1}processImage(e,t,s,n="image/png"){if(e!==null){const i=this,o=i.cache,a=i.json,r=i.options,c=i.pending;o.images.has(e)||o.images.set(e,{});const l=o.images.get(e),h=n+":flipY/"+s.toString();if(l[h]!==void 0)return l[h];a.images||(a.images=[]);const d={mimeType:n},g=Qo();g.width=Math.min(e.width,r.maxTextureSize),g.height=Math.min(e.height,r.maxTextureSize);const p=g.getContext("2d",{willReadFrequently:!0});if(s===!0&&(p.translate(0,g.height),p.scale(1,-1)),e.data!==void 0){t!==Wt&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>r.maxTextureSize||e.height>r.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const f=new Uint8ClampedArray(e.height*e.width*4);for(let m=0;m<f.length;m+=4)f[m+0]=e.data[m+0],f[m+1]=e.data[m+1],f[m+2]=e.data[m+2],f[m+3]=e.data[m+3];p.putImageData(new ImageData(f,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)p.drawImage(e,0,0,g.width,g.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");r.binary===!0?c.push(xo(g,n).then(f=>i.processBufferViewImage(f)).then(f=>{d.bufferView=f})):g.toDataURL!==void 0?d.uri=g.toDataURL(n):c.push(xo(g,n).then(f=>new FileReader().readAsDataURL(f)).then(f=>{d.uri=f}));const b=a.images.push(d)-1;return l[h]=b,b}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const s={magFilter:rt[e.magFilter],minFilter:rt[e.minFilter],wrapS:rt[e.wrapS],wrapT:rt[e.wrapT]};return t.samplers.push(s)-1}processTexture(e){const s=this.options,n=this.cache,i=this.json;if(n.textures.has(e))return n.textures.get(e);const o={keep:!0,newTexture:null};if(this._invokeAll(function(l){l.beforeWriteTexture&&l.beforeWriteTexture(e,o)}),o.keep===!1)return null;o.newTexture!=null&&(e=o.newTexture),i.textures||(i.textures=[]),e instanceof Hn&&(e=Ys(e,s.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(r.name=e.name),this._invokeAll(function(l){l.writeTexture&&l.writeTexture(e,r)});const c=i.textures.push(r)-1;return n.textures.set(e,c),c}processMaterial(e){var c,l,h,d,g;const t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const n={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const i=e.color.toArray().concat([e.opacity]);Pn(i,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=i),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5);const o=(c=e.metalnessMap)!=null&&c.image?e.metalnessMap:void 0,a=(l=e.roughnessMap)!=null&&l.image?e.roughnessMap:void 0;if(o||a){const p=this.buildMetalRoughTexture(o,a),b={index:this.processTexture(p),channel:p.channel};this.applyTextureTransform(b,p),n.pbrMetallicRoughness.metallicRoughnessTexture=b}if(e.map){const p={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(p,e.map),n.pbrMetallicRoughness.baseColorTexture=p}if(e.emissive){const p=e.emissive;if(Math.max(p.r,p.g,p.b)>0&&(n.emissiveFactor=e.emissive.toArray()),(h=e.emissiveMap)!=null&&h.image){const f={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(f,e.emissiveMap),n.emissiveTexture=f}}if((d=e.normalMap)!=null&&d.image){const p={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(p.scale=e.normalScale.x),this.applyTextureTransform(p,e.normalMap),n.normalTexture=p}if((g=e.aoMap)!=null&&g.image){const p={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(p.strength=e.aoMapIntensity),this.applyTextureTransform(p,e.aoMap),n.occlusionTexture=p}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===bi&&(n.doubleSided=!0),e.name!==""&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(p){p.writeMaterial&&p.writeMaterial(e,n)});const r=s.materials.push(n)-1;return t.materials.set(e,r),r}processMesh(e){const t={keep:!0};if(this._invokeAll(function(y){y.beforeWriteMesh&&y.beforeWriteMesh(e,t)}),t.keep!=!0)return null;const s=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let y=0,v=e.material.length;y<v;y++)i.push(e.material[y].uuid);else i.push(e.material.uuid);const o=i.join(":");if(s.meshes.has(o))return s.meshes.get(o);const a=e.geometry;let r;e.isLineSegments?r=re.LINES:e.isLineLoop?r=re.LINE_LOOP:e.isLine?r=re.LINE_STRIP:e.isPoints?r=re.POINTS:r=e.material.wireframe?re.LINES:re.TRIANGLES;const c={},l={},h=[],d=[],g={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=a.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let b=null;for(let y in a.attributes){if(y.slice(0,5)==="morph")continue;const v=a.attributes[y];if(y=g[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),s.attributes.has(this.getUID(v))){l[y]=s.attributes.get(this.getUID(v));continue}b=null;const x=v.array;y==="JOINTS_0"&&!(x instanceof Uint16Array)&&!(x instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),b=new it(new Uint16Array(x),v.itemSize,v.normalized));const T=this.processAccessor(b||v,a);T!==null&&(y.startsWith("_")||this.detectMeshQuantization(y,v),l[y]=T,s.attributes.set(this.getUID(v),T))}if(p!==void 0&&a.setAttribute("normal",p),Object.keys(l).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const y=[],v=[],R={};if(e.morphTargetDictionary!==void 0)for(const x in e.morphTargetDictionary)R[e.morphTargetDictionary[x]]=x;for(let x=0;x<e.morphTargetInfluences.length;++x){const T={};let L=!1;for(const N in a.morphAttributes){if(N!=="position"&&N!=="normal"){L||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),L=!0);continue}const O=a.morphAttributes[N][x],$=N.toUpperCase(),G=a.attributes[N];if(s.attributes.has(this.getUID(O,!0))){T[$]=s.attributes.get(this.getUID(O,!0));continue}const q=O.clone();if(!a.morphTargetsRelative)for(let H=0,K=O.count;H<K;H++)for(let te=0;te<O.itemSize;te++)te===0&&q.setX(H,O.getX(H)-G.getX(H)),te===1&&q.setY(H,O.getY(H)-G.getY(H)),te===2&&q.setZ(H,O.getZ(H)-G.getZ(H)),te===3&&q.setW(H,O.getW(H)-G.getW(H));T[$]=this.processAccessor(q,a),s.attributes.set(this.getUID(G,!0),T[$])}d.push(T),y.push(e.morphTargetInfluences[x]),e.morphTargetDictionary!==void 0&&v.push(R[x])}c.weights=y,v.length>0&&(c.extras={},c.extras.targetNames=v)}const f=Array.isArray(e.material);if(f&&a.groups.length===0)return null;let m=!1;if(f&&a.index===null){const y=[];for(let v=0,R=a.attributes.position.count;v<R;v++)y[v]=v;a.setIndex(y),m=!0}const B=f?e.material:[e.material],E=f?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,v=E.length;y<v;y++){const R={mode:r,attributes:l};if(this.serializeUserData(a,R),d.length>0&&(R.targets=d),a.index!==null){let T=this.getUID(a.index);(E[y].start!==void 0||E[y].count!==void 0)&&(T+=":"+E[y].start+":"+E[y].count),s.attributes.has(T)?R.indices=s.attributes.get(T):(R.indices=this.processAccessor(a.index,a,E[y].start,E[y].count),s.attributes.set(T,R.indices)),R.indices===null&&delete R.indices}const x=this.processMaterial(B[E[y].materialIndex]);x!==null&&(R.material=x),h.push(R)}m===!0&&a.setIndex(null),c.primitives=h,n.meshes||(n.meshes=[]),this._invokeAll(function(y){y.writeMesh&&y.writeMesh(e,c)});const w=n.meshes.push(c)-1;return s.meshes.set(o,w),w}detectMeshQuantization(e,t){if(this.extensionsUsed[Js])return;let s;switch(t.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}t.normalized&&(s+=" normalized");const n=e.split("_",1)[0];Co[n]&&Co[n].includes(s)&&(this.extensionsUsed[Js]=!0,this.extensionsRequired[Js]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const s=e.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:Qe.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const s=this.json,n=this.nodeMap;s.animations||(s.animations=[]),e=Pa.Utils.mergeMorphTargetTracks(e.clone(),t);const i=e.tracks,o=[],a=[];for(let r=0;r<i.length;++r){const c=i[r],l=Ct.parseTrackName(c.name);let h=Ct.findNode(t,l.nodeName);const d=Bo[l.propertyName];if(l.objectName==="bones"&&(h.isSkinnedMesh===!0?h=h.skeleton.getBoneByName(l.objectIndex):h=void 0),!h||!d){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name);continue}const g=1;let p=c.values.length/c.times.length;d===Bo.morphTargetInfluences&&(p/=h.morphTargetInfluences.length);let b;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(b="CUBICSPLINE",p/=3):c.getInterpolation()===Bi?b="STEP":b="LINEAR",a.push({input:this.processAccessor(new it(c.times,g)),output:this.processAccessor(new it(c.values,p)),interpolation:b}),o.push({sampler:a.length-1,target:{node:n.get(h),path:d}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:a,channels:o}),s.animations.length-1}processSkin(e){const t=this.json,s=this.nodeMap,n=t.nodes[s.get(e)],i=e.skeleton;if(i===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],r=new Float32Array(i.bones.length*16),c=new he;for(let h=0;h<i.bones.length;++h)a.push(s.get(i.bones[h])),c.copy(i.boneInverses[h]),c.multiply(e.bindMatrix).toArray(r,h*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new it(r,16)),joints:a,skeleton:s.get(o)}),n.skin=t.skins.length-1}processNode(e){const t={keep:!0};if(this._invokeAll(function(r){r.beforeWriteNode&&r.beforeWriteNode(e,t)}),t.keep!=!0)return null;const s=this.json,n=this.options,i=this.nodeMap;s.nodes||(s.nodes=[]);const o={};if(n.trs){const r=e.quaternion.toArray(),c=e.position.toArray(),l=e.scale.toArray();Pn(r,[0,0,0,1])||(o.rotation=r),Pn(c,[0,0,0])||(o.translation=c),Pn(l,[1,1,1])||(o.scale=l)}else e.matrixAutoUpdate&&e.updateMatrix(),Fh(e.matrix)===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const r=this.processMesh(e);r!==null&&(o.mesh=r)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const r=[];for(let c=0,l=e.children.length;c<l;c++){const h=e.children[c];if(h.visible||n.onlyVisible===!1){const d=this.processNode(h);d!==null&&r.push(d)}}r.length>0&&(o.children=r)}this._invokeAll(function(r){r.writeNode&&r.writeNode(e,o)});const a=s.nodes.push(o)-1;return i.set(e,a),a}processScene(e){const t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};e.name!==""&&(n.name=e.name),t.scenes.push(n);const i=[];for(let o=0,a=e.children.length;o<a;o++){const r=e.children[o];if(r.visible||s.onlyVisible===!1){const c=this.processNode(r);c!==null&&i.push(c)}}i.length>0&&(n.nodes=i),this.serializeUserData(e,n)}processObjects(e){const t=new ii;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(n){n.beforeParse&&n.beforeParse(e)});const s=[];for(let n=0;n<e.length;n++)e[n]instanceof ii?this.processScene(e[n]):s.push(e[n]);s.length>0&&this.processObjects(s);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll(function(n){n.afterParse&&n.afterParse(e)})}_invokeAll(e){for(let t=0,s=this.plugins.length;t<s;t++)e(this.plugins[t])}}class Uh{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const s=this.writer,n=s.json,i=s.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(1-e.penumbra)*e.angle,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},i[this.name]=!0);const a=n.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Gh{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Ph{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:s.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(o,e.clearcoatMap),i.clearcoatTexture=o}if(i.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:s.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(o,e.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:s.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(o.scale=e.clearcoatNormalScale.x),s.applyTextureTransform(o,e.clearcoatNormalMap),i.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Oh{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const n=this.writer.extensionsUsed,i={};i.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Hh{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:s.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(o,e.iridescenceMap),i.iridescenceTexture=o}if(i.iridescenceIor=e.iridescenceIOR,i.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],i.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:s.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(o,e.iridescenceThicknessMap),i.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class jh{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){const o={index:s.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(o,e.transmissionMap),i.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class qh{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.thicknessFactor=e.thickness,e.thicknessMap){const o={index:s.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(o,e.thicknessMap),i.thicknessTexture=o}e.attenuationDistance!==1/0&&(i.attenuationDistance=e.attenuationDistance),i.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class zh{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Kh{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(Th)&&!e.specularIntensityMap&&!e.specularColorMap)return;const s=this.writer,n=s.extensionsUsed,i={};if(e.specularIntensityMap){const o={index:s.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(o,e.specularIntensityMap),i.specularTexture=o}if(e.specularColorMap){const o={index:s.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(o,e.specularColorMap),i.specularColorTexture=o}i.specularFactor=e.specularIntensity,i.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Yh{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const s=this.writer,n=s.extensionsUsed,i={};if(e.sheenRoughnessMap){const o={index:s.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(o,e.sheenRoughnessMap),i.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:s.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(o,e.sheenColorMap),i.sheenColorTexture=o}i.sheenRoughnessFactor=e.sheenRoughness,i.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Jh{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const s=this.writer,n=s.extensionsUsed,i={};if(e.anisotropyMap){const o={index:s.processTexture(e.anisotropyMap)};s.applyTextureTransform(o,e.anisotropyMap),i.anisotropyTexture=o}i.anisotropyStrength=e.anisotropy,i.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Wh{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Vh{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const s=this.writer,n=s.extensionsUsed,i={};if(e.bumpMap){const o={index:s.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(o,e.bumpMap),i.bumpTexture=o}i.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Xh{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const s=this.writer,n=e,i=new Float32Array(n.count*3),o=new Float32Array(n.count*4),a=new Float32Array(n.count*3),r=new he,c=new U,l=new xe,h=new U;for(let g=0;g<n.count;g++)n.getMatrixAt(g,r),r.decompose(c,l,h),c.toArray(i,g*3),l.toArray(o,g*4),h.toArray(a,g*3);const d={TRANSLATION:s.processAccessor(new it(i,3)),ROTATION:s.processAccessor(new it(o,4)),SCALE:s.processAccessor(new it(a,3))};n.instanceColor&&(d._COLOR_0=s.processAccessor(n.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:d},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}Pa.Utils={insertKeyframe:function(A,e){const s=A.getValueSize(),n=new A.TimeBufferType(A.times.length+1),i=new A.ValueBufferType(A.values.length+s),o=A.createInterpolant(new A.ValueBufferType(s));let a;if(A.times.length===0){n[0]=e;for(let r=0;r<s;r++)i[r]=0;a=0}else if(e<A.times[0]){if(Math.abs(A.times[0]-e)<.001)return 0;n[0]=e,n.set(A.times,1),i.set(o.evaluate(e),0),i.set(A.values,s),a=0}else if(e>A.times[A.times.length-1]){if(Math.abs(A.times[A.times.length-1]-e)<.001)return A.times.length-1;n[n.length-1]=e,n.set(A.times,0),i.set(A.values,0),i.set(o.evaluate(e),A.values.length),a=n.length-1}else for(let r=0;r<A.times.length;r++){if(Math.abs(A.times[r]-e)<.001)return r;if(A.times[r]<e&&A.times[r+1]>e){n.set(A.times.slice(0,r+1),0),n[r+1]=e,n.set(A.times.slice(r+1),r+2),i.set(A.values.slice(0,(r+1)*s),0),i.set(o.evaluate(e),(r+1)*s),i.set(A.values.slice((r+1)*s),(r+2)*s),a=r+1;break}}return A.times=n,A.values=i,a},mergeMorphTargetTracks:function(A,e){const t=[],s={},n=A.tracks;for(let i=0;i<n.length;++i){let o=n[i];const a=Ct.parseTrackName(o.name),r=Ct.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Kn)}const c=r.morphTargetInfluences.length,l=r.morphTargetDictionary[a.propertyIndex];if(l===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(s[r.uuid]===void 0){h=o.clone();const g=new h.ValueBufferType(c*h.times.length);for(let p=0;p<h.times.length;p++)g[p*c+l]=h.values[p];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=g,s[r.uuid]=h,t.push(h);continue}const d=o.createInterpolant(new o.ValueBufferType(1));h=s[r.uuid];for(let g=0;g<h.times.length;g++)h.values[g*c+l]=d.evaluate(h.times[g]);for(let g=0;g<o.times.length;g++){const p=this.insertKeyframe(h,o.times[g]);h.values[p*c+l]=o.values[g]}}return A.tracks=t,A}};const _e={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Ha(A){const e=await fetch(A);if(e.ok)return e.json();throw new Error(e.statusText)}async function Zh(A){if(!A)throw new Error("No basePath supplied");return await Ha(`${A}/profilesList.json`)}async function $h(A,e,t=null,s=!0){if(!A)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const n=await Zh(e);let i;if(A.profiles.some(r=>{const c=n[r];return c&&(i={profileId:r,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!i}),!i){if(!t)throw new Error("No matching profile name found");const r=n[t];if(!r)throw new Error(`No matching profile name found and default profile "${t}" missing.`);i={profileId:t,profilePath:`${e}/${r.path}`,deprecated:!!r.deprecated}}const o=await Ha(i.profilePath);let a;if(s){let r;if(A.handedness==="any"?r=o.layouts[Object.keys(o.layouts)[0]]:r=o.layouts[A.handedness],!r)throw new Error(`No matching handedness, ${A.handedness}, in profile ${i.profileId}`);r.assetPath&&(a=i.profilePath.replace("profile.json",r.assetPath))}return{profile:o,assetPath:a}}const eu={xAxis:0,yAxis:0,button:0,state:_e.ComponentState.DEFAULT};function tu(A=0,e=0){let t=A,s=e;if(Math.sqrt(A*A+e*e)>1){const o=Math.atan2(e,A);t=Math.cos(o),s=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:s*.5+.5}}class nu{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===_e.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(eu)}updateFromComponent({xAxis:e,yAxis:t,button:s,state:n}){const{normalizedXAxis:i,normalizedYAxis:o}=tu(e,t);switch(this.componentProperty){case _e.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?i:.5;break;case _e.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?o:.5;break;case _e.ComponentProperty.BUTTON:this.value=this.states.includes(n)?s:0;break;case _e.ComponentProperty.STATE:this.valueNodeProperty===_e.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class su{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(s=>{const n=new nu(t.visualResponses[s]);this.visualResponses[s]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:_e.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=_e.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=_e.ComponentState.PRESSED:(t.touched||this.values.button>_e.ButtonTouchThreshold)&&(this.values.state=_e.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===_e.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>_e.AxisTouchThreshold&&(this.values.state=_e.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===_e.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>_e.AxisTouchThreshold&&(this.values.state=_e.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class iu{constructor(e,t,s){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=s,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(n=>{const i=this.layoutDescription.components[n];this.components[n]=new su(n,i)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const ou="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",au="generic-trigger";class ru extends bt{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(s=>{const{valueNode:n,minNode:i,maxNode:o,value:a,valueNodeProperty:r}=s;n&&(r===_e.VisualResponseProperty.VISIBILITY?n.visible=a:r===_e.VisualResponseProperty.TRANSFORM&&(n.quaternion.slerpQuaternions(i.quaternion,o.quaternion,a),n.position.lerpVectors(i.position,o.position,a)))})}))}}function Au(A,e){Object.values(A.components).forEach(t=>{const{type:s,touchPointNodeName:n,visualResponses:i}=t;if(s===_e.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(n),t.touchPointNode){const o=new fi(.001),a=new Tt({color:255}),r=new z(o,a);t.touchPointNode.add(r)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(i).forEach(o=>{const{valueNodeName:a,minNodeName:r,maxNodeName:c,valueNodeProperty:l}=o;if(l===_e.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(r),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${r} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function So(A,e){Au(A.motionController,e),A.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=A.envMap,t.material.needsUpdate=!0)}),A.layers.mask!=0&&e.traverse(t=>{t.layers.mask=A.layers.mask}),A.add(e)}class dd{constructor(e=null,t=null){this.gltfLoader=e,this.path=ou,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new Aa)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new ru;let s=null;return e.addEventListener("connected",n=>{const i=n.data;i.targetRayMode!=="tracked-pointer"||!i.gamepad||i.hand||$h(i,this.path,au).then(({profile:o,assetPath:a})=>{t.motionController=new iu(i,o,a);const r=this._assetCache[t.motionController.assetUrl];if(r)s=r.scene.clone(),So(t,s),this.onLoad&&this.onLoad(s);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,s=c.scene.clone(),So(t,s),this.onLoad&&this.onLoad(s)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(s),s=null}),t}}const cu="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class gd{constructor(e,t,s,n,i=null,o=null){this.controller=t,this.handModel=e,this.bones=[],i===null&&(i=new Aa,i.setPath(s||cu)),i.load(`${n}.glb`,a=>{const r=a.scene.children[0];this.handModel.add(r),r.layers.mask=this.handModel.layers.mask;const c=r.getObjectByProperty("type","SkinnedMesh");c.frustumCulled=!1,c.castShadow=!0,c.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(h=>{const d=r.getObjectByName(h);d!==void 0?d.jointName=h:console.warn(`Couldn't find ${h} in ${n} hand mesh`),this.bones.push(d)}),o&&o(r)})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const s=this.bones[t];if(s){const n=e[s.jointName];if(n.visible){const i=n.position;s.position.copy(i),s.quaternion.copy(n.quaternion)}}}}}const vo=new Cs,is=new U;class ja extends hA{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new Fe(e,3)),this.setAttribute("uv",new Fe(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,s=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),s.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new oi(t,6,1);return this.setAttribute("instanceStart",new on(s,3,0)),this.setAttribute("instanceEnd",new on(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new oi(t,6,1);return this.setAttribute("instanceColorStart",new on(s,3,0)),this.setAttribute("instanceColorEnd",new on(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new uA(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Cs);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),vo.setFromBufferAttribute(t),this.boundingBox.union(vo))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let n=0;for(let i=0,o=e.count;i<o;i++)is.fromBufferAttribute(e,i),n=Math.max(n,s.distanceToSquared(is)),is.fromBufferAttribute(t,i),n=Math.max(n,s.distanceToSquared(is));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}On.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ne(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};St.line={uniforms:mi.merge([On.common,On.fog,On.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class qa extends ta{constructor(e){super({type:"LineMaterial",uniforms:mi.clone(St.line.uniforms),vertexShader:St.line.vertexShader,fragmentShader:St.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Vs=new Ot,To=new U,_o=new U,Ue=new Ot,Ge=new Ot,yt=new Ot,Xs=new U,Zs=new he,Oe=new dA,Ro=new U,os=new Cs,as=new wi,Qt=new Ot;let vt,cn;function Do(A,e,t){return Qt.set(0,0,-e,1).applyMatrix4(A.projectionMatrix),Qt.multiplyScalar(1/Qt.w),Qt.x=cn/t.width,Qt.y=cn/t.height,Qt.applyMatrix4(A.projectionMatrixInverse),Qt.multiplyScalar(1/Qt.w),Math.abs(Math.max(Qt.x,Qt.y))}function lu(A,e){const t=A.matrixWorld,s=A.geometry,n=s.attributes.instanceStart,i=s.attributes.instanceEnd,o=Math.min(s.instanceCount,n.count);for(let a=0,r=o;a<r;a++){Oe.start.fromBufferAttribute(n,a),Oe.end.fromBufferAttribute(i,a),Oe.applyMatrix4(t);const c=new U,l=new U;vt.distanceSqToSegment(Oe.start,Oe.end,l,c),l.distanceTo(c)<cn*.5&&e.push({point:l,pointOnLine:c,distance:vt.origin.distanceTo(l),object:A,face:null,faceIndex:a,uv:null,uv1:null})}}function hu(A,e,t){const s=e.projectionMatrix,i=A.material.resolution,o=A.matrixWorld,a=A.geometry,r=a.attributes.instanceStart,c=a.attributes.instanceEnd,l=Math.min(a.instanceCount,r.count),h=-e.near;vt.at(1,yt),yt.w=1,yt.applyMatrix4(e.matrixWorldInverse),yt.applyMatrix4(s),yt.multiplyScalar(1/yt.w),yt.x*=i.x/2,yt.y*=i.y/2,yt.z=0,Xs.copy(yt),Zs.multiplyMatrices(e.matrixWorldInverse,o);for(let d=0,g=l;d<g;d++){if(Ue.fromBufferAttribute(r,d),Ge.fromBufferAttribute(c,d),Ue.w=1,Ge.w=1,Ue.applyMatrix4(Zs),Ge.applyMatrix4(Zs),Ue.z>h&&Ge.z>h)continue;if(Ue.z>h){const E=Ue.z-Ge.z,w=(Ue.z-h)/E;Ue.lerp(Ge,w)}else if(Ge.z>h){const E=Ge.z-Ue.z,w=(Ge.z-h)/E;Ge.lerp(Ue,w)}Ue.applyMatrix4(s),Ge.applyMatrix4(s),Ue.multiplyScalar(1/Ue.w),Ge.multiplyScalar(1/Ge.w),Ue.x*=i.x/2,Ue.y*=i.y/2,Ge.x*=i.x/2,Ge.y*=i.y/2,Oe.start.copy(Ue),Oe.start.z=0,Oe.end.copy(Ge),Oe.end.z=0;const b=Oe.closestPointToPointParameter(Xs,!0);Oe.at(b,Ro);const f=Qe.lerp(Ue.z,Ge.z,b),m=f>=-1&&f<=1,B=Xs.distanceTo(Ro)<cn*.5;if(m&&B){Oe.start.fromBufferAttribute(r,d),Oe.end.fromBufferAttribute(c,d),Oe.start.applyMatrix4(o),Oe.end.applyMatrix4(o);const E=new U,w=new U;vt.distanceSqToSegment(Oe.start,Oe.end,w,E),t.push({point:w,pointOnLine:E,distance:vt.origin.distanceTo(w),object:A,face:null,faceIndex:d,uv:null,uv1:null})}}}class uu extends z{constructor(e=new ja,t=new qa({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,s=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,a=0,r=t.count;o<r;o++,a+=2)To.fromBufferAttribute(t,o),_o.fromBufferAttribute(s,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+To.distanceTo(_o);const i=new oi(n,2,1);return e.setAttribute("instanceDistanceStart",new on(i,1,0)),e.setAttribute("instanceDistanceEnd",new on(i,1,1)),this}raycast(e,t){const s=this.material.worldUnits,n=e.camera;n===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const i=e.params.Line2!==void 0&&e.params.Line2.threshold||0;vt=e.ray;const o=this.matrixWorld,a=this.geometry,r=this.material;cn=r.linewidth+i,a.boundingSphere===null&&a.computeBoundingSphere(),as.copy(a.boundingSphere).applyMatrix4(o);let c;if(s)c=cn*.5;else{const h=Math.max(n.near,as.distanceToPoint(vt.origin));c=Do(n,h,r.resolution)}if(as.radius+=c,vt.intersectsSphere(as)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),os.copy(a.boundingBox).applyMatrix4(o);let l;if(s)l=cn*.5;else{const h=Math.max(n.near,os.distanceToPoint(vt.origin));l=Do(n,h,r.resolution)}os.expandByScalar(l),vt.intersectsBox(os)!==!1&&(s?lu(this,t):hu(this,n,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Vs),this.material.uniforms.resolution.value.set(Vs.z,Vs.w))}}class du extends ja{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,s=new Float32Array(2*t);for(let n=0;n<t;n+=3)s[2*n]=e[n],s[2*n+1]=e[n+1],s[2*n+2]=e[n+2],s[2*n+3]=e[n+3],s[2*n+4]=e[n+4],s[2*n+5]=e[n+5];return super.setPositions(s),this}setColors(e){const t=e.length-3,s=new Float32Array(2*t);for(let n=0;n<t;n+=3)s[2*n]=e[n],s[2*n+1]=e[n+1],s[2*n+2]=e[n+2],s[2*n+3]=e[n+3],s[2*n+4]=e[n+4],s[2*n+5]=e[n+5];return super.setColors(s),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class pd extends uu{constructor(e=new du,t=new qa({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class fd extends z{constructor(e){const t=new gu(e),s=new Qi(t.image.width*.001,t.image.height*.001),n=new Tt({map:t,toneMapped:!1,transparent:!0});super(s,n);function i(o){n.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",i),this.addEventListener("mousemove",i),this.addEventListener("mouseup",i),this.addEventListener("click",i),this.dispose=function(){s.dispose(),n.dispose(),n.map.dispose(),gi.delete(e),this.removeEventListener("mousedown",i),this.removeEventListener("mousemove",i),this.removeEventListener("mouseup",i),this.removeEventListener("click",i)}}}class gu extends na{constructor(e){super(Mo(e)),this.dom=e,this.anisotropy=16,this.colorSpace=ge,this.minFilter=Et,this.magFilter=Et;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),s={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,s),this.observer=t}dispatchDOMEvent(e){e.data&&pu(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=Mo(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const gi=new WeakMap;function Mo(A){const e=document.createRange(),t=new Te;function s(d){const g=[];let p=!1;function b(){if(p&&(p=!1,d.restore()),g.length===0)return;let f=-1/0,m=-1/0,B=1/0,E=1/0;for(let w=0;w<g.length;w++){const y=g[w];f=Math.max(f,y.x),m=Math.max(m,y.y),B=Math.min(B,y.x+y.width),E=Math.min(E,y.y+y.height)}d.save(),d.beginPath(),d.rect(f,m,B-f,E-m),d.clip(),p=!0}return{add:function(f){g.push(f),b()},remove:function(){g.pop(),b()}}}function n(d,g,p,b){b!==""&&(d.textTransform==="uppercase"&&(b=b.toUpperCase()),l.font=d.fontWeight+" "+d.fontSize+" "+d.fontFamily,l.textBaseline="top",l.fillStyle=d.color,l.fillText(b,g,p+parseFloat(d.fontSize)*.1))}function i(d,g,p,b,f){p<2*f&&(f=p/2),b<2*f&&(f=b/2),l.beginPath(),l.moveTo(d+f,g),l.arcTo(d+p,g,d+p,g+b,f),l.arcTo(d+p,g+b,d,g+b,f),l.arcTo(d,g+b,d,g,f),l.arcTo(d,g,d+p,g,f),l.closePath()}function o(d,g,p,b,f,m){const B=d[g+"Width"],E=d[g+"Style"],w=d[g+"Color"];B!=="0px"&&E!=="none"&&w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(l.strokeStyle=w,l.lineWidth=parseFloat(B),l.beginPath(),l.moveTo(p,b),l.lineTo(p+f,b+m),l.stroke())}function a(d,g){if(d.nodeType===Node.COMMENT_NODE||d.nodeName==="SCRIPT"||d.style&&d.style.display==="none")return;let p=0,b=0,f=0,m=0;if(d.nodeType===Node.TEXT_NODE){e.selectNode(d);const E=e.getBoundingClientRect();p=E.left-r.left-.5,b=E.top-r.top-.5,f=E.width,m=E.height,n(g,p,b,d.nodeValue.trim())}else if(d instanceof HTMLCanvasElement){const E=d.getBoundingClientRect();p=E.left-r.left-.5,b=E.top-r.top-.5,l.save();const w=window.devicePixelRatio;l.scale(1/w,1/w),l.drawImage(d,p,b),l.restore()}else if(d instanceof HTMLImageElement){const E=d.getBoundingClientRect();p=E.left-r.left-.5,b=E.top-r.top-.5,f=E.width,m=E.height,l.drawImage(d,p,b,f,m)}else{const E=d.getBoundingClientRect();p=E.left-r.left-.5,b=E.top-r.top-.5,f=E.width,m=E.height,g=window.getComputedStyle(d),i(p,b,f,m,parseFloat(g.borderRadius));const w=g.backgroundColor;w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(l.fillStyle=w,l.fill());const y=["borderTop","borderLeft","borderBottom","borderRight"];let v=!0,R=null;for(const x of y){if(R!==null&&(v=g[x+"Width"]===g[R+"Width"]&&g[x+"Color"]===g[R+"Color"]&&g[x+"Style"]===g[R+"Style"]),v===!1)break;R=x}if(v===!0){const x=parseFloat(g.borderTopWidth);g.borderTopWidth!=="0px"&&g.borderTopStyle!=="none"&&g.borderTopColor!=="transparent"&&g.borderTopColor!=="rgba(0, 0, 0, 0)"&&(l.strokeStyle=g.borderTopColor,l.lineWidth=x,l.stroke())}else o(g,"borderTop",p,b,f,0),o(g,"borderLeft",p,b,0,m),o(g,"borderBottom",p,b+m,f,0),o(g,"borderRight",p+f,b,0,m);if(d instanceof HTMLInputElement){let x=g.accentColor;(x===void 0||x==="auto")&&(x=g.color),t.set(x);const L=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(d.type==="radio"&&(i(p,b,f,m,m),l.fillStyle="white",l.strokeStyle=x,l.lineWidth=1,l.fill(),l.stroke(),d.checked&&(i(p+2,b+2,f-4,m-4,m),l.fillStyle=x,l.strokeStyle=L,l.lineWidth=2,l.fill(),l.stroke())),d.type==="checkbox"&&(i(p,b,f,m,2),l.fillStyle=d.checked?x:"white",l.strokeStyle=d.checked?L:x,l.lineWidth=1,l.stroke(),l.fill(),d.checked)){const N=l.textAlign;l.textAlign="center";const O={color:L,fontFamily:g.fontFamily,fontSize:m+"px",fontWeight:"bold"};n(O,p+f/2,b,"✔"),l.textAlign=N}if(d.type==="range"){const[N,O,$]=["min","max","value"].map(q=>parseFloat(d[q])),G=($-N)/(O-N)*(f-m);i(p,b+m/4,f,m/2,m/4),l.fillStyle=L,l.strokeStyle=x,l.lineWidth=1,l.fill(),l.stroke(),i(p,b+m/4,G+m/2,m/2,m/4),l.fillStyle=x,l.fill(),i(p+G,b,m,m,m/2),l.fillStyle=x,l.fill()}(d.type==="color"||d.type==="text"||d.type==="number")&&(h.add({x:p,y:b,width:f,height:m}),n(g,p+parseInt(g.paddingLeft),b+parseInt(g.paddingTop),d.value),h.remove())}}const B=g.overflow==="auto"||g.overflow==="hidden";B&&h.add({x:p,y:b,width:f,height:m});for(let E=0;E<d.childNodes.length;E++)a(d.childNodes[E],g);B&&h.remove()}const r=A.getBoundingClientRect();let c=gi.get(A);c===void 0&&(c=document.createElement("canvas"),c.width=r.width,c.height=r.height,gi.set(A,c));const l=c.getContext("2d"),h=new s(l);return l.clearRect(0,0,c.width,c.height),a(A),c}function pu(A,e,t,s){const n={clientX:t*A.offsetWidth+A.offsetLeft,clientY:s*A.offsetHeight+A.offsetTop,view:A.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,n));const i=A.getBoundingClientRect();t=t*i.width+i.left,s=s*i.height+i.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const r=a.getBoundingClientRect();if(t>r.left&&t<r.right&&s>r.top&&s<r.bottom&&(a.dispatchEvent(new MouseEvent(e,n)),a instanceof HTMLInputElement&&a.type==="range"&&(e==="mousedown"||e==="click"))){const[c,l]=["min","max"].map(p=>parseFloat(a[p])),h=r.width,g=(t-r.x)/h;a.value=c+(l-c)*g,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let c=0;c<a.childNodes.length;c++)o(a.childNodes[c])}}o(A)}const hs=new Ne,fn={type:"",data:hs},ko=new yi;class md extends An{listenToPointerEvents(e,t){const s=this,n=new yi,i=e.domElement;function o(a){a.stopPropagation();const r=e.domElement.getBoundingClientRect();hs.x=(a.clientX-r.left)/r.width*2-1,hs.y=-(a.clientY-r.top)/r.height*2+1,n.setFromCamera(hs,t);const c=n.intersectObjects(s.children,!1);if(c.length>0){const l=c[0],h=l.object,d=l.uv;fn.type=a.type,fn.data.set(d.x,1-d.y),h.dispatchEvent(fn)}}i.addEventListener("pointerdown",o),i.addEventListener("pointerup",o),i.addEventListener("pointermove",o),i.addEventListener("mousedown",o),i.addEventListener("mouseup",o),i.addEventListener("mousemove",o),i.addEventListener("click",o)}listenToXRControllerEvents(e){const t=this,s={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function n(i){const o=i.target;ko.setFromXRController(o);const a=ko.intersectObjects(t.children,!1);if(a.length>0){const r=a[0],c=r.object,l=r.uv;fn.type=s[i.type],fn.data.set(l.x,1-l.y),c.dispatchEvent(fn)}}e.addEventListener("move",n),e.addEventListener("select",n),e.addEventListener("selectstart",n),e.addEventListener("selectend",n)}}const Mn=new U,kn=new U,Fo=new ea;class Id extends us{constructor(e,t=1,s=16711680){const n=new pt,i=e.geometry.attributes.normal.count,o=new Fe(i*2*3,3);n.setAttribute("position",o),super(n,new Pt({color:s,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),Fo.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,t=this.geometry.attributes.position,s=this.object.geometry;if(s){const n=s.attributes.position,i=s.attributes.normal;let o=0;for(let a=0,r=n.count;a<r;a++)Mn.fromBufferAttribute(n,a).applyMatrix4(e),kn.fromBufferAttribute(i,a),kn.applyMatrix3(Fo).normalize().multiplyScalar(this.size).add(Mn),t.setXYZ(o,Mn.x,Mn.y,Mn.z),o=o+1,t.setXYZ(o,kn.x,kn.y,kn.z),o=o+1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}const Lo=new U,fu=new xe,No=new U;class bd extends bt{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const xt=new he,mu=new he;class Ed{constructor(e={}){const t=this;let s,n,i,o;const a={camera:{style:""},objects:new WeakMap},r=e.element!==void 0?e.element:document.createElement("div");r.style.overflow="hidden",this.domElement=r;const c=document.createElement("div");c.style.transformOrigin="0 0",c.style.pointerEvents="none",r.appendChild(c);const l=document.createElement("div");l.style.transformStyle="preserve-3d",c.appendChild(l),this.getSize=function(){return{width:s,height:n}},this.render=function(f,m){const B=m.projectionMatrix.elements[5]*o;m.view&&m.view.enabled?(c.style.transform=`translate( ${-m.view.offsetX*(s/m.view.width)}px, ${-m.view.offsetY*(n/m.view.height)}px )`,c.style.transform+=`scale( ${m.view.fullWidth/m.view.width}, ${m.view.fullHeight/m.view.height} )`):c.style.transform="",f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld();let E,w;m.isOrthographicCamera&&(E=-(m.right+m.left)/2,w=(m.top+m.bottom)/2);const y=m.view&&m.view.enabled?m.view.height/m.view.fullHeight:1,v=m.isOrthographicCamera?`scale( ${y} )scale(`+B+")translate("+h(E)+"px,"+h(w)+"px)"+d(m.matrixWorldInverse):`scale( ${y} )translateZ(`+B+"px)"+d(m.matrixWorldInverse),x=(m.isPerspectiveCamera?"perspective("+B+"px) ":"")+v+"translate("+i+"px,"+o+"px)";a.camera.style!==x&&(l.style.transform=x,a.camera.style=x),b(f,f,m)},this.setSize=function(f,m){s=f,n=m,i=s/2,o=n/2,r.style.width=f+"px",r.style.height=m+"px",c.style.width=f+"px",c.style.height=m+"px",l.style.width=f+"px",l.style.height=m+"px"};function h(f){return Math.abs(f)<1e-10?0:f}function d(f){const m=f.elements;return"matrix3d("+h(m[0])+","+h(-m[1])+","+h(m[2])+","+h(m[3])+","+h(m[4])+","+h(-m[5])+","+h(m[6])+","+h(m[7])+","+h(m[8])+","+h(-m[9])+","+h(m[10])+","+h(m[11])+","+h(m[12])+","+h(-m[13])+","+h(m[14])+","+h(m[15])+")"}function g(f){const m=f.elements;return"translate(-50%,-50%)"+("matrix3d("+h(m[0])+","+h(m[1])+","+h(m[2])+","+h(m[3])+","+h(-m[4])+","+h(-m[5])+","+h(-m[6])+","+h(-m[7])+","+h(m[8])+","+h(m[9])+","+h(m[10])+","+h(m[11])+","+h(m[12])+","+h(m[13])+","+h(m[14])+","+h(m[15])+")")}function p(f){f.isCSS3DObject&&(f.element.style.display="none");for(let m=0,B=f.children.length;m<B;m++)p(f.children[m])}function b(f,m,B,E){if(f.visible===!1){p(f);return}if(f.isCSS3DObject){const w=f.layers.test(B.layers)===!0,y=f.element;if(y.style.display=w===!0?"":"none",w===!0){f.onBeforeRender(t,m,B);let v;f.isCSS3DSprite?(xt.copy(B.matrixWorldInverse),xt.transpose(),f.rotation2D!==0&&xt.multiply(mu.makeRotationZ(f.rotation2D)),f.matrixWorld.decompose(Lo,fu,No),xt.setPosition(Lo),xt.scale(No),xt.elements[3]=0,xt.elements[7]=0,xt.elements[11]=0,xt.elements[15]=1,v=g(xt)):v=g(f.matrixWorld);const R=a.objects.get(f);if(R===void 0||R.style!==v){y.style.transform=v;const x={style:v};a.objects.set(f,x)}y.parentNode!==l&&l.appendChild(y),f.onAfterRender(t,m,B)}}for(let w=0,y=f.children.length;w<y;w++)b(f.children[w],m,B)}}}const Iu={mx_srgb_texture_to_lin_rec709:dc};class Z{constructor(e,t,s=[]){this.name=e,this.nodeFunc=t,this.params=s}}const bu=(A,e=Ye(0))=>JA(A,e),Eu=(A,e=Ye(0))=>aa(A,e),Cu=(A,e=Ye(1))=>As(A,e),Bu=(A,e=Ye(1))=>WA(A,e),wu=(A,e=Ye(1))=>VA(A,e),yu=(A,e=Ye(1))=>XA(A,e),Qu=(A=Ye(0),e=Ye(1))=>ZA(A,e),xu=()=>$A(),Su=()=>ec,vu=(A,e=Ye(1))=>aa(e,A),$s=(A,e)=>tc(A,e.at(-1)),Tu=(A,e)=>A.element(e),_u=[new Z("add",bu,["in1","in2"]),new Z("subtract",Eu,["in1","in2"]),new Z("multiply",Cu,["in1","in2"]),new Z("divide",Bu,["in1","in2"]),new Z("modulo",wu,["in1","in2"]),new Z("absval",gA,["in1","in2"]),new Z("sign",pA,["in1","in2"]),new Z("floor",fA,["in1","in2"]),new Z("ceil",mA,["in1","in2"]),new Z("round",IA,["in1","in2"]),new Z("power",yu,["in1","in2"]),new Z("sin",bA,["in"]),new Z("cos",EA,["in"]),new Z("tan",CA,["in"]),new Z("asin",BA,["in"]),new Z("acos",wA,["in"]),new Z("atan2",Qu,["in1","in2"]),new Z("sqrt",yA,["in"]),new Z("exp",QA,["in"]),new Z("clamp",xA,["in","low","high"]),new Z("min",SA,["in1","in2"]),new Z("max",vA,["in1","in2"]),new Z("normalize",TA,["in"]),new Z("magnitude",_A,["in1","in2"]),new Z("dotproduct",RA,["in1","in2"]),new Z("crossproduct",DA,["in"]),new Z("invert",vu,["in","amount"]),new Z("normalmap",MA,["in","scale"]),new Z("remap",kA,["in","inlow","inhigh","outlow","outhigh"]),new Z("smoothstep",FA,["in","low","high"]),new Z("luminance",LA,["in","lumacoeffs"]),new Z("rgbtohsv",NA,["in"]),new Z("hsvtorgb",UA,["in"]),new Z("mix",GA,["bg","fg","mix"]),new Z("combine2",sa,["in1","in2"]),new Z("combine3",ia,["in1","in2","in3"]),new Z("combine4",oa,["in1","in2","in3","in4"]),new Z("ramplr",PA,["valuel","valuer","texcoord"]),new Z("ramptb",OA,["valuet","valueb","texcoord"]),new Z("splitlr",HA,["valuel","valuer","texcoord"]),new Z("splittb",jA,["valuet","valueb","texcoord"]),new Z("noise2d",Ui,["texcoord","amplitude","pivot"]),new Z("noise3d",Ui,["texcoord","amplitude","pivot"]),new Z("fractal3d",qA,["position","octaves","lacunarity","diminish","amplitude"]),new Z("cellnoise2d",Gi,["texcoord"]),new Z("cellnoise3d",Gi,["texcoord"]),new Z("worleynoise2d",Pi,["texcoord","jitter"]),new Z("worleynoise3d",Pi,["texcoord","jitter"]),new Z("safepower",zA,["in1","in2"]),new Z("contrast",KA,["in","amount","pivot"]),new Z("saturate",YA,["in","amount"]),new Z("extract",Tu,["in","index"]),new Z("separate2",$s,["in"]),new Z("separate3",$s,["in"]),new Z("separate4",$s,["in"]),new Z("time",xu),new Z("frame",Su)],pi={};_u.forEach(A=>pi[A.name]=A);class Cd extends Dt{constructor(e){super(e)}load(e,t,s,n){const i=function(o){n?n(o):console.error(o)};return new gt(this.manager).setPath(this.path).load(e,async o=>{try{t(this.parse(o))}catch(a){i(a)}},s,i),this}parse(e){return new Du(this.manager,this.path).parse(e)}}class Ru{constructor(e,t,s=""){this.materialX=e,this.nodeXML=t,this.nodePath=s?s+"/"+this.name:this.name,this.parent=null,this.node=null,this.children=[]}get element(){return this.nodeXML.nodeName}get nodeGraph(){return this.getAttribute("nodegraph")}get nodeName(){return this.getAttribute("nodename")}get interfaceName(){return this.getAttribute("interfacename")}get output(){return this.getAttribute("output")}get name(){return this.getAttribute("name")}get type(){return this.getAttribute("type")}get value(){return this.getAttribute("value")}getNodeGraph(){let e=this;for(;e!==null&&e.element!=="nodegraph";)e=e.parent;return e}getRoot(){let e=this;for(;e.parent!==null;)e=e.parent;return e}get referencePath(){let e=null;if(this.nodeGraph!==null&&this.output!==null)e=this.nodeGraph+"/"+this.output;else if(this.nodeName!==null||this.interfaceName!==null){const t=this.getNodeGraph();e=(t?t.nodePath+"/":"")+(this.nodeName||this.interfaceName)}return e}get hasReference(){return this.referencePath!==null}get isConst(){return this.element==="input"&&this.value!==null&&this.type!=="filename"}getColorSpaceNode(){const e=this.getAttribute("colorspace"),t=this.getRoot().getAttribute("colorspace"),s=`mx_${e}_to_${t}`;return Iu[s]}getTexture(){const e=this.getRecursiveAttribute("fileprefix")||"";let t=this.materialX.textureLoader;const s=e+this.value;if(s){const i=this.materialX.manager.getHandler(s);i!==null&&(t=i)}const n=t.load(s);return n.wrapS=n.wrapT=Vt,n.flipY=!1,n.name=s,n}getClassFromType(e){let t=null;return e==="integer"?t=gc:e==="float"?t=Ye:e==="vector2"?t=sa:e==="vector3"?t=ia:e==="vector4"||e==="color4"?t=oa:e==="color3"?t=Hi:e==="boolean"&&(t=pc),t}getNode(e=null){let t=this.node;if(t!==null&&e===null)return t;const s=this.type;if(this.isConst)t=this.getClassFromType(s)(...this.getVector());else if(this.hasReference)this.element==="output"&&this.output&&e===null&&(e=this.output),t=this.materialX.getMaterialXNode(this.referencePath).getNode(e);else{const i=this.element;if(i==="convert")t=this.getClassFromType(s)(this.getNodeByName("in"));else if(i==="constant")t=this.getNodeByName("value");else if(i==="position")t=this.getAttribute("space")==="world"?nc:sc;else if(i==="normal")t=this.getAttribute("space")==="world"?ic:oc;else if(i==="tangent")t=this.getAttribute("space")==="world"?ac:rc;else if(i==="texcoord"){const o=this.getChildByName("index"),a=o?parseInt(o.value):0;t=Ac(a)}else if(i==="geomcolor"){const o=this.getChildByName("index"),a=o?parseInt(o.value):0;t=cc(a)}else if(i==="tiledimage"){const o=this.getChildByName("file"),a=o.getTexture(),r=lc(...this.getNodesByNames(["uvtiling","uvoffset"]));t=Oi(a,r);const c=o.getColorSpaceNode();c&&(t=c(t))}else if(i==="image"){const o=this.getChildByName("file"),a=this.getNodeByName("texcoord"),r=o.getTexture();t=Oi(r,a);const c=o.getColorSpaceNode();c&&(t=c(t))}else if(pi[i]!==void 0){const o=pi[i];e!==null?t=o.nodeFunc(...this.getNodesByNames(...o.params),e):t=o.nodeFunc(...this.getNodesByNames(...o.params))}}t===null&&(console.warn(`THREE.MaterialXLoader: Unexpected node ${new XMLSerializer().serializeToString(this.nodeXML)}.`),t=Ye(0));const n=this.getClassFromType(s);return n!==null&&(t=n(t)),t.name=this.name,this.node=t,t}getChildByName(e){for(const t of this.children)if(t.name===e)return t}getNodes(){const e={};for(const t of this.children){const s=t.getNode();e[s.name]=s}return e}getNodeByName(e){const t=this.getChildByName(e);return t?t.getNode(t.output):void 0}getNodesByNames(...e){const t=[];for(const s of e){const n=this.getNodeByName(s);n&&t.push(n)}return t}getValue(){return this.value.trim()}getVector(){const e=[];for(const t of this.getValue().split(/[,|\s]/))t!==""&&e.push(Number(t.trim()));return e}getAttribute(e){return this.nodeXML.getAttribute(e)}getRecursiveAttribute(e){let t=this.nodeXML.getAttribute(e);return t===null&&this.parent!==null&&(t=this.parent.getRecursiveAttribute(e)),t}setStandardSurfaceToGltfPBR(e){const t=this.getNodes();let s=null;t.base&&t.base_color?s=As(t.base,t.base_color):t.base?s=t.base:t.base_color&&(s=t.base_color);let n=null;t.specular_roughness&&(n=t.specular_roughness);let i=null;t.metalness&&(i=t.metalness);let o=null,a=null;t.coat&&(o=t.coat),t.coat_roughness&&(a=t.coat_roughness),t.coat_color&&(s=s&&As(s,t.coat_color));let r=null;t.normal&&(r=t.normal);let c=null;t.emission&&(c=t.emission),t.emissionColor&&(c=c&&As(c,t.emissionColor)),e.colorNode=s||Hi(.8,.8,.8),e.roughnessNode=n||Ye(.2),e.metalnessNode=i||Ye(0),e.clearcoatNode=o||Ye(0),e.clearcoatRoughnessNode=a||Ye(0),r&&(e.normalNode=r),c&&(e.emissiveNode=c)}setMaterial(e){const t=this.element;t==="gltf_pbr"||t==="standard_surface"&&this.setStandardSurfaceToGltfPBR(e)}toBasicMaterial(){const e=new hc;e.name=this.name;for(const t of this.children.toReversed())if(t.name==="out"){e.colorNode=t.getNode();break}return e}toPhysicalMaterial(){const e=new uc;e.name=this.name;for(const t of this.children)this.materialX.getMaterialXNode(t.nodeName).setMaterial(e);return e}toMaterials(){const e={};let t=!0;for(const s of this.children)if(s.element==="surfacematerial"){const n=s.toPhysicalMaterial();e[n.name]=n,t=!1}if(t){for(const s of this.children)if(s.element==="nodegraph"){const n=s.toBasicMaterial();e[n.name]=n}}return e}add(e){e.parent=this,this.children.push(e)}}class Du{constructor(e,t){this.manager=e,this.path=t,this.resourcePath="",this.nodesXLib=new Map,this.textureLoader=new bs(e)}addMaterialXNode(e){this.nodesXLib.set(e.nodePath,e)}getMaterialXNode(...e){return this.nodesXLib.get(e.join("/"))}parseNode(e,t=""){const s=new Ru(this,e,t);s.nodePath&&this.addMaterialXNode(s);for(const n of e.children){const i=this.parseNode(n,s.nodePath);s.add(i)}return s}parse(e){const t=new DOMParser().parseFromString(e,"application/xml").documentElement;return this.textureLoader.setPath(this.path),{materials:this.parseNode(t).toMaterials()}}}class Bd{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}new jo(-1,1,1,-1,0,1);class Mu extends pt{constructor(){super(),this.setAttribute("position",new Fe([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Fe([0,2,0,0,2,0],2))}}new Mu;const ut={node:"node",material:"material",camera:"camera",light:"light"},nn="KHR_animation_pointer",ku={CUBICSPLINE:void 0,LINEAR:Kn,STEP:Bi},Uo=Ct.findNode;let Go=!1;class Fu{constructor(e){this.parser=e,this.name=nn,this.animationPointerResolver=null}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}_patchPropertyBindingFindNode(){Go||(Go=!0,Ct.findNode=function(e,t){if(t.startsWith(".materials.")){const s=t.substring(11).substring(t.indexOf(".")),n=s.indexOf("."),i=n<0?s:s.substring(0,n);let o=null;return e.traverse(a=>{o!==null||a.type!=="Mesh"&&a.type!=="SkinnedMesh"||a.material&&(a.material.uuid===i||a.material.name===i)&&(o=a.material,o!==null&&(s.endsWith(".map")?o=o.map:s.endsWith(".emissiveMap")&&(o=o.emissiveMap)))}),o}else if(t.startsWith(".nodes.")||t.startsWith(".lights.")||t.startsWith(".cameras.")){const s=t.split(".");let n;for(let i=1;i<s.length;i++){const o=s[i];if(o.length==36)n=e.getObjectByProperty("uuid",o);else if(n&&n[o]){const r=Number.parseInt(o);let c=o;r>=0&&(c=r),n=n[c]}else{const r=e.getObjectByName(o);r&&(n=r)}}if(!n){const i=Uo(e,s[2]);return i||console.warn(nn+": Property binding not found",t,e,e.name,s),i}return n}return Uo(e,t)})}loadAnimationTargetFromChannel(e){const t=e.target,s=t.node!==void 0?t.node:t.id;return this.parser.getDependency("node",s)}loadAnimationTargetFromChannelWithAnimationPointer(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const t=e.target,s=t.extensions&&t.extensions[nn]&&t.path&&t.path==="pointer";if(!s)return null;let n,i=ut.node,o;if(s){const r=t.extensions[nn];let c=r.pointer;if(!c){console.warn("Invalid path",r,t);return}if(c.startsWith("/materials/")?i=ut.material:c.startsWith("/extensions/KHR_lights_punctual/lights/")?i=ut.light:c.startsWith("/cameras/")&&(i=ut.camera),o=this._tryResolveTargetId(c,i),o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,c);return}switch(i){case ut.material:const h=("/materials/"+o.toString()+"/").length,d=c.substring(0,h);switch(n=c.substring(h),n){case"pbrMetallicRoughness/baseColorFactor":n="color";break;case"pbrMetallicRoughness/roughnessFactor":n="roughness";break;case"pbrMetallicRoughness/metallicFactor":n="metalness";break;case"emissiveFactor":n="emissive";break;case"alphaCutoff":n="alphaTest";break;case"occlusionTexture/strength":n="aoMapIntensity";break;case"normalTexture/scale":n="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":n="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":n="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":n="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":n="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":n="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":n="transmission";break;case"extensions/KHR_materials_ior/ior":n="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":n="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":n="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":n="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":n="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":n="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":n="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":n="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":n="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":n="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":n="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":n="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":n="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":n="specularColor";break}c=d+n;break;case ut.node:const g=("/nodes/"+o.toString()+"/").length,p=c.substring(0,g);switch(n=c.substring(g),n){case"translation":n="position";break;case"rotation":n="quaternion";break;case"scale":n="scale";break;case"weights":n="morphTargetInfluences";break}c=p+n;break;case ut.light:const b=("/extensions/KHR_lights_punctual/lights/"+o.toString()+"/").length;switch(n=c.substring(b),n){case"color":break;case"intensity":break;case"spot/innerConeAngle":n="penumbra";break;case"spot/outerConeAngle":n="angle";break;case"range":n="distance";break}c="/lights/"+o.toString()+"/"+n;break;case ut.camera:const f=("/cameras/"+o.toString()+"/").length,m=c.substring(0,f);switch(n=c.substring(f),n){case"perspective/yfov":n="fov";break;case"perspective/znear":case"orthographic/znear":n="near";break;case"perspective/zfar":case"orthographic/zfar":n="far";break;case"perspective/aspect":n="aspect";break;case"orthographic/xmag":n="zoom";break;case"orthographic/ymag":n="zoom";break}c=m+n;break}const l=this.animationPointerResolver;l&&l.resolvePath&&(c=l.resolvePath(c)),t.extensions[nn].pointer=c}if(o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,t);return}let a;return i===ut.node?a=this.parser.getDependency("node",o):i===ut.material?a=this.parser.getDependency("material",o):i===ut.light?a=this.parser.getDependency("light",o):i===ut.camera?a=this.parser.getDependency("camera",o):console.error("Unhandled type",i),a}createAnimationTracksWithAnimationPointer(e,t,s,n,i){if(!(i.extensions&&i.extensions[nn]&&i.path&&i.path==="pointer"))return null;let a=i.extensions[nn].pointer;if(!a)return null;const r=[];a=a.replaceAll("/",".");const c=a.split(".");var h=e.name!==void 0&&e.name!==null?e.name:e.uuid;if(c[2]=h,c[3]==="morphTargetInfluences"&&e.type==="Group"){for(const g of e.children)g instanceof Ei&&g.morphTargetInfluences&&(c[3]=g.name,c[4]="morphTargetInfluences",d(this.parser));return r}d(this.parser);function d(g){a=c.join(".");let p;switch(s.itemSize){case 1:p=ps;break;case 2:case 3:p=gs;break;case 4:a.endsWith(".quaternion")?p=fs:p=fc;break}const b=n.interpolation!==void 0?ku[n.interpolation]:Kn;let f=g._getArrayFromAccessor(s);a.endsWith(".fov")&&(f=f.map(B=>B/Math.PI*180));const m=new p(a,t.array,f,b);if(b==="CUBICSPLINE"&&g._createCubicSplineTrackInterpolant(m),r.push(m),a&&s.itemSize===4&&a.startsWith(".materials.")&&a.endsWith(".color")){const B=new Float32Array(f.length/4);for(let w=0,y=f.length/4;w<y;w+=1)B[w]=f[w*4+3];const E=new p(a.replace(".color",".opacity"),t.array,B,b);b==="CUBICSPLINE"&&g._createCubicSplineTrackInterpolant(m),r.push(E)}}return r}_tryResolveTargetId(e,t){let s="";return t==="node"?s=e.substring(7):t==="material"?s=e.substring(11):t==="light"?s=e.substring(39):t==="camera"&&(s=e.substring(9)),s=s.substring(0,s.indexOf("/")),Number.parseInt(s)}loadAnimation(e){const t=this,s=this.parser.json,n=this.parser,i=s.animations[e],o=i.name?i.name:"animation_"+e,a=[],r=[],c=[],l=[],h=[];for(let d=0,g=i.channels.length;d<g;d++){const p=i.channels[d],b=i.samplers[p.sampler],f=p.target,m=i.parameters!==void 0?i.parameters[b.input]:b.input,B=i.parameters!==void 0?i.parameters[b.output]:b.output;let E=t.loadAnimationTargetFromChannelWithAnimationPointer(p);E||(E=t.loadAnimationTargetFromChannel(p)),a.push(E),r.push(n.getDependency("accessor",m)),c.push(n.getDependency("accessor",B)),l.push(b),h.push(f)}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(c),Promise.all(l),Promise.all(h)]).then(function(d){const g=d[0],p=d[1],b=d[2],f=d[3],m=d[4],B=[];for(let E=0,w=g.length;E<w;E++){const y=g[E],v=p[E],R=b[E],x=f[E],T=m[E];if(y===void 0)continue;y.updateMatrix&&(y.updateMatrix(),y.matrixAutoUpdate=!0);let L=t.createAnimationTracksWithAnimationPointer(y,v,R,x,T);if(L||(L=n._createAnimationTracks(y,v,R,x,T)),L)for(let N=0;N<L.length;N++)B.push(L[N])}return new Ci(o,void 0,B)})}}const wd=Object.freeze(Object.defineProperty({__proto__:null,GLTFAnimationPointerExtension:Fu},Symbol.toStringTag,{value:"Module"}));export{Ed as C,$u as D,Hl as E,gl as F,Aa as G,hd as H,md as I,Gt as K,pd as L,Zu as M,Ad as O,Bd as P,jl as R,cs as S,ed as T,ud as V,dd as X,bd as a,Cd as b,Nu as c,td as d,wl as e,ld as f,Pa as g,gd as h,du as i,qa as j,nd as k,fd as l,Id as m,st as n,rd as o,ad as p,Uu as q,id as r,lo as s,od as t,wd as u,sd as z};
